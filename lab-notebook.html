<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#">
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  

<!-- Some liquid code so that pages get the site.time creation date 
      Would be nice to use github modified times, but doesn't handle 
      the path for pages -->







<!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="resource_type" content="website"/> 
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="2013-05-01T14:41:54-07:00" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="2013-05-01T14:41:54-07:00" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content="2013-05-01T14:41:54-07:00"/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>

<!--NOTE: see also the COinS Metadata in span element in footer -->




  <!-- CSS Stylesheets (toggled with javascript) -->
  <link href="/assets/css/light.css" rel="stylesheet"
        type="text/css" id="stl" title="light" />
  <link href="/assets/css/dark.css" rel="alternate stylesheet" 
        type="text/css" title="dark" />
  <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet" 
        type="text/css"/>
  <!-- Javascript needed for theme toggle, load immediately -->
  <script type="text/javascript" src="/assets/js/switch-css.js"></script>
  <script type="text/javascript">
    set_style_from_cookie(); 
  </script>
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    
<!-- Navbar  ================================================== -->
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="/README.html"><span  class="showtooltip" 
          title="Credits and technical information about this site" 
          data-placement="bottom"><i style="float:right;" class="icon-info-sign" alt="info"></i></span></a>
      <div class="nav-collapse">
        <ul class="nav">
          <li>
          <a href="/index.html">Home</a></li>

          <li>
          <a href="/vita.html">Vita</a></li>

          <li>
          <a href="/research.html">Research</a></li>

          <li>
          <a href="/teaching.html">Teaching</a></li>

          <li>
          <a href="/community.html">Community</a></li>

          <li class="active">
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>
      </div><!--/.nav-collapse -->

      <!-- Search site using Google's index --><!--
      <form class="navbar-search pull-right" method="get" action="http://google.com/search">
        <p>
          <input type="hidden" name="q" value="site:carlboettiger.info" />
          <input type="text" class="search-query" name="q" />
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      -->
      <div id="search">
      <form method="get" class="navbar-search pull-right form-search">
        <p>
        <input type="text" name="search-text" id="search-text">
         <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      </div>
     </div> <!-- /container -->
   </div> <!-- /navbar-inner -->
 </div> <!-- /navbar -->



    <div class="container"> <!-- Responsive grid layout --> 

      <header class="jumbotron">
  <h1 class="entry-title">Lab Notebook</h1>
  <h3>(<a href="http://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h3>
</header>



<div class="row feed">
  <div class="span3 offset1">
    <h4>  <a property="account" href="https://github.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><i class="icon-github" alt="github"></i> Coding </a></h4> 
     <div class="excerpt">
        <ul><li>cboettig pushed to master at cboettig/labnotebook: <em>new entry new entry new entry</em> <a href="https://github.com/cboettig/labnotebook/compare/00368bdb60...f719cb178c">09:19 2013/05/01</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>add gp posteriors to package</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/50c0bc655f...e32361cdc3">09:17 2013/05/01</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>staging run for integrating over GP posterior (large memory reqs)</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/e6c9b3048f...50c0bc655f">09:13 2013/05/01</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>updated example of gp basics includes mcmc and shows influence of the…</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/331a441ca8...e6c9b3048f">08:15 2013/05/01</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>example testing new routine</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/2b33ab0323...331a441ca8">08:14 2013/05/01</a></li></ul>
    </div>
  </div>
  <div class="span3">
    <h4> <a property="account" href="https://twitter.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); return false;"><i class="icon-twitter"></i> Discussing </a></h4> 
     <div class="excerpt">
       <ul><li><p>RT @robertkiley: Wellcome Trust joins Google and PLOS is sponsoring award to demonstrate the value of #openaccess. <a href="http://t.co/V7xLZqqCg5">http://t.co/V7xLZqqCg5</a></p>
 <a href="http://twitter.com/cboettig/statuses/329698305531588609">01:46 2013/05/01</a> </li><li><p>@dwbapst thanks for the heads up; I wonder why. looks passable in feedly, what reader do you have now?</p>
 <a href="http://twitter.com/cboettig/statuses/329681925964984321">12:41 2013/05/01</a> </li><li><p><a href="http://t.co/p1codPMYIr">http://t.co/p1codPMYIr</a> <a href="http://t.co/dcvJzYi0Hz">http://t.co/dcvJzYi0Hz</a></p>
 <a href="http://twitter.com/cboettig/statuses/329667011435180032">11:41 2013/05/01</a> </li><li><p>Twenty-Five Shades of Greycite: Semantics for referencing and preservation <a href="http://t.co/XVl8eimueP">http://t.co/XVl8eimueP</a></p>
 <a href="http://twitter.com/cboettig/statuses/329655434355044352">10:55 2013/05/01</a> </li><li><p>RT @jrossibarra: @ctitusbrown @cboettig Personally, the fact that we have a wiki I think is cooler than the fact that we have public pools.…</p>
 <a href="http://twitter.com/cboettig/statuses/328903490741080066">09:07 2013/04/29</a> </li></ul>
    </div> 
  </div> 
  <div class="span3">
    <h4> <a href="http://www.mendeley.com/groups/634301/theoretical-ecology/papers/" onClick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); return false;"><i class="icon-book"></i> Reading </a></h4> 
    <div class="excerpt">
      <ul><li>Speed of expansion and extinction in experimental populations.: Ecology letters (2009). Volume: 12, Issue: 8. Pages: 772-8. John M Drake, Blaine D Griffen et al. <a href="http://www.mendeley.com/catalog/speed-expansion-extinction-experimental-populations/">06:00 2013/04/23</a></li><li>Nonlinear Forecasting for the Classification of Natural Time Series: Philosophical Transactions of the Royal Society A: Mathematical, Physical and Engineering Sciences (1994). Volume: 348, Issue: 1688. Pages: 477-495. G. Sugihara et al. <a href="http://www.mendeley.com/research/nonlinear-forecasting-classification-natural-time-series/">11:56 2013/04/22</a></li><li>Distinguishing random environmental fluctuations from ecological catastrophes for the North Pacific Ocean.: Nature (2005). Volume: 435, Issue: 7040. Pages: 336-40. Chih-hao Hsieh, Sarah M Glaser, Andrew J Lucas, George Sugihara et al. <a href="http://www.mendeley.comhttp://www.mendeley.com/c/5744815114/g/634301/hsieh-2005-distinguishing-random-environmental-fluctuations-from-ecological-catastrophes-for-the-north-pacific-ocean/">11:56 2013/04/22</a></li><li>Persistence of Dynamical Systems under Random Perturbations: SIAM Review (1975). Volume: 17, Issue: 4. Pages: 605-640. Donald Ludwig et al. <a href="http://www.mendeley.com/research/persistence-dynamical-systems-under-random-perturbations-1/">11:54 2013/04/22</a></li></ul>
    </div>
  </div> 
</div>

<hr>
<div class="row postpreview">
  <div class="span11 offset1">
    <div class="row">
      <h4> <a href="http://www.carlboettiger.info/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="span3">
          <header><h4><a href="/2013/04/29/finishing-comparison-parametric-and-nonparametric.html">Finishing Comparison Parametric And Nonparametric</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 29 Apr 2013</p>

<p style="font-style:italic"> pageviews: (not calculated) </p>

<article>
<div class="excerpt">
<p>Implemented in <a href="https://github.com/cboettig/nonparametric-bayes/blob/75df9413c016480f935867d88345ddaa36d07a82/inst/examples/BUGS/allen.md">BUGS/allen.md</a></p>
<ul>
<li>[x] Inverse gamma priors on variances <a href="https://github.com/cboettig/nonparametric-bayes/commit/36888da01d7e36e58fc15c671e858be6fcf8a02d">36888da</a></li>
<li>[x] Uniform prior on standard deviations <a href="https://github.com/cboettig/nonparametric-bayes/commit/75df9413c016480f935867d88345ddaa36d07a82">75df941</a></li>
<li>[x] Mean plot for parametric fit <a href="https://github.com/cboettig/nonparametric-bayes/commit/75df9413c016480f935867d88345ddaa36d07a82">75df941</a></li>
<li><p>[x] Convergence diagnostics for both parametric and nonparametric MCMC, using similar visual layout <a href="https://github.com/cboettig/nonparametric-bayes/commit/75df9413c016480f935867d88345ddaa36d07a82">75df941</a></p></li>
<li><p>Oh, Jeromy Anglim has a rather nice collection of <a href="http://jeromyanglim.blogspot.com/2012/04/getting-started-with-jags-rjags-and.html">jags links</a></p></li>
</ul>
<h2 id="on-variance-priors-for-the-parametric-mcmc">On Variance Priors for the Parametric MCMC</h2>
<ul>
<li>Gelman recommends uniform priors on standard deviations for the noise terms: in the <code>.bugs</code> file we have</li>
</ul>
<pre><code>stdQ ~ dunif(0,100)
stdR ~ dunif(0,100)
# as &quot;precision&quot; tau instead of stdev sigma
iQ &lt;- 1/(stdQ*stdQ);
iR &lt;- 1/(stdR*stdR);</code></pre>
<p>Where these enter the model as</p>
<pre><code>for(t in 1:(N-1)){
    mu[t] &lt;- x[t] + exp(r0 * (1 - x[t]/K)* (x[t] - theta) )
      x[t+1] ~ dnorm(mu[t],iQ)
}


for(t in 1:(N)){
    y[t] ~ dnorm(x[t],iR)
}</code></pre>
<p>Note that <code>dnorm</code> in JAGS notation is defined in terms of the mean and the precision (reciprocal of the variance), rather than standard deviation (e.g. in R’s <code>dnorm</code> function), see the <a href="http://ftp.iinet.net.au/pub/FreeBSD/distfiles/mcmc-jags/jags_user_manual.pdf">JAGS manual</a>, particularly Table 6.1 pg 29, below. Note that the standard deviation has the uniform prior, not the precision.</p>
<ul>
<li>Also try inverse gamma priors,</li>
</ul>
<pre><code>iQ ~ dgamma(0.0001,0.0001)
iR ~ dgamma(0.0001,0.0001)</code></pre>
<p>(Precision is Gamma distributed when the variances are inverse-gamma distributed.</p>
<ul>
<li>Both are quite uniformative, results appear quite comparable.</li>
</ul>
<div class="figure">
<img src="http://farm9.staticflickr.com/8119/8692697741_fa2dfb83b1_o.png" />
</div>
<h2 id="markov-chain-monte-carlo-convergence-analysis">Markov Chain Monte Carlo Convergence Analysis</h2>
<ul>
<li>Add for both parametric and non-parametric cases</li>
<li>Extra long runs before finalizing analysis</li>
<li>Some <a href="http://www.people.fas.harvard.edu/~plam/teaching/methods/convergence/convergence_print.pdf">examples</a> with R code</li>
</ul>
<p>A variety of tools from <code>coda</code> package. Of course these methods are designed from toy problems and cannot guarentee convergence.</p>
<ol style="list-style-type: decimal">
<li>Traceplots, density plots</li>
<li>Running mean, autocorrelation plots <code>autocorr.plot</code></li>
<li>Metropolis acceptance/rejection rate <code>rejectionRate</code></li>
<li>Multiple chain diagonostics: Gelman-Rubin <code>gelman.diag</code>, <code>gelman.plot</code></li>
<li>Geweke (compare means between different sections) <code>geweke.diag</code></li>
<li>Raferty-Lewis <code>raferty.diag</code></li>
<li>Heidelberg and Welch <code>heidel.diag</code></li>
</ol>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/29/finishing-comparison-parametric-and-nonparametric.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/27/comparison-of-nonparametric-and-parametric-approaches.html">A comparison of nonparametric Bayesian Gaussian process estimates to standard the parametric Bayesian approach</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 27 Apr 2013</p>

<p style="font-style:italic"> pageviews: 11 </p>

<article>
<div class="excerpt">
<p>Load necessary libraries,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(pdgControl)  <span class="co"># custom SDP functions</span>
<span class="kw">library</span>(nonparametricbayes)  <span class="co"># custom</span>
<span class="kw">library</span>(reshape2)  <span class="co"># data manipulation</span>
<span class="kw">library</span>(data.table)  <span class="co"># data manipulation</span>
<span class="kw">library</span>(plyr)  <span class="co"># data manipulation</span>
<span class="kw">library</span>(ggplot2)  <span class="co"># plotting</span>
<span class="kw">library</span>(tgp)  <span class="co"># Gaussian Processes</span>
<span class="kw">library</span>(MCMCpack)  <span class="co"># Markov Chain Monte Carlo tools</span>
<span class="kw">library</span>(R2jags)  <span class="co"># Markov Chain Monte Carlo tools</span>
<span class="kw">library</span>(emdbook)  <span class="co"># Markov Chain Monte Carlo tools</span>
<span class="kw">library</span>(coda)  <span class="co"># Markov Chain Monte Carlo tools</span></code></pre>
<p>Plotting and knitr options, (can generally be ignored)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitcitations)
opts_chunk$<span class="kw">set</span>(<span class="dt">tidy =</span> <span class="ot">FALSE</span>, <span class="dt">warning =</span> <span class="ot">FALSE</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>, <span class="dt">cache =</span> <span class="ot">FALSE</span>)
opts_knit$<span class="kw">set</span>(<span class="dt">upload.fun =</span> socialR::flickr.url)
<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">10</span>))
<span class="kw">theme_update</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, 
    <span class="dt">colour =</span> <span class="ot">NA</span>), <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">colour =</span> <span class="ot">NA</span>))
cbPalette &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>, 
    <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</code></pre>
<h3 id="model-and-parameters">Model and parameters</h3>
<p>Uses the model derived in Allen et al, of a Ricker-like growth curve with an allee effect, defined in the pdgControl package,</p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>RickerAllee
p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">5</span>) 
K &lt;-<span class="st"> </span>p[<span class="dv">2</span>]
allee &lt;-<span class="st"> </span>p[<span class="dv">3</span>]</code></pre>
<p>Various parameters defining noise dynamics, grid, and policy costs.</p>
<pre class="sourceCode r"><code class="sourceCode r">sigma_g &lt;-<span class="st"> </span><span class="fl">0.05</span>
sigma_m &lt;-<span class="st"> </span><span class="fl">0.0</span>
z_g &lt;-<span class="st"> </span>function() <span class="kw">rlnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma_g)
z_m &lt;-<span class="st"> </span>function() <span class="dv">1</span>+(<span class="dv">2</span>*<span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>,  <span class="dv">1</span>)-<span class="dv">1</span>) *<span class="st"> </span>sigma_m
x_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span> *<span class="st"> </span>K, <span class="dt">length=</span><span class="dv">101</span>)
h_grid &lt;-<span class="st"> </span>x_grid
profit &lt;-<span class="st"> </span>function(x,h) <span class="kw">pmin</span>(x, h)
delta &lt;-<span class="st"> </span><span class="fl">0.01</span>
OptTime &lt;-<span class="st"> </span><span class="dv">20</span>  <span class="co"># stationarity with unstable models is tricky thing</span>
reward &lt;-<span class="st"> </span><span class="dv">0</span>
xT &lt;-<span class="st"> </span><span class="dv">0</span>
seed_i &lt;-<span class="st"> </span><span class="dv">111</span>
Xo &lt;-<span class="st"> </span>K <span class="co"># observations start from</span>
x0 &lt;-<span class="st"> </span>Xo <span class="co"># simulation under policy starts from</span>
Tobs &lt;-<span class="st"> </span><span class="dv">35</span></code></pre>
<h3 id="sample-data">Sample Data</h3>
<pre class="sourceCode r"><code class="sourceCode r">obs &lt;-<span class="st"> </span><span class="kw">sim_obs</span>(Xo, z_g, f, p, <span class="dt">Tobs=</span>Tobs, <span class="dt">nz=</span><span class="dv">15</span>, 
                <span class="dt">harvest =</span> <span class="kw">sort</span>(<span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dt">length=</span><span class="dv">7</span>), <span class="dv">5</span>)), <span class="dt">seed =</span> seed_i)</code></pre>
<h2 id="maximum-likelihood">Maximum Likelihood</h2>
<pre class="sourceCode r"><code class="sourceCode r">alt &lt;-<span class="st"> </span><span class="kw">par_est</span>(obs,  <span class="dt">init =</span> <span class="kw">c</span>(<span class="dt">r =</span> p[<span class="dv">1</span>], 
                              <span class="dt">K =</span> <span class="kw">mean</span>(obs$x[obs$x&gt;<span class="dv">0</span>]), 
                              <span class="dt">s =</span> sigma_g))
est &lt;-<span class="st"> </span><span class="kw">par_est_allee</span>(obs, f, p,  
                     <span class="dt">init =</span> <span class="kw">c</span>(<span class="dt">r =</span> p[<span class="dv">1</span>] +<span class="st"> </span><span class="dv">1</span>, 
                              <span class="dt">K =</span> p[<span class="dv">2</span>] +<span class="st"> </span><span class="dv">2</span>, 
                              <span class="dt">C =</span> p[<span class="dv">3</span>] +<span class="st"> </span><span class="dv">2</span>, 
                              <span class="dt">s =</span> sigma_g))</code></pre>
<h2 id="non-parametric-bayes">Non-parametric Bayes</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#inv gamma has mean b / (a - 1) (assuming a&gt;1) and variance b ^ 2 / ((a - 2) * (a - 1) ^ 2) (assuming a&gt;2)</span>
s2.p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)  
tau2.p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">1</span>)
d.p =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>)
nug.p =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>) <span class="co"># gamma mean</span>
s2_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dinvgamma</span>(x, s2.p[<span class="dv">1</span>], s2.p[<span class="dv">2</span>])
tau2_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dinvgamma</span>(x, tau2.p[<span class="dv">1</span>], tau2.p[<span class="dv">2</span>])
d_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dgamma</span>(x, d.p[<span class="dv">1</span>], <span class="dt">scale =</span> d.p[<span class="dv">2</span>]) +<span class="st"> </span><span class="kw">dgamma</span>(x, d.p[<span class="dv">3</span>], <span class="dt">scale =</span> d.p[<span class="dv">4</span>])
nug_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dgamma</span>(x, nug.p[<span class="dv">1</span>], <span class="dt">scale =</span> nug.p[<span class="dv">2</span>]) +<span class="st"> </span><span class="kw">dgamma</span>(x, nug.p[<span class="dv">3</span>], <span class="dt">scale =</span> nug.p[<span class="dv">4</span>])
beta0_prior &lt;-<span class="st"> </span>function(x, tau) <span class="kw">dnorm</span>(x, <span class="dv">0</span>, tau)
beta =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>)
priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">s2 =</span> s2_prior, <span class="dt">tau2 =</span> tau2_prior, <span class="dt">beta0 =</span> dnorm, <span class="dt">nug =</span> nug_prior, <span class="dt">d =</span> d_prior, <span class="dt">ldetK =</span> function(x) <span class="dv">0</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">  gp &lt;-<span class="st"> </span><span class="kw">bgp</span>(<span class="dt">X=</span>obs$x, <span class="dt">XX=</span>x_grid, <span class="dt">Z=</span>obs$y, <span class="dt">verb=</span><span class="dv">0</span>,
          <span class="dt">meanfn=</span><span class="st">&quot;constant&quot;</span>, <span class="dt">bprior=</span><span class="st">&quot;b0&quot;</span>, <span class="dt">BTE=</span><span class="kw">c</span>(<span class="dv">2000</span>,<span class="dv">20000</span>,<span class="dv">2</span>),
          <span class="dt">m0r1=</span><span class="ot">FALSE</span>, <span class="dt">corr=</span><span class="st">&quot;exp&quot;</span>, <span class="dt">trace=</span><span class="ot">TRUE</span>, 
          <span class="dt">beta =</span> beta, <span class="dt">s2.p =</span> s2.p, <span class="dt">d.p =</span> d.p, <span class="dt">nug.p =</span> nug.p, <span class="dt">tau2.p =</span> tau2.p,
          <span class="dt">s2.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">d.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">nug.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">tau2.lam =</span> <span class="st">&quot;fixed&quot;</span>)      </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">hyperparameters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;index&quot;</span>, <span class="st">&quot;s2&quot;</span>, <span class="st">&quot;tau2&quot;</span>, <span class="st">&quot;beta0&quot;</span>, <span class="st">&quot;nug&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;ldetK&quot;</span>)
posteriors &lt;-<span class="st"> </span><span class="kw">melt</span>(gp$trace$XX[[<span class="dv">1</span>]][,hyperparameters], <span class="dt">id=</span><span class="st">&quot;index&quot;</span>)

<span class="co"># Traces </span>
<span class="kw">ggplot</span>(posteriors) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(index, value)) +<span class="st"> </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>variable, <span class="dt">scale=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8261/8685360238_353dbc5894_o.png" alt="plot of chunk unnamed-chunk-3" /><p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">

prior_curves &lt;-<span class="st"> </span><span class="kw">ddply</span>(posteriors, <span class="st">&quot;variable&quot;</span>, function(dd){
    grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">min</span>(dd$value), <span class="kw">max</span>(dd$value), <span class="dt">length =</span> <span class="dv">100</span>)
    <span class="kw">data.frame</span>(<span class="dt">value =</span> grid, <span class="dt">density =</span> priors[[dd$variable[<span class="dv">1</span>]]](grid))
})

<span class="co"># </span>
<span class="kw">ggplot</span>(posteriors) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">y=</span>..density..), <span class="dt">alpha=</span><span class="fl">0.7</span>) +
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">data=</span>prior_curves, <span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">y=</span>density), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>, <span class="dt">lwd=</span><span class="dv">2</span>) +
<span class="st">    </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>variable, <span class="dt">scale=</span><span class="st">&quot;free&quot;</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8521/8685360484_e2ce943ebd_o.png" alt="plot of chunk unnamed-chunk-3" /><p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(posteriors, <span class="kw">aes</span>(value)) +<span class="st"> </span><span class="kw">stat_density</span>(<span class="dt">geom=</span><span class="st">&quot;path&quot;</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data=</span>prior_curves, <span class="kw">aes</span>(<span class="dt">x=</span>value, <span class="dt">y=</span>density), <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) +<span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>variable, <span class="dt">scale=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8398/8685360552_d9ba680ff7_o.png" alt="plot of chunk unnamed-chunk-3" /><p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
<h4 id="parametric-bayes">Parametric Bayes</h4>
<p>We initiate the MCMC chain (<code>init_p</code>) using the true values of the parameters <code>p</code> from the simulation. While impossible in real data, this gives the parametric Bayesian approach the best chance at succeeding. <code>y</code> is the timeseries (recall <code>obs</code> has the <span class="math">\(x_t\)</span>, <span class="math">\(x_{t+1}\)</span> pairs)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># a bit unfair to start with the correct values, but anyhow...</span>
init_p =<span class="st"> </span>p
<span class="kw">names</span>(init_p) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r0&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;theta&quot;</span>)
y &lt;-<span class="st"> </span>obs$y[-<span class="dv">1</span>] 
N=<span class="kw">length</span>(y);</code></pre>
<p>We’ll be using the JAGS Gibbs sampler, a recent open source BUGS implementation with an R interface that works on most platforms. We initialize the usual MCMC parameters; see <code>?jags</code> for details.</p>
<pre class="sourceCode r"><code class="sourceCode r">jags.data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;N&quot;</span>,<span class="st">&quot;y&quot;</span>)
n.chains =<span class="st"> </span><span class="dv">1</span>
n.iter =<span class="st"> </span><span class="dv">20000</span>
n.burnin =<span class="st"> </span><span class="kw">floor</span>(n.iter/<span class="dv">2</span>)
n.thin =<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="kw">floor</span>(n.chains *<span class="st"> </span>(n.iter -<span class="st"> </span>n.burnin)/<span class="dv">1000</span>))</code></pre>
<p>The actual model is defined in a <code>model.file</code> that contains an R function that is automatically translated into BUGS code by <em>R2WinBUGS</em>. The file defines the priors and the model, as seen when read in here</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(<span class="kw">readLines</span>(<span class="dt">con=</span><span class="st">&quot;bugmodel-GammaPrior.txt&quot;</span>), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</code></pre>
<pre><code>## # Allen&#39;s Allee model based on a Ricker
## 
## model{
## 
## # Define prior densities for parameters
## K     ~ dunif(1.0, 22000.0)
## logr0    ~ dunif(-4.0, 2.0)
## logtheta ~ dunif(-4.0, 2.0)
## iQ ~ dgamma(0.0001,0.0001)
## iR ~ dgamma(0.0001,0.0001)
## 
## # Transform parameters to fit in the model
## r0 &lt;- exp(logr0)
## theta &lt;- exp(logtheta)
## 
## # Initial state
## x[1] ~ dunif(0,10)
## 
## # Loop over all states, 
## for(t in 1:(N-1)){
##   mu[t] &lt;- x[t] + exp(r0 * (1 - x[t] / K) * (x[t] - theta) )
##   x[t+1] ~ dnorm(mu[t],iQ)
## }
## 
## # Loop over all observations, 
## for(t in 1:(N)){
##   y[t] ~ dnorm(x[t],iR)
## }
## 
## }</code></pre>
<p>We define which parameters to keep track of, and set the initial values of parameters in the transformed space used by the MCMC. We use logarithms to maintain strictly positive values of parameters where appropriate. Because our priors on the noise parameters are inverse gamma distributed.</p>
<pre class="sourceCode r"><code class="sourceCode r">jags.params=<span class="kw">c</span>(<span class="st">&quot;K&quot;</span>,<span class="st">&quot;logr0&quot;</span>,<span class="st">&quot;logtheta&quot;</span>,<span class="st">&quot;iR&quot;</span>,<span class="st">&quot;iQ&quot;</span>) <span class="co"># Don&#39;t need to save &quot;x&quot;</span>
jags.inits &lt;-<span class="st"> </span>function(){
  <span class="kw">list</span>(<span class="st">&quot;K&quot;</span>=init_p[<span class="st">&quot;K&quot;</span>],<span class="st">&quot;logr0&quot;</span>=<span class="kw">log</span>(init_p[<span class="st">&quot;r0&quot;</span>]),<span class="st">&quot;logtheta&quot;</span>=<span class="kw">log</span>(init_p[<span class="st">&quot;theta&quot;</span>]),<span class="st">&quot;iQ&quot;</span>=<span class="dv">1</span>/<span class="fl">0.05</span>,<span class="st">&quot;iR&quot;</span>=<span class="dv">1</span>/<span class="fl">0.1</span>,<span class="st">&quot;x&quot;</span>=y,<span class="dt">.RNG.name=</span><span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed=</span><span class="dv">123</span>)
}
<span class="kw">set.seed</span>(<span class="dv">12345</span>)
time&lt;-<span class="kw">system.time</span>(       
  jagsfit &lt;-<span class="st"> </span><span class="kw">jags</span>(<span class="dt">data=</span>jags.data, <span class="dt">inits=</span>jags.inits, jags.params, <span class="dt">n.chains=</span>n.chains, 
                  <span class="dt">n.iter=</span>n.iter, <span class="dt">n.thin=</span>n.thin, <span class="dt">n.burnin=</span>n.burnin,<span class="dt">model.file=</span><span class="st">&quot;bugmodel-GammaPrior.txt&quot;</span>)
)         </code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
##    Graph Size: 394
## 
## Initializing model</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">time &lt;-<span class="st"> </span><span class="kw">unname</span>(time[<span class="st">&quot;elapsed&quot;</span>]);</code></pre>
<h4 id="convergence-diagnostics-for-parametric-bayes">Convergence diagnostics for parametric bayes</h4>
<pre class="sourceCode r"><code class="sourceCode r">jags_matrix &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">as.mcmc.bugs</span>(jagsfit$BUGSoutput))
par_posteriors &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">cbind</span>(<span class="dt">index =</span> <span class="dv">1</span>:<span class="kw">dim</span>(jags_matrix)[<span class="dv">1</span>], jags_matrix), <span class="dt">id =</span> <span class="st">&quot;index&quot;</span>)

<span class="co"># Traces</span>
<span class="kw">ggplot</span>(par_posteriors) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(index, value)) +<span class="st"> </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>variable, <span class="dt">scale=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">1</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8401/8684242957_c1958f5a03_o.png" alt="plot of chunk unnamed-chunk-8" /><p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="co"># posterior distributiosn</span>
<span class="kw">ggplot</span>(par_posteriors, <span class="kw">aes</span>(value)) +<span class="st"> </span><span class="kw">stat_density</span>(<span class="dt">geom=</span><span class="st">&quot;path&quot;</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>) +
<span class="st">  </span><span class="kw">facet_wrap</span>(~<span class="st"> </span>variable, <span class="dt">scale=</span><span class="st">&quot;free&quot;</span>, <span class="dt">ncol=</span><span class="dv">2</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8255/8684243073_7a0daf0466_o.png" alt="plot of chunk unnamed-chunk-8" /><p class="caption">plot of chunk unnamed-chunk-8</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">mcmc &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(jagsfit)
mcmcall &lt;-<span class="st"> </span>mcmc[,-<span class="dv">2</span>]
who &lt;-<span class="st"> </span><span class="kw">colnames</span>(mcmcall)
who </code></pre>
<pre><code>## [1] &quot;K&quot;        &quot;iQ&quot;       &quot;iR&quot;       &quot;logr0&quot;    &quot;logtheta&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">mcmcall &lt;-<span class="st"> </span><span class="kw">cbind</span>(mcmcall[,<span class="dv">1</span>],mcmcall[,<span class="dv">2</span>],mcmcall[,<span class="dv">3</span>],mcmcall[,<span class="dv">4</span>],mcmcall[,<span class="dv">5</span>])
<span class="kw">colnames</span>(mcmcall) &lt;-<span class="st"> </span>who</code></pre>
<h4 id="phase-space-diagram-of-the-expected-dynamics">Phase-space diagram of the expected dynamics</h4>
<pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">gp_plot</span>(gp, f, p, est$f, est$p, alt$f, alt$p, x_grid, obs, seed_i)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8535/8684243227_41391fdd48_o.png" alt="plot of chunk unnamed-chunk-10" /><p class="caption">plot of chunk unnamed-chunk-10</p>
</div>
<h2 id="optimal-policies-by-value-iteration">Optimal policies by value iteration</h2>
<p>Compute the optimal policy under each model using stochastic dynamic programming.</p>
<pre class="sourceCode r"><code class="sourceCode r">MaxT =<span class="st"> </span><span class="dv">1000</span>
matrices_gp &lt;-<span class="st"> </span><span class="kw">gp_transition_matrix</span>(gp$ZZ.km, gp$ZZ.ks2, x_grid, h_grid)
opt_gp &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(matrices_gp, x_grid, h_grid, MaxT, xT, profit, delta, reward)

matrices_true &lt;-<span class="st"> </span><span class="kw">f_transition_matrix</span>(f, p, x_grid, h_grid, sigma_g)
opt_true &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(matrices_true, x_grid, h_grid, <span class="dt">OptTime=</span>MaxT, xT, profit, <span class="dt">delta=</span>delta)

matrices_estimated &lt;-<span class="st"> </span><span class="kw">f_transition_matrix</span>(est$f, est$p, x_grid, h_grid, est$sigma_g)
opt_estimated &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(matrices_estimated, x_grid, h_grid, <span class="dt">OptTime=</span>MaxT, xT, profit, <span class="dt">delta=</span>delta)

matrices_alt &lt;-<span class="st"> </span><span class="kw">f_transition_matrix</span>(alt$f, alt$p, x_grid, h_grid, alt$sigma_g)
opt_alt &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(matrices_alt, x_grid, h_grid, <span class="dt">OptTime=</span>MaxT, xT, profit, <span class="dt">delta=</span>delta)


pardist &lt;-<span class="st"> </span>mcmcall
pardist[,<span class="dv">4</span>] =<span class="st"> </span><span class="kw">exp</span>(pardist[,<span class="dv">4</span>]) <span class="co"># transform model parameters back first</span>
pardist[,<span class="dv">5</span>] =<span class="st"> </span><span class="kw">exp</span>(pardist[,<span class="dv">5</span>])


matrices_par_bayes &lt;-<span class="st"> </span><span class="kw">parameter_uncertainty_SDP</span>(f, p, x_grid, h_grid, pardist)
opt_par_bayes &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(matrices_par_bayes, x_grid, h_grid, <span class="dt">OptTime=</span>MaxT, xT, profit, <span class="dt">delta=</span>delta)


OPT =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">GP =</span> opt_gp$D, <span class="dt">True =</span> opt_true$D, <span class="dt">MLE =</span> opt_estimated$D, <span class="dt">Ricker.MLE =</span> opt_alt$D, <span class="dt">Parametric.Bayes =</span> opt_par_bayes$D)
colorkey=cbPalette
<span class="kw">names</span>(colorkey) =<span class="st"> </span><span class="kw">names</span>(OPT) </code></pre>
<h2 id="graph-of-the-optimal-policies">Graph of the optimal policies</h2>
<pre class="sourceCode r"><code class="sourceCode r">policies &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">stock=</span>x_grid, <span class="kw">sapply</span>(OPT, function(x) x_grid[x])), <span class="dt">id=</span><span class="st">&quot;stock&quot;</span>)
<span class="kw">names</span>(policies) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;stock&quot;</span>, <span class="st">&quot;method&quot;</span>, <span class="st">&quot;value&quot;</span>)
<span class="kw">ggplot</span>(policies, <span class="kw">aes</span>(stock, stock -<span class="st"> </span>value, <span class="dt">color=</span>method)) +
<span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">lwd=</span><span class="fl">1.2</span>, <span class="dt">alpha=</span><span class="fl">0.8</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;stock size&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;escapement&quot;</span>)  +
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8542/8685372902_e8719a0c51_o.png" alt="plot of chunk unnamed-chunk-12" /><p class="caption">plot of chunk unnamed-chunk-12</p>
</div>
<h2 id="simulate-100-realizations-managed-under-each-of-the-policies">Simulate 100 realizations managed under each of the policies</h2>
<pre class="sourceCode r"><code class="sourceCode r">

sims &lt;-<span class="st"> </span><span class="kw">lapply</span>(OPT, function(D){
  <span class="kw">set.seed</span>(<span class="dv">1</span>)
  <span class="kw">lapply</span>(<span class="dv">1</span>:<span class="dv">100</span>, function(i) 
    <span class="kw">ForwardSimulate</span>(f, p, x_grid, h_grid, x0, D, z_g, <span class="dt">profit=</span>profit, <span class="dt">OptTime=</span>OptTime)
  )
})

  
dat &lt;-<span class="st"> </span><span class="kw">melt</span>(sims, <span class="dt">id=</span><span class="kw">names</span>(sims[[<span class="dv">1</span>]][[<span class="dv">1</span>]]))
dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(dat)
<span class="kw">setnames</span>(dt, <span class="kw">c</span>(<span class="st">&quot;L1&quot;</span>, <span class="st">&quot;L2&quot;</span>), <span class="kw">c</span>(<span class="st">&quot;method&quot;</span>, <span class="st">&quot;reps&quot;</span>)) 
<span class="co"># Legend in original ordering please, not alphabetical: </span>
dt$method =<span class="st"> </span><span class="kw">factor</span>(dt$method, <span class="dt">ordered=</span><span class="ot">TRUE</span>, <span class="dt">levels=</span><span class="kw">names</span>(OPT))

<span class="kw">ggplot</span>(dt) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(time, fishstock, <span class="dt">group=</span><span class="kw">interaction</span>(reps,method), <span class="dt">color=</span>method), <span class="dt">alpha=</span>.<span class="dv">1</span>) +
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>)))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8400/8685373300_18931d5055_o.png" alt="plot of chunk unnamed-chunk-13" /><p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">ggplot</span>(dt) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(time, harvest, <span class="dt">group=</span><span class="kw">interaction</span>(reps,method), <span class="dt">color=</span>method), <span class="dt">alpha=</span>.<span class="dv">1</span>) +
<span class="st">  </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>)))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8535/8685373378_da45da3cbd_o.png" alt="plot of chunk unnamed-chunk-13" /><p class="caption">plot of chunk unnamed-chunk-13</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r">  </code></pre>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/27/comparison-of-nonparametric-and-parametric-approaches.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/26/notebook-features-reproducible-code.html">Notebook features: reproducible code</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 26 Apr 2013</p>

<p style="font-style:italic"> pageviews: 15 </p>

<article>
<div class="excerpt">
<p>I now use the dynamic documentation software called <a href="http://yihui.name/knitr">knitr</a> to write most entries that shore results and figures. The code to replicate the results is included automatically, ensuring that what I say I did and what code I actually ran to get the results are consistent. Though I have written about knitr before, both regarding its <a href="http://carlboettiger.info/2012/03/21/knitr-github-and-a-new-phase-for-the-lab-notebook.html">use in my notebook</a> and <a href="http://carlboettiger.info/2012/04/07/writing-reproducibly-in-the-open-with-knitr.html">in my manuscripts</a>, here I provide a quick summary of how a reader might actually reproduce a figure or result they come across in the notebook, as well as some of the possible problems involved.</p>
<p>As the code required for any given analysis can be quite involved, it is not pratical to provide free-standing scripts in this way. Instead, I write the algorithms as functions provided by an R package dedicated to the project, e.g. <a href="http://github.com/cboettig/nonparametric-bayes">nonparametric-bayes</a>, <a href="http://github.com/cboettig/multiple_uncertainty">multiple-uncertainty</a>, or <a href="http://github.com/cboettig/earlywarning">warning-signals</a>, which is version-managed on Github. The code displayed in the post can then be limited to the specific calls to analysis, data manipulation, and plotting functions unique to the exploration shown, without repeating the code for all algorithms involved.</p>
<p>The code for the analyses is also stored on github using the same dynamic documentation approach with knitr. These scripts are found in the <code>inst/examples</code> directory of my packages. This approach allows a given analysis to evolve with my research in a more tractable way than simply pasting updated copies as successive notebook entries. The notebook entries then become a place for me to synthesize the results of a script.</p>
<p>Though the package functions are usually backwards-compatible, proper reproducibility is only attained by having the version of the package from time of the result. This is easily accomplished by the seemless integration of Github and R using the devtools package. Consider a figure from a page of the notebook, such as the final histogram plot from <a href="http://www.carlboettiger.info/2012/12/20/results-comparing-gp-to-parametric.html">this entry</a>. The entry links to the script responsible for the figure, <a href="https://github.com/cboettig/nonparametric-bayes/blob/9d5cd1f027bdfe5f356dce83756726c95a6fcdd8/inst/examples/myers-exploration.md">https://github.com/cboettig/nonparametric-bayes/blob/9d5cd1f027bdfe5f356dce83756726c95a6fcdd8/inst/examples/myers-exploration.md</a></p>
<p>We can install the entire research compendium at exactly the state it was at the time of the analysis using the hash (long chain of seemingly random characters, see the (upcoming) entry on <a href="">hashes</a>) using the clever <code>devtools</code> R package,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install_github</span>(<span class="st">&quot;nonparametric-bayes&quot;</span>, <span class="st">&quot;cboettig&quot;</span>, <span class="st">&quot;9d5cd1f027bdfe5f356dce83756726c95a6fcdd8&quot;</span>) </code></pre>
<p>We can then copy and paste the code linked from the figure to replicate the results. This provides a fast and effective way replicate the work appearing in or linked to any entry. More importantly perhaps, this approach also allows one to repeat any given analysis with the most recent version of an algorithm and compare the results, since the package structure provides a logical seperation between algorithm and analysis. In practice such fine-grained control and invistigation is more important than simply being able to regenerate what has already been done without any further input.</p>
<p>This is not entirely failsafe. The package may depend on other packages, which themselves may have changed. For my use cases, it is a deal more reliable than running the current version of a package that is actively changing during my research. Readers interested in even more robust replication and verification should take a look at Roger Peng’s package <code>stashR</code> package and associated publications <span class="showtooltip" data-html="true" title="<p>Eckel S and Peng RD (2012). stashR: A Set of Tools for Administering SHared Repositories. R package version 0.3-5.“&gt;<a href="http://CRAN.R-project.org/package=stashR">Eckel &amp; Peng (2012)</a></span> .</p>
<h2 id="references">References</h2>
<ul>
<li>Sandy Eckel, Roger Peng, (2012) stashR: A Set of Tools for Administering SHared Repositories. <a href="http://CRAN.R-project.org/package=stashR">http://CRAN.R-project.org/package=stashR</a></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/26/notebook-features-reproducible-code.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/04/26/notebook-features-introduction.html">Notebook features: an introduction</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 26 Apr 2013</p>

<p style="font-style:italic"> pageviews: 23 </p>

<article>
<div class="excerpt">
<p>In keeping this open lab notebook, I have sought to address three goals (in addition to all the traditional reasons for keeping a lab notebook)</p>
<ol style="list-style-type: decimal">
<li>Provide an educational resource</li>
<li>Experiment with scientific infrastructure and tools for sharing and replicating research</li>
<li>Facilitate the rapid and open dissemination of scientific research</li>
</ol>
<p>which are coincidentally evocative of <a href="http://www.nsf.gov/pubs/2007/nsf07046/nsf07046.jsp">NSF’s Broader Impacts</a> areas. In this series of posts I plan to explore and illustrate some of my experiments to address these goals through various web-based tools available for an open notebook platform. Many of these have been documented in the notebook itself as I experiment with them (see <a href="http://www.carlboettiger.info/tags.html#notebook-technology">#notebook-technology</a>). Not all of those experiments pan out and older tools and techniques are often replaced with newer ones as I explore, and these posts are usually more technical notes written to help me think through and remember what I’m trying out. In order to provide a more accessible snapshot of notebook features, I thought it might be helpful to write a series of posts describing these tools and techniques.</p>
<p>Below is an index of posts in this theme that I will continue to update as I have a chance to finish them. If there’s anything about the notebook that you’d like to hear more about, feel free to suggest it in the comments.</p>
<h3 id="written">Written</h3>
<ol style="list-style-type: decimal">
<li><a href="http://carlboettiger.info/2013/04/25/notebook-features-reproducible-code.html">Reproducible code: embedding code and dynamic documents</a></li>
<li><a href="http://carlboettiger.info/2013/04/04/notebook-parsing.html">Parsing linked data in the semantic notebook</a></li>
</ol>
<h3 id="planned">Planned</h3>
<ol style="list-style-type: decimal">
<li><a href="">Hashes: An immutable and verifiable record of research</a></li>
<li><a href="">Digital archiving</a></li>
<li><a href="">Readable, multi-device typography</a></li>
<li><a href="">Notebook analytics: Who reads this stuff anyway?</a></li>
<li><a href="">A fast, inexpensive, and scalable online platform</a></li>
<li><a href="">Online notebook essentials: link, tag, search</a></li>
<li><a href="">Integrating social networks with the notebook</a></li>
<li>…</li>
</ol>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/26/notebook-features-introduction.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/25/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 25 Apr 2013</p>

<p style="font-style:italic"> pageviews: 7 </p>

<article>
<div class="excerpt">
<ul>
<li>finish pmc post from Tuesday (done).<br /></li>
<li>Submit comment reply (done).</li>
</ul>
<h2 id="nonparametric-bayes">Nonparametric-bayes</h2>
<ul>
<li>Finishing up parametric vs nonparametric Bayes comparison runs</li>
<li>Need to add parametric Bayesian mean to the state-space diagram, fig 1</li>
<li>Compare with uniform priors on inverse standard deviations (precision)</li>
<li>Sensitivity analysis</li>
<li>mcmc convergence analysis for both Bayesian approaches</li>
<li>See allen.md example scripts in BUGS/, adapted to post soon</li>
</ul>
<h3 id="code-tricks">Code tricks</h3>
<p><strong>Plotting tricks</strong></p>
<ul>
<li>Selecting the order in the simulation legend requires declaring the model types as an ordered factor instead of a character,</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">dt$method =<span class="st"> </span><span class="kw">factor</span>(dt$method, <span class="dt">ordered=</span><span class="ot">TRUE</span>, <span class="dt">levels=</span><span class="kw">names</span>(OPT))</code></pre>
<p>and then set custom colors and match colors to the desired factor labels with <code>scale_colour_manual</code>, and override <code>alpha</code> for legends,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dt) +<span class="st"> </span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(time, fishstock, <span class="dt">group=</span><span class="kw">interaction</span>(reps,method), <span class="dt">color=</span>method), <span class="dt">alpha=</span>.<span class="dv">1</span>) +
<span class="st">    </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>)))</code></pre>
<ul>
<li>Avoid having density plots appear as crude polygons using <code>stat_density</code> instead of <code>geom_density</code> and set <code>geom</code> to path. Need a ymax (not clear why?) or set <code>position=&quot;identity&quot;</code> as shown,:</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(posteriors, <span class="kw">aes</span>(value)) +<span class="st"> </span><span class="kw">stat_density</span>(<span class="dt">geom=</span><span class="st">&quot;path&quot;</span>, <span class="dt">position=</span><span class="st">&quot;identity&quot;</span>, <span class="dt">alpha=</span><span class="fl">0.7</span>)</code></pre>
<ul>
<li><a href="https://gist.github.com/bluegraybox/1998129">initialize ssh-agent in .bashrc</a></li>
<li>Or for single session: <code>ssh-agent bash</code>, <code>ssh-add ~/.ssh/id_rda</code></li>
</ul>
<h3 id="misc">Misc</h3>
<ul>
<li>whoops, got into discussion of a fictional world of data publishing in the <a href="http://dynamicecology.wordpress.com/2013/04/08/selective-journals-vs-social-networks-alternative-ways-of-filtering-the-literature-or-po-tay-to-po-tah-to/#comment-15439">comments at dynamicecology</a></li>
<li>Speaking of <a href="http://dynamicecology.wordpress.com/2013/04/16/prioritizing-manuscripts-and-having-data-go-unpublished-for-lack-of-time">data publishing issues on dynamicecology</a>…</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/25/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/24/empirical-demonstration-of-that-clever-derivation.html">Empirical Demonstration Of That Clever Derivation</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 24 Apr 2013</p>

<p style="font-style:italic"> pageviews: 9 </p>

<article>
<div class="excerpt">
<p>Another unexpected gem from keeping an online notebook: Empirical evidence for the expected escape time problem! Getting to that in a moment….</p>
<p>After Marc pointed out to me that there is a clever analytic demonstration to back my claims about realized exit times being fast (posted earlier in my notebook under the title, <a href="http://carlboettiger.info/2013/04/05/a-clever-derivation-on-realized-escape-times.html">a clever derivation of realized escape times</a>, I’ve enjoyed a bit of a tangent in understanding this result that has long since been worked out by mathematicians but appears to be periodically rediscovered in ecological and evolutionary work in the most delightful ways.</p>
<p>For instance, <span class="showtooltip" data-html="true" title="Lande R (1985). &ldquo;Expected time for random genetic drift of a population between stable phenotypic states.&rdquo; ."><a href="http://www.pnas.org/content/82/22/7641.short" rel="http://purl.org/spar/cito/citesAsEvidence" >Lande (1985)</a></span> shows how this result can explain a pattern of punctuated equilibrium, such as sudden rapid jumps such as illustrated below in a simulation example from <a href="http://www.amazon.com/Perturbations-Dynamical-Grundlehren-mathematischen-Wissenschaften/dp/0387983627" rel="http://purl.org/spar/cito/citesAsAuthority" >Freidlin <em>et. al.</em> (1998)</a>, need not result from some external process but are in fact the most likely trajectories to be seen in a purely stochastic transition.</p>
<div class="figure">
<img src="http://farm9.staticflickr.com/8258/8684251521_124e51b5d3_o.png" alt="from Mangel 2006, Theoretical Biologist’s toolbox" /><p class="caption">from Mangel 2006, Theoretical Biologist’s toolbox</p>
</div>
<p>Ludwig (1975) considered this result in a more ecological context, addressing a variety of questions about persistence and coexistence that are naturally represented as hitting time problems as well. Note that the this result is interesting precisely in its contrast from the more familiar hitting time problems in that we focus on the time the realized trajectory actually takes to exit, rather than the waiting time until that exit occurs (e.g. the frequency of the transtions shown in the figure above).</p>
<p>These examples appear to be rediscoveries of particular cases that result more generally from the large deviation theory of Fiedlin and Wentzell, which states that the most likely path can be found by minimizing a variation equation (Hamiltonian, analgous to the minimizing action along paths in classical mechanics or the optimization under constraint of Jacobi-Bellman). For a system of discrete steps (e.g. births and deaths) in one dimension this is particularly trivial: the most likely path is the monotonic one (this should be easy to see by considering the likelihood of <span class="math">\(N\)</span> death events occuring in sequence vs that of <span class="math">\(N-1\)</span> death events interrupted by 1 birth and followed by 2 deaths.)</p>
<h2 id="empirical-demonstrations">Empirical demonstrations?</h2>
<p>Then an email to me earlier this week pointed out that perhaps an example of the phenomenon I discussed there had been demonstrated in <span class="showtooltip" data-html="true" title="Drake J and Griffen B (2009). &ldquo;Speed of Expansion And Extinction in Experimental Populations.&rdquo; Ecology Letters, 12, pp. 772&ndash;778. ISSN 1461023X."><a href="http://dx.doi.org/10.1111/j.1461-0248.2009.01325.x" rel="http://purl.org/spar/cito/citesAsEvidence" >Drake &amp; Griffen (2009)</a></span> :</p>
<blockquote>
<p>A testable, counter-intuitive prediction of stochastic population theory is that, on average, for any interior interval of the domain of biologically attainable population sizes, the expected duration of increase equals the expected duration of decline. Here we report the first empirical tests of this hypothesis.</p>
</blockquote>
<p>I do feel that this is an overstatement of the stochastic theory as I understand it – these times should only scale in a similar way, but can differ by an arbitrary coefficient. Indeed it is often the goal of the deviation theory analysis to determine this coefficent, see <span class="showtooltip" data-html="true" title="Faure M and Schreiber SJ (2011). &ldquo;Quasi-Stationary distributions for Randomly perturbed dynamical systems.&rdquo; ."><a href="http://arxiv.org/abs/1101.3420" rel="http://purl.org/spar/cito/citesAsAuthority" >Faure &amp; Schreiber (2011)</a></span> . The authors seem quite concerned that theory they refer to applies to continuously valued diffusion processes alone, whereas I’m quite certain the more general results of the deviation theory hold just as well in discrete systems. (Perhaps this explains why they do not confirm this prediction in some subset of the data). Nevertheless, the context is the same as we consider – comparing the return time to a stable point from some small population size with the time required to decline from that point to a small size, as clearly indicated in Figure 1 of the manuscript.</p>
<p>Commendably, the authors make the data and code available (as an R script and .Rdata file). (According to the manuscript, this data is at <a href="http://dragonfly.ecology.uga.edu/drakelab/data.html">http://dragonfly.ecology.uga.edu/drakelab/data.html</a>, but in an example of link rot and the risk of independent archiving the lab prefers daphnia to dragonfly, and the data can now be found: <a href="http://daphnia.ecology.uga.edu/drakelab/datapage.html">http://daphnia.ecology.uga.edu/drakelab/datapage.html</a>). These data draw on work from earlier experiments that provide some of the nicest sources of time series leading up to stochastic extinctions. Unfortunately it appears that only the duration of growth and extinction times for the replicates are shown in the data provided for this paper, I don’t see the actual timeseries themselves (which would be interesting to look at more closely).</p>
<h2 id="references">References</h2>
<ul>
<li>John M. Drake, Blaine D. Griffen, (2009) Speed of Expansion And Extinction in Experimental Populations. <em>Ecology Letters</em> <strong>12</strong> 772-778 <a href="http://dx.doi.org/10.1111/j.1461-0248.2009.01325.x">10.1111/j.1461-0248.2009.01325.x</a></li>
<li>Mark Freidlin, Alexander Wentzell, (1998) {Random Perturbations of Dynamical Systems (Grundlehren der mathematischen Wissenschaften)}. 429-NA <a href="http://www.amazon.com/Perturbations-Dynamical-Grundlehren-mathematischen-Wissenschaften/dp/0387983627">http://www.amazon.com/Perturbations-Dynamical-Grundlehren-mathematischen-Wissenschaften/dp/0387983627</a></li>
<li>R Lande, (1985) Expected time for random genetic drift of a population between stable phenotypic states. <em>Proceedings of the National Academy of Sciences</em> <a href="http://www.pnas.org/content/82/22/7641.short">http://www.pnas.org/content/82/22/7641.short</a></li>
<li>Mathieu Faure, Sebastian Schreiber, (2011) Quasi-Stationary distributions for Randomly perturbed dynamical systems. <em>arXiv.org</em> <a href="http://arxiv.org/abs/1101.3420">http://arxiv.org/abs/1101.3420</a></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/24/empirical-demonstration-of-that-clever-derivation.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/04/23/we-need-more-object-oriented-design-in-comparative-methods.html">We Need More Object Oriented Design In Comparative Methods</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 23 Apr 2013</p>

<p style="font-style:italic"> pageviews: 187 </p>

<article>
<div class="excerpt">
<p>The bad news is that the latest <a href="http://cran.r-project.org/web/packages/geiger/index.html">Geiger</a> version (which is much improved in all respects) breaks my little <a href="http://cran.r-project.org/web/packages/pmc/index.html">pmc</a> package, owing to changes in how <code>fitContinuous</code> output is structured. The good news is that the new geiger is much better than the old one, and that the pmc package is pretty trivial. So this should not be read as a complaint, but I think as a scientific developer community as a whole we could learn a few simple lessons here, which can help our code more reproducible and extensible.</p>
<p>Functions define the API, or <a href="http://en.wikipedia.org/wiki/Application_programming_interface">application programming interface</a>, of a package. Once a package has been released, developers are usually hesitant to change how a function call is made – what arguments it takes or what order they come in, since this would break any existing code. For the most part, the update is a good example of that, with minor exceptions – (for instance, a data.frame used to be a valid input to the <code>fitContinuous</code> <code>dat</code> argument, but now it must be a matrix). More problematic is the lack of an API in the original version of package for handling output objects. If you wanted to access the estimated value of the parameter <code>lambda</code> after running <code>fit &lt;- fitContinuous(phy, dat, model=&quot;lambda&quot;, ...)</code>, you would have needed to use <code>fit[[1]]$lambda</code>. Under the newer version of this function, such a call won’t work. Any code written to use the output of that function will not work either.</p>
<p>To avoid this kind of problem in the future, Jon has written the function <code>coef</code> which will extract the coefficients from the fit. For anyone starting to write packages, writing and using such extraction functions seems like an unnecessary hassle – after all it is often no faster to call the additional function than to just pull the data out of the return object yourself. But there is good reason to implement and use such methods. By drawing the data out using a function, it is possible to change the internal structure of the output without breaking the package API; without breaking code that depends on the package. In future, the <code>coef</code> function can just be similarly updated to point to the correct location for the model coefficients.</p>
<p>Better than providing just any function, the new <code>coef</code> and <code>logLik</code> functions are generic methods that can act on a wide range of model fits in R that return coefficients or log likelihoods. Just type <code>methods(&quot;coef&quot;)</code> in your R terminal after loading your commonly used libraries to see how many of them define such a function. Following the basic principle of object-oriented design, these generic function calls identify the class of object they are given, and figure out what method to use on that class. For instance, the list of stuff returned by <code>fitContinous</code> now has class <code>gcfit</code>, and a function <code>coef.gcfit</code> which the generic function <code>coef</code> uses to know where to find the coefficients in a <code>gcfit</code> object. Generic functions are particularly nice, since they allow us to write code that can deal with a wide variety of statistical fits without needing to know just how to perform those tasks. The pmc algorithm is a good example of this. Using the generics <code>simulate</code>, <code>update</code>, and <code>logLik</code>, we can write the algorithm as:</p>
<pre class="sourceCode r"><code class="sourceCode r">## Fit the original data using a function that returns an intelligent object &quot;fit&quot; which has methods &quot;simulate&quot;, &quot;update&quot;, and &quot;logLik&quot;
fit_A &lt;-<span class="st"> </span><span class="kw">my_fitting_function</span>(data, phy, model_pars_A, fitting_pars ...)
fit_B &lt;-<span class="st"> </span><span class="kw">another_fitting_function</span>(data, phy, model_pars_B, fitting_pars ...)

orig_LL &lt;-<span class="st"> </span><span class="kw">logLik</span>(fit_B) -<span class="st"> </span><span class="kw">logLik</span>(fit_A)

## 1000 Simulations under each model
A_sims &lt;-<span class="st"> </span><span class="kw">simulate</span>(fit_A, <span class="dv">1000</span>)
B_sims &lt;-<span class="st"> </span><span class="kw">simulate</span>(fit_B, <span class="dv">1000</span>)

## here are the four fits
AA &lt;-<span class="st"> </span><span class="kw">lapply</span>(A_sims, fit_A, update)
AB &lt;-<span class="st"> </span><span class="kw">lapply</span>(A_sims, fit_B, update)
BA &lt;-<span class="st"> </span><span class="kw">lapply</span>(B_sims, fit_A, update)
BB &lt;-<span class="st"> </span><span class="kw">lapply</span>(B_sims, fit_B, update)

## which create 2 distributions
null_dist =<span class="st"> </span><span class="kw">sapply</span>(AB, logLik) -<span class="st"> </span><span class="kw">sapply</span>(AA, logLik)
test_dist =<span class="st"> </span><span class="kw">sapply</span>(BB, logLik) -<span class="st"> </span><span class="kw">sapply</span>(BA, logLik)</code></pre>
<p>in which the exact same code could be used regardless of whether <code>my_fitting_function</code> was <code>brownie.lite</code>, <code>fitContinuous</code>, <code>fitDiscrete</code>, <code>hansen</code>, <code>OUwie</code>, any of the laser fns, etc etc, and <code>another_fitting_function</code> could be the same call with different parameters (e.g. call to <code>hansen</code> with a different painting) or a call to some other function entirely (e.g. <code>brownie.lite</code>). Instead, <code>OUCH</code> is the only one that does this, and it insists on using a different format for “data” and “phy” which makes it annoying to have it play nicely with other fitting routines.</p>
<p>The <code>pmc</code> package simply writes wrappers that will provide these generic methods to some of these functions. Because different packages (e.g. ouch, geiger) handle data differently, the wrappers must also be able to convert back and forth between these formats if we want to compare methods across different packages in this way. Though straight forward, it is not good practice to have the methods such as <code>simulate</code> and <code>update</code> provided in a different package than the actual fitting routines, but the number of package fitting methods continues to grow and I haven’t persuaded anyone to consider including such routines. With my postdoctoral work outside the area of phylogenetics, updating pmc each time is impractical. If packages provided such generic routines, code such as the above would work out of the box without the need for a specialized <code>pmc</code> package, which appears to make this very intuitive technique more opaque then necessary.</p>
<p>There are many other good statistical tests that could benefit from such methods (particularly simulation methods which could assist in many ways). I hope one day they may be more popular in our phylogenetics community.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/23/we-need-more-object-oriented-design-in-comparative-methods.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/19/bayesian-parametric-uncertainty-sdp.html">Bayesian Parametric Uncertainty Sdp</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 19 Apr 2013</p>

<p style="font-style:italic"> pageviews: 21 </p>

<article>
<div class="excerpt">
<p>Adapting the parametric uncertainty represented by the posterior distributions of the Bayesian estimate (see <a href="http://carlboettiger.info/2013/04/12/parametric-bayesian-example.html">earlier notes</a>) to the stochastic dynamic programming solution for the optimal policy. Simply requires evaluating the expectation over the distribution, but is computationally intensive given the spread and the three parameters.</p>
<pre class="sourceCode r"><code class="sourceCode r">f_transition_matrix &lt;-<span class="st"> </span>function(f, p, x_grid, h_grid, sigma_g, pardist){
  <span class="kw">lapply</span>(h_grid, par_F, f, p, x_grid, sigma_g, pardist)
}


par_F &lt;-<span class="st"> </span>function(h, f, p, x_grid, sigma_g, pardist, <span class="dt">n_mc =</span> <span class="dv">100</span>){
  
  <span class="co"># Set up monte carlo sampling </span>
  d &lt;-<span class="st"> </span><span class="kw">dim</span>(pardist)
  indices &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">runif</span>(n_mc,<span class="dv">1</span>, d[<span class="dv">1</span>]))
  
  <span class="co"># Compute the matrix</span>
  F_true &lt;-<span class="st"> </span>
<span class="st">    </span><span class="kw">sapply</span>(x_grid, function(x_t){           <span class="co"># For each x_t  </span>

      bypar &lt;-<span class="st"> </span><span class="kw">sapply</span>(indices, function(i){ <span class="co"># For each parameter value</span>
        p &lt;-<span class="st"> </span><span class="kw">unname</span>(pardist[i,<span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">5</span>)])    <span class="co"># parameters for the mean, at current sample </span>
        mu &lt;-<span class="st"> </span><span class="kw">f</span>(x_t,h,p)
        est_sigma_g &lt;-<span class="st"> </span>pardist[i,<span class="dv">2</span>]         <span class="co"># Variance parameter </span>

        if(<span class="kw">snap_to_grid</span>(mu,x_grid) &lt;<span class="st"> </span>x_grid[<span class="dv">2</span>]){ <span class="co"># handle the degenerate case </span>
          out &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(x_grid))
          out[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
          out
        } else {
          out &lt;-<span class="st"> </span><span class="kw">dlnorm</span>(x_grid/mu, <span class="dv">0</span>, est_sigma_g) 
        }
      })  
      ave_over_pars &lt;-<span class="st"> </span><span class="kw">apply</span>(bypar, <span class="dv">1</span>, sum) <span class="co"># collapse by weighted average over possible parameters    </span>
      ave_over_pars /<span class="st"> </span><span class="kw">sum</span>(ave_over_pars)
      })
  F_true &lt;-<span class="st"> </span><span class="kw">t</span>(F_true)
        
}


snap_to_grid &lt;-<span class="st"> </span>function(x, grid) <span class="kw">sapply</span>(x, function(x) grid[<span class="kw">which.min</span>(<span class="kw">abs</span>(grid -<span class="st"> </span>x))])   


<span class="co"># internal helper function</span>
rownorm &lt;-<span class="st"> </span>function(M) 
  <span class="kw">t</span>(<span class="kw">apply</span>(M, <span class="dv">1</span>, function(x){ 
    if(<span class="kw">sum</span>(x)&gt;<span class="dv">0</span>){
      x/<span class="kw">sum</span>(x)
    } else {
      out &lt;-<span class="st"> </span><span class="kw">numeric</span>(<span class="kw">length</span>(x))
      out[<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
      out
    }
  }))</code></pre>
<p>Run the Bayesian analysis to obtain posterior distributions for parameters.</p>
<h2 id="test-case-using-perturbed-parameters">Test case using perturbed parameters</h2>
<p>First, sanity test. Use the correct parameter values (slightly perturbed).</p>
<pre class="sourceCode r"><code class="sourceCode r">pardist &lt;-<span class="st"> </span>mcmcall
pardist[,<span class="dv">1</span>] =<span class="st"> </span>p[<span class="dv">2</span>] +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fl">0.000001</span>)
pardist[,<span class="dv">4</span>] =<span class="st"> </span>p[<span class="dv">1</span>] +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fl">0.000001</span>)
pardist[,<span class="dv">2</span>] =<span class="st"> </span>sigma_g +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fl">0.000001</span>)
pardist[,<span class="dv">5</span>] =<span class="st"> </span>p[<span class="dv">3</span>] +<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fl">0.000001</span>)</code></pre>
<p>Compute optimal policy</p>
<pre class="sourceCode r"><code class="sourceCode r">sdp =<span class="st"> </span><span class="kw">f_transition_matrix</span>(f, p, x_grid, h_grid, sigma_g, pardist)
s_opt &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(sdp, x_grid, h_grid, <span class="dt">OptTime=</span><span class="dv">1000</span>, xT, profit, delta)</code></pre>
<p>Compare to the case without parameter uncertainty (growth noise only)</p>
<pre class="sourceCode r"><code class="sourceCode r">SDP_Mat &lt;-<span class="st"> </span><span class="kw">determine_SDP_matrix</span>(f, p, x_grid, h_grid, sigma_g)
pars_fixed &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(SDP_Mat, x_grid, h_grid, <span class="dt">OptTime=</span><span class="dv">1000</span>, xT, profit, delta)</code></pre>
<p>Plot results</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(reshape2)
policies &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">stock=</span>x_grid, <span class="dt">pars.uncert =</span> x_grid[s_opt$D], <span class="dt">pars.fixed =</span> x_grid[pars_fixed$D]), <span class="dt">id=</span><span class="st">&quot;stock&quot;</span>)
<span class="kw">ggplot</span>(policies, <span class="kw">aes</span>(stock, stock -<span class="st"> </span>value, <span class="dt">color=</span>variable)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">alpha=</span><span class="dv">1</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;stock size&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;escapement&quot;</span>) </code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8247/8664808783_af5240ec6e_o.png" alt="plot of chunk unnamed-chunk-6" /><p class="caption">plot of chunk unnamed-chunk-6</p>
</div>
<h2 id="using-actual-estimates">Using actual estimates</h2>
<pre class="sourceCode r"><code class="sourceCode r">pardist &lt;-<span class="st"> </span>mcmcall</code></pre>
<p>Transform parameters back</p>
<pre class="sourceCode r"><code class="sourceCode r">pardist[,<span class="dv">4</span>] =<span class="st"> </span><span class="kw">exp</span>(pardist[,<span class="dv">4</span>])
pardist[,<span class="dv">5</span>] =<span class="st"> </span><span class="kw">exp</span>(pardist[,<span class="dv">5</span>])</code></pre>
<p>Compute optimal policy</p>
<pre class="sourceCode r"><code class="sourceCode r">sdp =<span class="st"> </span><span class="kw">f_transition_matrix</span>(f, p, x_grid, h_grid, sigma_g, pardist)
s_opt &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(sdp, x_grid, h_grid, <span class="dt">OptTime=</span><span class="dv">1000</span>, xT, profit, delta)</code></pre>
<p>Compare to the case without parameter uncertainty (growth noise only)</p>
<pre class="sourceCode r"><code class="sourceCode r">SDP_Mat &lt;-<span class="st"> </span><span class="kw">determine_SDP_matrix</span>(f, p, x_grid, h_grid, sigma_g)
pars_fixed &lt;-<span class="st"> </span><span class="kw">value_iteration</span>(SDP_Mat, x_grid, h_grid, <span class="dt">OptTime=</span><span class="dv">1000</span>, xT, profit, delta)</code></pre>
<p>Plot results</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(reshape2)
policies &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">stock=</span>x_grid, <span class="dt">pars.uncert =</span> x_grid[s_opt$D], <span class="dt">pars.fixed =</span> x_grid[pars_fixed$D]), <span class="dt">id=</span><span class="st">&quot;stock&quot;</span>)
<span class="kw">ggplot</span>(policies, <span class="kw">aes</span>(stock, stock -<span class="st"> </span>value, <span class="dt">color=</span>variable)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">alpha=</span><span class="dv">1</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;stock size&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;escapement&quot;</span>) </code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8264/8664820975_f29cc8d3be_o.png" alt="plot of chunk unnamed-chunk-11" /><p class="caption">plot of chunk unnamed-chunk-11</p>
</div>
<h2 id="to-do">To Do</h2>
<p>So far this is just a proof of principle example.</p>
<ul>
<li>Needs to be adjusted to account for uncertainty in the estimates of the noise processes as well.</li>
<li>Needs to be written as generic and documented functions, add to nonparametric-bayes package routines.</li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/19/bayesian-parametric-uncertainty-sdp.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/18/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 18 Apr 2013</p>

<p style="font-style:italic"> pageviews: 20 </p>

<article>
<div class="excerpt">
<h2 id="misc-coding">Misc coding</h2>
<ul>
<li><p>knitcitations handling of html formatting in tooltip: html inside the tag must needs be escaped. <a href="https://github.com/cboettig/knitcitations/issues/37">knitcitations/#37</a></p></li>
<li><p>pmc functions</p></li>
</ul>
<p>hmm.. how do we easily wrap a function such that it returns its arguments (given and default) in a named list (appropriate for <code>do.call(function_name, args_list)</code>)? <code>match.call()</code> inside the function will give the literal string of how the function was called, which, if evaluated in the same environment with same variables in working space, will return the same results, but doesn’t lend itself to updating any one of those arguments. Hoped to extract variable values with some combination of <code>formals</code> and <code>match.arg()</code> but no luck.</p>
<ul>
<li>Mendeley API authentication solved using <a href="https://github.com/michalboo/mendeley-oapi/blob/master/authorise.rb">Michal’s clever implementation for OAuth</a>, see my original query on <a href="http://stackoverflow.com/questions/15887366/obtaining-an-oauth-token-in-ruby-for-the-mendeley-api">SO</a></li>
</ul>
<h2 id="nonparametric-bayes">nonparametric-bayes</h2>
<ul>
<li>Implement the SDP calculation for the posterior distributions returned in the parametric comparison case <a href="https://github.com/cboettig/nonparametric-bayes/blob/795bf96ed92a708b44978610da7db3b49ebb4dce/inst/examples/BUGS/allen.Rmd">nonparametric-bayes/allen.Rmd</a>.<br /></li>
<li>Working out the integration over uncertainty for the parameter distribution. Brute force approach clearly doesn’t scale, even on coarse grid, to many parameters. After discussion with Marc, implementing as Monte Carlo instead. As we get samples from the posterior out of the BUGs fit in the first place, this is much more efficient. Should of tried that the first time. <a href="https://github.com/cboettig/nonparametric-bayes/blob/34922e969e984b5d695a5b53aee01aac1ea3b38e/inst/examples/BUGS/par_uncertainty_sdp.md">nonparametric-bayes/par_uncertainty_sdp.Rmd</a></li>
</ul>
<h2 id="warning-signals">warning-signals</h2>
<ul>
<li>Analytic calculation of eigenvalues for managed vs unmanaged system</li>
<li>finish fallacy reply</li>
<li>finish ews-review reply</li>
</ul>
<h2 id="geospatial-coordinates-from-plain-text">Geospatial coordinates from plain text</h2>
<p>Discussed the problem of geolocation from plain text discriptions with Simon a few days ago. I’ve written a simple i<a href="https://github.com/cboettig/sandbox/blob/29ab32342e9c07272b4796778cd86d518368b3b2/R-tricks/fishphotos.R">R function to query place names against the Google Map API</a>, but as Simon has demonstrated, this will often return the coordinates of a cafe in San Fransisco rather than the lake in Italy you meant to get. At DataCite 2011 I had met some folks who mentioned developing a machine learning algorithm for this, though stupidly it looks like I did not record this in my <a href="http://carlboettiger.info/2011/08/24/datacite-day-1.html">notes</a>. Oh well, Google turned up the following interface: <a href="http://geoparser.digmap.eu/advanced.jsp">http://geoparser.digmap.eu/advanced.jsp</a></p>
<p>Click the geoparse example and scroll down in the XML; they assign probabilities of possible spatial matches. For instance, Hiroshima as the name of a “railroad station” gets 0.05 probability, whereas the majority of the weight falls on “populated place” in Japan.</p>
<p>It looks like you could query against the service directly, haven’t really explored.</p>
<p>They have a paper out on this too, <a href="http://oa.upm.es/4367/1/INVE_MEM_2008_60075.pdf">http://oa.upm.es/4367/1/INVE_MEM_2008_60075.pdf</a></p>
<h2 id="reading">Reading</h2>
<ul>
<li><span class="showtooltip" data-html="true" title="<p>Shelton A, Satterthwaite W, Beakes M, Munch S, Sogard S and Mangel M (2013). “Separating Intrinsic And Environmental Contributions to Growth And Their Population Consequences.” The American Naturalist, pp. 000–000. ISSN 00030147.“&gt;<a href="http://dx.doi.org/10.1086/670198" rel="http://purl.org/spar/cito/discusses" >Shelton <em>et. al.</em> (2013)</a></span> provide a rather elegant example of how accounting for individual variation improves modeling efforts in growth dynamics.<br /></li>
<li><p>Measurement error is important but difficult to deal with; a proper state-space model should use all the replicates to estimate the measurement error process. <span class="showtooltip" data-html="true" title="<p>Knape J, Besbeas P and de Valpine P (2013). “Using Uncertainty Estimates in Analyses of Population Time Series.” Ecology, pp. 130417174952006–. ISSN 0012-9658.“&gt;<a href="http://dx.doi.org/10.1890/12-0712.1" rel="http://purl.org/spar/cito/critiques" >Knape <em>et. al.</em> (2013)</a></span> argue that you can do pretty well with just the standard errors from the replicates. – Um, but don’t we know this? We expect the central limit theorem to be pretty good a lot of the time. The demonstration that it can work is not quite as useful as a demonstration of when we might expect it not to; but my quick read may be missing something. Certainly an interesting point to wrestle with before going off the deep end with the state-space modeling each time…</p></li>
<li><p>Looking over an early draft of Duncan and Deborah’s “XML and Web Technologies for Data Sciences with R”. Looks fantastic – where was this 3 years ago?</p></li>
<li><p>Just launched: http://bison.usgs.ornl.gov (US only). Individual sample occurances, but no morphological measurements available.</p></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>Jonas Knape, Panagiotis Besbeas, Perry de Valpine, (2013) Using Uncertainty Estimates in Analyses of Population Time Series. <em>Ecology</em> 130417174952006-NA <a href="http://dx.doi.org/10.1890/12-0712.1">10.1890/12-0712.1</a></li>
<li>Andrew O. Shelton, William H. Satterthwaite, Michael P. Beakes, Stephan B. Munch, Susan M. Sogard, Marc Mangel, (2013) Separating Intrinsic And Environmental Contributions to Growth And Their Population Consequences. <em>The American Naturalist</em> 000-000 <a href="http://dx.doi.org/10.1086/670198">10.1086/670198</a></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/18/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row">
  <div class="span11 offset1">
    <div class="socialicons">
      <p> <a href="/archive.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
    </div>
  </div> <!--end span9 -->
</div> <!--end row -->




<footer class="footer">
  <!-- ************* Buttons to toggle theme CSS ********************** -->
    <div class="row">
      <div class="span12">
        <form style="font-size:10px" class="pull-right">
          <a onclick="switch_style('dark'); 
                      recordOutboundLink(this, 'Outbound Links', 'dark theme'); 
                      return false;" 
             name="theme" value="dark" id="dark" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to dark theme"><i class="icon-adjust"></i>
                                   </span></a>
          
          <a onclick="switch_style('light'); 
                      recordOutboundLink(this, 'Outbound Links', 'light theme'); 
                      return false;" 
             name="theme" value="light" id="light" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to light theme"><i class="icon-certificate"></i>
                                  </span></a>
        </form>
      </div>
    </div>

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="span3 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <a rel="foaf:account" alt="email" href="mailto:cboettig@gmail.com" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'email'); 
             return false;"><span class="showtooltip" title="email me"><i class="icon-envelope-alt"></i></span></a>
          <a rel="foaf:account" alt="twitter" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="icon-twitter"></i></span></a> 
          <a rel="foaf:account" alt="github" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="icon-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="icon-google-plus"></i></a>
          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" alt="mendeley" /></a> 
           citations on google-scholar
           stackoverflow
      -->
      <a alt="rss" type="application/atom+xml" href="/atom.xml"  
         class="showtooltip" title="subscribe to RSS feeds for my open lab notebook" 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="icon-rss"></i></a>
       </p>
    </div>
    <!--**************** End social links **************************** -->
    <div class="span1">
      <br />
    </div>
    <div class="span4">
      <p>
      <a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="http://onsclaims.wikispaces.com/file/view/ons-aci2-icon.png" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a>

      <a title="This site uses linked data semantics. Click to extract as RDF XML." class="btn btn-mini showtooltip" style="font-size: .8em" 
       href="http://any23.org/?format=rdfxml&validate=validate&uri=http://www.carlboettiger.info/lab-notebook.html"><i 
         class="icon-cloud-download"  onclick="recordOutboundLink(this, 'Outbound Links', 'RDF'); return false;"></i> RDF</a>
      </p>
    </div>
    <div class="span1">
      <br />
    </div>
    <div class="span3">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="http://i.creativecommons.org/l/zero/1.0/88x31.png" alt="CC0"/></a> 
      </p>
    </div>

  </div>
  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/lab-notebook.html">
  </span>



</footer>




    <!-- Le javascript
    ================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <!-- JQuery, used on a few pages -->
    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Tooltip javascript -->
    <script type="text/javascript">
      $(document).ready(function (){
        $(".showtooltip").tooltip();
      });
    </script>

    <!-- Marran's Search Javascript -->
    <script type="text/javascript" src="/assets/js/porter-stemmer.js"></script>
    <script type="text/javascript" src="/assets/js/site-search.js"></script>

    <!-- Code collapse Javascript -->
    <script type="text/javascript">
    $(document).ready(function(){
      $("#toggle_code").click(function(){
        $(".highlight").toggle();
        $(".sourceCode").toggle();
      });
    });
    </script>


  <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    


    </div>
  </body>
</html>


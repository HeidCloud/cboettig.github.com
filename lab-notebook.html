<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#">
  <meta http-equiv='Content-Type' content='text/html; charset=utf-8'/>
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  

<!-- Some liquid code so that pages get the site.time creation date 
      Would be nice to use github modified times, but doesn't handle 
      the path for pages -->







<!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="resource_type" content="website"/> 
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="2013-05-29T12:06:08-07:00" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="2013-05-29T12:06:08-07:00" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content="2013-05-29T12:06:08-07:00"/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>

<!--NOTE: see also the COinS Metadata in span element in footer -->




  <!-- CSS Stylesheets (toggled with javascript) -->
  <link href="/assets/css/bootstrap.css" rel="stylesheet" 
        type="text/css" title="white" />
  <link href="/assets/css/light.css" rel="alternate stylesheet"
        type="text/css" id="stl" title="light" />
  <link href="/assets/css/dark.css" rel="alternate stylesheet" 
        type="text/css" title="dark" />
  <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet" 
        type="text/css"/>
  <!-- Javascript needed for theme toggle, load immediately -->
  <script type="text/javascript" src="/assets/js/switch-css.js"></script>
  <script type="text/javascript">
    set_style_from_cookie(); 
  </script>
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    <!-- Navbar  ================================================== -->
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="/README.html"><i style="float:right;" class="icon-info-sign" alt="info"></i></span></a>
      <div class="nav-collapse">
        <ul class="nav">
          <li>
          <a href="/index.html">Home</a></li>

          <li>
          <a href="/vita.html">Vita</a></li>

          <li>
          <a href="/research.html">Research</a></li>

          <li>
          <a href="/teaching.html">Teaching</a></li>

          <li>
          <a href="/community.html">Community</a></li>

          <li class="active">
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>
      </div><!--/.nav-collapse -->

      <!-- Search site using Google's index -->
      <form class="navbar-search pull-right" method="get" action="http://google.com/search">
        <p>
          <input type="hidden" name="q" value="site:carlboettiger.info" />
          <input type="text" class="search-query" name="q" />
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      <!--
      <div id="search">
      <form method="get" class="navbar-search pull-right form-search">
        <p>
        <input type="text" name="search-text" id="search-text">
         <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      </div>
      -->
     </div> <!-- /container -->
   </div> <!-- /navbar-inner -->
 </div> <!-- /navbar -->



    <div class="container"> <!-- Responsive grid layout --> 

      <header class="jumbotron">
  <h1 class="entry-title">Lab Notebook</h1>
  <h3>(<a href="http://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h3>
</header>



<div class="row feed">
  <div class="span3 offset1">
    <h4>  <a property="account" href="https://github.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><i class="icon-github" alt="github"></i> Coding </a></h4> 
     <div class="excerpt">
        <ul><li>cboettig pushed to master at cboettig/cboettig.github.com: <em>update site</em> <a href="https://github.com/cboettig/cboettig.github.com/compare/78721cae63...10468fc428">07:05 2013/05/29</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>slides for adp section of group meeting updated adp-intro</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/5e3f3f5b00...094b44822a">06:44 2013/05/29</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>trouble with MCMC convergence for process-noise-only</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/722026ce11...5e3f3f5b00">06:01 2013/05/29</a></li><li>cboettig pushed to master at cboettig/cboettig.github.com: <em>update site</em> <a href="https://github.com/cboettig/cboettig.github.com/compare/b04d113102...78721cae63">05:01 2013/05/29</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>merge local edits</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/3b8832fd25...722026ce11">04:19 2013/05/29</a></li></ul>
    </div>
  </div>
  <div class="span3">
    <h4> <a property="account" href="https://twitter.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); return false;"><i class="icon-twitter"></i> Discussing </a></h4> 
     <div class="excerpt">
       <ul><li><p>Setting up Automated Reprint Requests in Gmail <a href="http://t.co/7WcBKf2E7q">http://t.co/7WcBKf2E7q</a> from @noamross</p>
 <a href="http://twitter.com/cboettig/statuses/339790402267799552">10:08 2013/05/29</a> </li><li><p>@davidjayharris MIT license is recognized by the Open Software Initiative; whom many consider the definitive word on what is &quot;Open Source&quot;</p>
 <a href="http://twitter.com/cboettig/statuses/339772032722026496">08:55 2013/05/29</a> </li><li><p>RT @kaveh1000: Recordings of &quot;Beyond the PDF 2&quot; conference on our page: <a href="http://t.co/TipUEDeuNZ">http://t.co/TipUEDeuNZ</a></p>
 <a href="http://twitter.com/cboettig/statuses/339762782117433344">08:18 2013/05/29</a> </li><li><p>nice: @xieyihui &#39;s paper on animated graphics in #Rstats out in JSS! <a href="http://t.co/SMyBizcB1L">http://t.co/SMyBizcB1L</a> (animate package)</p>
 <a href="http://twitter.com/cboettig/statuses/339762736818954241">08:18 2013/05/29</a> </li><li><p>Every time I am amazed at how fast and easy it is to upload my .tex document to #arXiv.  No extra .sty files, no 1980s tex only please. bam.</p>
 <a href="http://twitter.com/cboettig/statuses/339623109034405890">11:03 2013/05/28</a> </li></ul>
    </div> 
  </div> 
  <div class="span3">
    <h4> <a href="http://www.mendeley.com/groups/634301/theoretical-ecology/papers/" onClick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); return false;"><i class="icon-book"></i> Reading </a></h4> 
    <div class="excerpt">
      <ul><li>Signature of ocean warming in global fisheries catch: Nature (2013). Volume: 497, Issue: 7449. Pages: 365-368. William W. L. Cheung, Reg Watson, Daniel Pauly et al. <a href="http://www.mendeley.com/research/signature-ocean-warming-global-fisheries-catch-7/">04:38 2013/05/18</a></li><li>Incorporating uncertainty associated with habitat data in marine reserve design: Biological Conservation (2013). Pages: 41-51. Vivitskaia J. Tulloch, Hugh P. Possingham, Stacy D. Jupiter, Chris Roelfsema, Ayesha I.T. Tulloch, Carissa J. Klein et al. <a href="http://www.mendeley.com/research/author-s-personal-copy-incorporating-uncertainty-associated-habitat-data-marine-reserve-design/">04:38 2013/05/18</a></li><li>Innovations in capture fisheries are an imperative for nutrition security in the developing world: Proceedings of the National Academy of Sciences (2013). Pages: 1-6. S. J. Hall, R. Hilborn, N. L. Andrew, E. H. Allison et al. <a href="http://www.mendeley.com/research/innovations-capture-fisheries-imperative-nutrition-security-developing-world/">04:38 2013/05/18</a></li><li>Tipping Points and Biodiversity Change : Consequences for Human Wellbeing and Challenges for Science and Policy: Kent Uk et al.Published using Mendeley: The reference software for researchers <a href="http://www.mendeley.com/research/tipping-points-biodiversity-change-consequences-human-wellbeing-challenges-science-policy-draft-not/">07:19 2013/05/15</a></li></ul>
    </div>
  </div> 
</div>

<hr>
<div class="row postpreview">
  <div class="span11 offset1">
    <div class="row">
      <h4> <a href="http://www.carlboettiger.info/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="span3">
          <header><h4><a href="/2013/05/28/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 28 May 2013</p>

<p style="font-style:italic"> pageviews: (not calculated) </p>

<article>
<div class="excerpt">
<h2 id="mangel-group-talk">Mangel group talk</h2>
<ul>
<li>Presented nonparametric-bayes slides</li>
<li>ADP introduction / trouble-shooting (see yesterday’s entry), <a href="https://github.com/cboettig/nonparametric-bayes/blob/094b44822abb47b1145f0a0bb0ae2c8364bbee25/inst/mydeck/slides.html">html5 slides</a></li>
</ul>
<h3 id="notes">Notes</h3>
<ul>
<li>Decent convergence in the forward algorithm is hard. Consider basis function representation of value function to decrease the search space in the backwards-algorithm first. Also consider searching for policy function (under appropriate piecewise constraints).</li>
<li>Starts to sound more and more similar to POMDP</li>
</ul>
<h2 id="misc">Misc</h2>
<ul>
<li>Trouble with equations in <a href="https://github.com/ramnathv/slidify/issues/214">slidify/214</a></li>
<li><p>Finishing up posts from last week</p></li>
<li><p><strong><a href="http://osswatch.jiscinvolve.org/wp/2013/05/21/unlicensed-code-movement-or-madness/">On the lack of licenses on Github</a></strong></p></li>
</ul>
<p>R packages state licenses in the DESCRIPTION file, which automatically recognizes standard licenses rather than distributing a copy of the license. This seems sensible but it’s not like we don’t have a few bits to spare for a million duplicate copies of license files, so I suppose I could add this in explicitly.</p>
<p>Clearly my own thinking on licenses has evolved ahead of my adaptation:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">grep</span> <span class="st">&quot;License&quot;</span> code/*/DESCRIPTION

AdaptiveDynamics/DESCRIPTION:License: GPL <span class="kw">(&gt;</span>= 2<span class="kw">)</span>
earlywarning/DESCRIPTION:License: BSD
fluctuationDomains/DESCRIPTION:License: CC ZERO 1.0 + <span class="kw">file</span> LICENSE
knitcitations/DESCRIPTION:License: CC0
mcmcTools/DESCRIPTION:License: BSD
multiple_uncertainty/DESCRIPTION:License: BSD
nonparametric-bayes/DESCRIPTION:License: BSD
OUwie/DESCRIPTION:License: GPL <span class="kw">(&gt;</span>= 2<span class="kw">)</span>
pdg_control/DESCRIPTION:License: BSD
pmc/DESCRIPTION:License: CC0
populationdynamics/DESCRIPTION:License: BSD
prosecutors-fallacy/DESCRIPTION:License: BSD
socialR/DESCRIPTION:License: GPL <span class="kw">(&gt;</span>= 2<span class="kw">)</span>
structured-populations/DESCRIPTION:License: GPL <span class="kw">(&gt;</span>= 3<span class="kw">)</span>
warningsignals/DESCRIPTION:License: GPL <span class="kw">(&gt;</span>= 2<span class="kw">)</span>
wrightscape/DESCRIPTION:License: GPL-2</code></pre>
<p>Looks like it’s time for a little</p>
<pre><code>sed -i &quot;s/License: .*/License: CC0/&quot; */DESCRIPTION</code></pre>
<p>Yeehaw!</p>
<p>Just for the sake of being pendantic,</p>
<pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">wget</span> http://creativecommons.org/publicdomain/zero/1.0/legalcode.txt
<span class="kw">mv</span> legalcode.txt LICENSE
<span class="kw">echo</span> */R/.. <span class="kw">|</span> <span class="kw">xargs</span> -n 1 <span class="kw">cp</span> LICENSE </code></pre>
<h3 id="rcurl-query-from-scott">RCurl query from Scott</h3>
<p>Translate a cURL command’s <code>-d</code> flag to RCurl, e.g.</p>
<pre class="sourceCode bash"><code class="sourceCode bash">curl -H <span class="st">&quot;X-Gauges-Token: &lt;token&gt;&quot;</span> <span class="kw">\</span>
     -d <span class="st">&quot;title=Example&quot;</span> <span class="kw">\</span>
     -d <span class="st">&quot;tz=Eastern Time (US %26 Canada)&quot;</span> <span class="kw">\</span>
     https://secure.gaug.es/gauges</code></pre>
<p>I proposed</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">httpPOST</span>(<span class="st">&quot;https://secure.gaug.es/gauges&quot;</span>, 
         <span class="dt">postfields=</span><span class="st">&quot;title=Example&amp;tz=Eastern Time (US %26 Canada)&quot;</span>, 
         <span class="dt">httpHeader=</span><span class="kw">c</span>(<span class="st">&quot;X-Gauges-Token&quot;</span>=<span class="st">&quot;&lt;token&gt;&quot;</span>), <span class="dt">verbose=</span><span class="ot">TRUE</span>)</code></pre>
<p>Though here is an <a href="http://stackoverflow.com/questions/12302941/">SO example</a> with slightly more elegant construction of postfields.</p>
<h2 id="two-column-layout-with-longtable">Two column layout with <code>longtable</code></h2>
<p>Pandoc now uses the <code>longtable</code> package to generate tables. Annoyingly, these insist on being single-column objects and are not handled properly by <code>elsarticle</code> two-column layouts. To get around this, I edit the latex Pandoc creates, wrapping the table in a float environment (<code>\begin{figure}</code>), followed by a toggle to <code>\onecolumn</code>. After the <code>longtable</code> envirnoment block ends, I include the caption, then toggle back to <code>\twocolumn</code> layout. I also have to tune the width of the <code>minipage</code> objects used by <code>longtable</code>, and change its alignment option to left-align (<code>\begin{longtable}[l]</code>). After these modifications I have a nice floating table in the width of a single column, embedded in my two-column layout.</p>
<p>Brilliantly, arXiv has no trouble with the scores of extra package dependencies introduced by pandoc, as long as the document is pdflatex compatible (no xelatex, hence non-ascii UTF-8, or custom fonts, sorry). Still far ahead of my experience submitting the same document to the acutal journal…</p>
<p>This nicely formatted tex is in the repository as <a href="">arxiv-copy.tex</a>. Should be generated from source with <code>make fancy</code>, since default <code>make</code> builds the 1980s plaintex format for the journal. I need to add make commands to automatically wrap the longtable as described above, hopefully a few lines of <code>sed</code> should do this…</p>
<p>So, arXiv copy sumbmitted… stay tuned on Thursday.</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/28/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/27/exploring-approximate-dynamic-programming-approaches.html">Exploring Approximate Dynamic Programming Approaches</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 27 May 2013</p>

<p style="font-style:italic"> pageviews: (not calculated) </p>

<article>
<div class="excerpt">
<h2 id="introductory-examples-in-approximate-dynamic-programming">Introductory examples in approximate dynamic programming</h2>
<p><em>Based on Powell 2006, page 97. I try to conform to that notation throughout</em>. Haven’t really figured this out yet, so this is more a walk through of me thinking this out then a tutorial. My active copy of this analysis can be found in the <a href="https://github.com/cboettig/nonparametric-bayes/blob/4eb6a30441f28e9cbe87690d9e098b0e068cc395/inst/examples/adp-intro.md">adp-intro</a> file of my nonparametric-bayes repo, see there for the <a href="https://github.com/cboettig/nonparametric-bayes/blob/master/inst/examples/adp-intro.md">most recent</a> (or earlier) versions.</p>
<h2 id="setup-my-sample-problem">Setup my sample problem</h2>
<p>First we define the Beverton-Holt stock-recruitment relationship as a function of stock size <code>x</code>, harvest <code>h</code> and parameters <code>p</code></p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;- function(x, h, p){
    A &lt;- p[<span class="dv">1</span>] 
    B &lt;- p[<span class="dv">2</span>] 
    s &lt;- <span class="kw">pmax</span>(x-h, <span class="dv">0</span>)
    A * s/(<span class="dv">1</span> + B * s)
}
p &lt;- pars &lt;- <span class="kw">c</span>(<span class="fl">1.5</span>, <span class="fl">0.5</span>)
K &lt;- (p[<span class="dv">1</span>] - <span class="dv">1</span>)/p[<span class="dv">2</span>]
sigma_g &lt;- <span class="fl">0.2</span></code></pre>
<p>We begin with a simulation method <span class="math">\(X_{t+1} = f(X_t, Z_t)\)</span>. For illustration, let us consider <span class="math">\(f(X_t, Z_t) = Z_t \frac{a X_t}{b + X_t}\)</span> with a = 1.5 and b = 0.5. We define a statespace <span class="math">\(S\)</span></p>
<pre class="sourceCode r"><code class="sourceCode r">S &lt;- <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length=</span><span class="dv">11</span>) </code></pre>
<p>as a uniform grid of 11 points from 0 to 1.<br />We also need a value function on the state space, <span class="math">\(C_t(S_t)\)</span>. For simplicity, we set the price of harvest at unity and the cost of harvesting at zero, so that <span class="math">\(C_t(S_t, x_t) = \min(x_t, S_t)\)</span>.<br />(<span class="math">\(C_t\)</span> is sometimes denoted <span class="math">\(\mathbb{\Pi}\)</span>).<br />We also need an action space <span class="math">\(\chi_t\)</span> of possible harvest values.<br />Again for simplicity we assume that harvest can be set to any possible state size, <span class="math">\(\chi_t \equiv S_t\)</span>,</p>
<pre class="sourceCode r"><code class="sourceCode r">chi &lt;- S</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">T &lt;- <span class="dv">10</span>
N &lt;- <span class="dv">10</span></code></pre>
<p>The approximate dynamic programming algorithm will perform a finite number <span class="math">\(N\)</span> = 10 iterations over a window of time <span class="math">\(T\)</span> =10 in our example. The algorithm can then be described as follows:</p>
<h2 id="algorithm-1">Algorithm (1)</h2>
<ul>
<li><p><strong>Step 0</strong></p></li>
<li><p>Initialize some value <span class="math">\(\tilde V_t^0(S_t)\)</span> for all states <span class="math">\(S_t\)</span>, where the superscripts denote iterations in the forward approximation.<br /> As we know absolutely nothing yet to base our initial guess on, we just arbitrarily set this to zero.</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">V &lt;- <span class="kw">numeric</span>(<span class="kw">length</span>(S))</code></pre>
<ul>
<li>Choose some initial state <span class="math">\(S_0^1\)</span> We start at some initial state for <span class="math">\(n = 1\)</span> (superscript) and <span class="math">\(t = 0\)</span> (subscript). The choice of initial condition may come from the problem itself, otherwise we choose something arbitrarily.</li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">S_0 &lt;- <span class="fl">0.5</span></code></pre>
<ul>
<li><p>Set <span class="math">\(n = 1\)</span></p></li>
<li><p><strong>Step 1</strong>: Choose a sample path, <span class="math">\(\omega^n\)</span> (a vector of random draws)</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r">sigma &lt;- <span class="fl">0.2</span>
omega_n &lt;- <span class="kw">rlnorm</span>(T, <span class="dv">0</span>, sigma)</code></pre>
<ul>
<li><p><em>* Step 2</em>*: For <span class="math">\(t = 0, 1, 2, \ldots, T\)</span>, do:</p></li>
<li><p>Solve:</p></li>
</ul>
<p><span class="math">\[V_t(S_t) = \max_{x_t \in \chi_t} \left(C(S_t, x_t) + \gamma \sum_{s^{\prime} \in \mathcal{S}} \mathbb{P}(s^{\prime} | S_t^n, x_t) V_{t+1}^{n-1} s^{\prime} \right)\]</span></p>
<p>That is, choose action <span class="math">\(x_t\)</span> that maximizes the value of the next step.</p>
<p>Let’s start with <span class="math">\(t=0\)</span>, <span class="math">\(n=1\)</span> and fix an <span class="math">\(x_0\)</span> from the set of <span class="math">\(\chi\)</span> (allowing the action space to be the same in each period, we can omit the subscript on <span class="math">\(\chi\)</span>) to get started. We first compute <span class="math">\(C(S_0, x_0)\)</span>.</p>
<p><span class="math">\(S_0 = S_0^1\)</span> which we fixed in step <strong>0b</strong> arbitrarily at 0.5.</p>
<p>The profits/costs <span class="math">\(C(S_t, x_t)\)</span> are the value derived by action (harvest) <span class="math">\(x_t\)</span> at state (stock) <span class="math">\(S_t\)</span>. Assuming a fixed price and no costs to harvesting, this is just whichever number is smaller (since we cannot harvest more than the available stock,</p>
<pre class="sourceCode r"><code class="sourceCode r">C &lt;- function(S, X) <span class="kw">pmin</span>(S, X)</code></pre>
<p>(where we have used R’s vectorized form of the min function).</p>
<p>This forward dynamic programming will still rely on the one-step transition matrix, <span class="math">\(\mathbb{P}\)</span>.</p>
<p>Let’s get the transition matrices for this problem, assuming log-normal noise,</p>
<pre class="sourceCode r"><code class="sourceCode r">sdp_matrix &lt;- <span class="kw">determine_SDP_matrix</span>(f, p, <span class="dt">x_grid=</span>S, <span class="dt">h_grid=</span>chi, sigma_g)</code></pre>
<p>Which is a list of matrices, one for each harvest (action) <span class="math">\(x_t\)</span>.</p>
<p>Then we want to consider a fixed <span class="math">\(S_t^n\)</span> and fixed <span class="math">\(x_t\)</span>, and take the sum of <span class="math">\(\mathbb{P}(s^{\prime} | S_t^n, x_t)\)</span> over the <span class="math">\(s^{\prime}\)</span>, which means we want the <span class="math">\(x_t\)</span> element from the list, and then we need sum over the distribution of future states given the current state <span class="math">\(S_t^n\)</span>, e.g. a row of the matrix, e.g. <code>sdp_matrix[[x]][s,]</code>, which we (vector) multiply by <span class="math">\(V_{t+1}^{n-1}(s^{\prime})\)</span>.</p>
<p>This value <span class="math">\(V\)</span> is of course unknown, other than our initial random guess <span class="math">\(V_{t}^0\)</span>.<br />As we step through the iterations <span class="math">\(V_t^1\)</span>, <span class="math">\(V_t^2\)</span>, <span class="math">\(V_t^3\)</span>, etc., this should convgerge to something meaningful.</p>
<p>Note that the index along <span class="math">\(S\)</span> corresponding to <span class="math">\(S_t^n\)</span> is given by</p>
<pre class="sourceCode r"><code class="sourceCode r">s &lt;- <span class="kw">which.min</span>(<span class="kw">abs</span>(S-S_0))</code></pre>
<p>So our maximization across <span class="math">\(x\)</span> just involves:</p>
<pre class="sourceCode r"><code class="sourceCode r">values &lt;- 
  <span class="kw">sapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(chi), function(x)
    <span class="kw">C</span>(S[s], chi[x]) + sdp_matrix[[x]][s,] %*% V
)

max_x &lt;- <span class="kw">which.max</span>(values)
v_hat &lt;- <span class="kw">max</span>(values)</code></pre>
<p>Trivially, this is just the harvest level that maximizes <span class="math">\(C\)</span> so far (which is just harvesting the <span class="math">\(S_0\)</span>, since <span class="math">\(\bar V^0_t\)</span> begins at zero:</p>
<pre class="sourceCode r"><code class="sourceCode r">chi[max_x]</code></pre>
<pre><code>[1] 0.5</code></pre>
<ul>
<li>step <strong>2b</strong> We can now update our <span class="math">\(\bar V^0_t\)</span> to get <span class="math">\(\bar V^1_t\)</span>, using the rule:</li>
</ul>
<p><span class="math">\[V_t^n(S_t) = \begin{cases} 
\hat v_t^n &amp; S_t = S_t^n \\
\bar V_t^{n-1}(S_t) &amp; \textrm{otherwise} 
\end{cases}\]</span></p>
<p>e.g. use our maximum value for the case of the state we just considered <span class="math">\(S_t = S_t^n\)</span>, otherwise leave <span class="math">\(V_t\)</span> unchanged. Our new <span class="math">\(V\)</span> is thus:</p>
<pre class="sourceCode r"><code class="sourceCode r">V[s] = v_hat</code></pre>
<ul>
<li>step <strong>2c</strong> Compute <span class="math">\(S^n_{t+1} = S^M(S_t^n, x^n_t, W_{t+1}(\omega^n))\)</span></li>
</ul>
<p>We compute the next state using our <code>max_x</code> for <span class="math">\(x^n_t\)</span>, our random samples and the transition function…</p>
<pre class="sourceCode r"><code class="sourceCode r">S_1 &lt;- omega_n[<span class="dv">1</span>] * <span class="kw">f</span>(S_0, chi[hat[<span class="st">&quot;x_nt&quot;</span>]], p)</code></pre>
<ul>
<li><strong>Step 3</strong> Let <span class="math">\(n = n+1\)</span>. if <span class="math">\(n &lt; N\)</span>, go to step 1</li>
</ul>
<h2 id="putting-this-all-together-as-a-recursive-algorithm">Putting this all together as a recursive algorithm</h2>
<pre class="sourceCode r"><code class="sourceCode r">N &lt;- <span class="dv">5000</span> <span class="co"># iterations</span>
M &lt;- <span class="dv">20</span> <span class="co"># gridsize </span>
Tmax &lt;- <span class="dv">5</span> <span class="co"># Time horizon</span>

gamma &lt;- <span class="fl">0.95</span> <span class="co"># Discount</span>
<span class="co"># f (defined above) </span>
<span class="co"># p  (defined above)</span>

sigma_g &lt;- <span class="fl">0.5</span> <span class="co"># larger variation in random draws helps</span>
chi &lt;- <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> M)
S &lt;- <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">length.out =</span> M)

sdp_matrix &lt;- <span class="kw">determine_SDP_matrix</span>(f, p, <span class="dt">x_grid=</span>S, <span class="dt">h_grid=</span>chi, sigma_g)

V &lt;- <span class="kw">matrix</span>(<span class="dv">1</span>, M, Tmax)  <span class="co"># A* strategy</span>
<span class="co"># Fails to explore at matrix(0, M, Tmax)</span>
<span class="co"># consider: # V &lt;- matrix(rep(chi, Tmax), nrow=M) # </span>
<span class="co"># V[,1] &lt;- chi   # fails to explore if it doesn&#39;t have at least some non-zero values</span>

C &lt;- function(S, X) <span class="kw">pmin</span>(S, X)
S_0 &lt;- <span class="fl">0.5</span> 
alpha &lt;- <span class="dv">1</span> <span class="co"># learning rate</span>


for(n in <span class="dv">1</span>:N){
  
  omega_n &lt;- <span class="kw">rlnorm</span>(Tmax, <span class="dv">0</span>, sigma_g)
  S_current &lt;- S_0 <span class="co">#runif(1,0,1) # explores faster when this is random</span>

  for(t in <span class="dv">1</span>:Tmax){
    <span class="co"># index of the state we&#39;re considering</span>
    s &lt;- <span class="kw">which.min</span>(<span class="kw">abs</span>(S-S_current)) 
    
    <span class="co"># Find the action maximizing the value</span>
    values &lt;- <span class="kw">sapply</span>(<span class="dv">1</span>:<span class="kw">length</span>(chi), function(x)
      <span class="kw">C</span>(S[s], chi[x]) + gamma * sdp_matrix[[x]][s,] %*% V[,t])
    hat &lt;-  <span class="kw">c</span>(<span class="dt">x_nt =</span> <span class="kw">which.max</span>(values), <span class="dt">v_nt =</span> <span class="kw">max</span>(values))

    <span class="co"># Update value V as mixture of new value and previous value</span>
    V[hat[<span class="st">&quot;x_nt&quot;</span>], t] &lt;- (<span class="dv">1</span> - alpha) * V[hat[<span class="st">&quot;x_nt&quot;</span>],t] + alpha * hat[<span class="st">&quot;v_nt&quot;</span>] 
    
    <span class="co"># Advance the state in time along random path  </span>
    S_current &lt;- omega_n[t] * <span class="kw">f</span>(S_current, chi[hat[<span class="st">&quot;x_nt&quot;</span>]], p)

  }
}</code></pre>
<p>for comparison: the SDP solution</p>
<pre class="sourceCode r"><code class="sourceCode r">opt &lt;- <span class="kw">find_dp_optim</span>(sdp_matrix, S, chi, <span class="dv">70</span>, <span class="fl">0.5</span>, C, <span class="dv">1</span>-gamma, <span class="dt">reward=</span><span class="dv">0</span>)
opt$V</code></pre>
<pre><code> [1] 0.000 7.173 7.375 7.496 7.584 7.653 7.710 7.760 7.810 7.860 7.910
[12] 7.960 8.010 8.060 8.110 8.160 8.210 8.260 8.310 8.360</code></pre>
<h3 id="problems-arising-from-the-discretization">Problems arising from the discretization</h3>
<p>Note that after the first iteration, <span class="math">\(n=1\)</span>, the value matrix <span class="math">\(V\)</span> is no longer all zeros. There is a single state, <span class="math">\(S = S_0 =\)</span> 0.5, at which we have value. That value is lost if we set harvest <span class="math">\(x\)</span> too high, since we know we will not then end up in that state – from whence comes the incentive to consider future value. Unfortunately, the value exists only if we hit that state exactly – all other states are assumed to have zero value still.</p>
<h3 id="additional-problems">Additional problems</h3>
<p>We no longer have the loop-over-all-states problem, but we face several new or remaining issues:</p>
<ol type="1">
<li><p>We still require the use of the one-step transition matrix, with the equally troublesome sum over all states <span class="math">\(\sum_{s^{\prime}\in S} \mathbb{P}(s^{\prime} | S_t^n, x_t)\)</span>.<br />We will fix this by approximating the transitions in step 2b using random draws as well.</p></li>
<li><p>We only update the values of states we visit. We still need a way to estimate the value of states we have not visited.</p></li>
<li><p>Worse, we might not visit states that seem bad relative to states we have visited. This is particularly atrocious in this example. Since we initialize the value of all states at 0, the algorithm prefers to harvest all stock from the current state rather than risk a transition into a state starting at 0. There is no convergence guarentee that we will ever escape this cycle of avoiding states we have not seen. We can alter the initial guess of the value of course, and we could alter the starting condition to better explore.</p></li>
</ol>
<h2 id="extensions">Extensions</h2>
<p>The rest of the ADP development is designed to tackle each of these issues. This algorithm gives very poor performance, but very flexible skeleton on which to extend features that have made ADP such a successful approach for impossibly large problems.</p>
<h3 id="stochastic-value-function-sampling">Stochastic value function sampling</h3>
<p>Dealing with problem 1:</p>
<p><span class="math">\[V_t(S_t) = \max_{x_t \in \chi_t} \left(C(S_t, x_t) + \gamma \sum_{\hat \omega \in \hat \Omega^n_{t+1}} p_t+1(\hat \omega) \bar V_{t+1}^{n-1} (S_{t+1}) \right)\]</span></p>
<pre class="sourceCode r"><code class="sourceCode r">    V[hat[<span class="st">&quot;x_nt&quot;</span>], t] &lt;- (<span class="dv">1</span> - alpha) * 
                         V[hat[<span class="st">&quot;x_nt&quot;</span>],t] + 
                          alpha * hat[<span class="st">&quot;v_nt&quot;</span>] </code></pre>
<h3 id="decreasing-the-state-space-size">Decreasing the state space size</h3>
<ul>
<li>Aggregation</li>
<li>Continuous Value function approximations</li>
<li>Using the post-decision state variable (improves dealing with the expectation calc)</li>
</ul>
<h3 id="initialization-problem">Initialization problem</h3>
<ul>
<li>We do not explore if we are too pessimistic about value of visiting other states. Start optimisitc: AI’s A* alogrithm (synchronous)</li>
<li>Asynchronous updating – randomly sampling starting variables</li>
<li>RTDP (Real Time Dynamic Programming – not necessarily what it sounds like) external rule determines which states we visit</li>
</ul>
<h3 id="learning">Learning</h3>
<ul>
<li>The concepts of learning and the trade-off between exploration and exploitation are already built-in to the forward algorithm.</li>
</ul>
<h3 id="using-non-stochastic-transition-information-only-step-2b-can-be-written-as">Using Non-stochastic transition information only, step <strong>2b</strong> can be written as:</h3>
<p>Taking <span class="math">\(x_0\)</span> as the smallest harvest, <span class="math">\(\min(\chi)\)</span> = 0 and evaluating <span class="math">\(C(S_0,X_0) = \min(S_0, X_0)\)</span> gives us 0, rather trivially.<br />The next terms depend on the value <span class="math">\(\tilde V^0_1(s^{\prime})\)</span> for all <span class="math">\(s^{\prime} \in S\)</span>, which we have no idea about. Fortunately we have assumed a value for each of these in step 0a.</p>
<p>We must also come up with some values for the probability <span class="math">\(\mathbb{P}(s^{\prime} | S_1^0, x_1)\)</span> for each state, given our current state <span class="math">\(S_1^0\)</span> and considered action <span class="math">\(x_1\)</span>. This is more straight forward, since it is determined by our one-step transition function (without simulation - recall that the single step transition is given exactly).</p>
<p>To do so, we evaluate the argument for each value in our action space, <span class="math">\(x_t \in \chi_t\)</span>,</p>
<pre class="sourceCode r"><code class="sourceCode r">s &lt;- S_0
C &lt;- function(S, X) <span class="kw">pmin</span>(S, X)
arg &lt;- <span class="kw">sapply</span>(chi, function(x) <span class="kw">C</span>(s, x) + <span class="kw">f</span>(S, x, p) %*% V)
x_nt = <span class="kw">which.max</span>(arg)
v_nt = <span class="kw">max</span>(arg)
V[x_nt] = v_nt</code></pre>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/27/exploring-approximate-dynamic-programming-approaches.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/24/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 24 May 2013</p>

<p style="font-style:italic"> pageviews: 4 </p>

<article>
<div class="excerpt">
<h3 id="prosecutor">prosecutor</h3>
<ul>
<li>Bit more writing on comment reply. Sent to Alex and Alan for feedback.</li>
</ul>
<h3 id="nonparametric-bayes">nonparametric-bayes</h3>
<p>Demonstrating robustness of the GP approach is remarkably difficult ironically because the comparison methods are not particularly robust; most often due to poor initial conditions. Doing all I can to make the MLE and parametric Bayesian cases suitably automated such that the can give reasonable performance as I loop over various simulation parameters and models without much hand-holding of each of the estimators.</p>
<p>Also an automatic sensitivity analysis gets pretty computationally intensive and generates a lot of different outputs to keep track of, trying to improve this through cleaner code, parallelization, caching, chunk dependencies, and namespaces for scripts.</p>
<ul>
<li>Playing with mcmc convergence over initial conditions</li>
<li>Running case without measurement error for parametric bayesian models</li>
<li>Adaptuing runs for parallel and for execution on farm cluster</li>
<li>Consider ADMB for the MLE estimate to be a bit more robust for automated cases.</li>
</ul>
<h3 id="log">Log</h3>
<ul>
<li>process noise only example (first attempt) <a href="https://github.com/cboettig/nonparametric-bayes/commit/be4d986b46f98d27f19add3ac42e536ee4ef5805">04:50 pm 2013/05/24</a></li>
<li>Consider the case of process noise only in the parametric bayesian versions <a href="https://github.com/cboettig/nonparametric-bayes/commit/bbeaf4fc6b5f999e04d02b3487151c982bcf6771">03:38 pm 2013/05/24</a></li>
<li>parallel jags <a href="https://github.com/cboettig/nonparametric-bayes/commit/29db77699a8ff6b9041f45a952a548b6cd255af3">03:31 pm 2013/05/24</a></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/24/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/05/23/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 23 May 2013</p>

<p style="font-style:italic"> pageviews: 2 </p>

<article>
<div class="excerpt">
<ul>
<li>Added multiple chains, randomized starting points for each chain, and confirming Gelman-Rubin convergence criteron via <code>autojags</code>.<br /></li>
<li>Some edits to adapt the extraction of posteriors from the multiple chains.<br /></li>
<li>Stange behavior in <code>jags.parallel</code> <a href="http://stackoverflow.com/questions/16723036">SO/16723036</a>, looks like an annoying bug.</li>
<li>Ah-ha, and now a nice solution to this problem via <code>do.call</code>.</li>
</ul>
<p>When running on farm, try to remember: (yes it’s in the run.sh script already).</p>
<pre class="sourceCode bash"><code class="sourceCode bash">module load <span class="kw">gcc</span> R jags</code></pre>
<p>This appears to result in greater uncertainty:</p>
<figure>
<img src="http://farm4.staticflickr.com/3826/8797217705_c75548ffa7_o.png" />
</figure>
<p>Suggesting the earlier appearance of convergence occurs only thanks to starting conditions close to the optimum?</p>
<h2 id="log">Log</h2>
<ul>
<li>parallel jags working now <a href="https://github.com/cboettig/nonparametric-bayes/commit/92a1d8d6a1fba819f419d069b0a089da891041e7">05:53 pm 2013/05/23</a></li>
<li>cleanup <a href="https://github.com/cboettig/nonparametric-bayes/commit/e5d76a0718997c215521beb4cbba740b42ff3791">04:50 pm 2013/05/23</a></li>
<li>generic version of allen <a href="https://github.com/cboettig/nonparametric-bayes/commit/669245f2e39839e06cdf58e290b22b783eb08aad">04:09 pm 2013/05/23</a></li>
<li><p>Revising MCMC iterations</p></li>
<li>Added multiple chains, randomized starting points for each chain, and confirming Gelman-Rubin convergence criteron via <code>autojags</code>.</li>
<li>Some edits to adapt the extraction of posteriors from the multiple chains.</li>
<li>Stange behavior in <code>jags.parallel</code> <a href="http://stackoverflow.com/questions/16723036">SO/16723036</a>, looks like an annoying bug. <a href="https://github.com/cboettig/nonparametric-bayes/commit/98b6a58bca43fe25ab0224d582f18a820ac5c57e">04:05 pm 2013/05/23</a></li>
<li><p>No reply from query to package maintainer, but the SO link now has a clever work-around to said annoying bug.</p></li>
</ul>
<h2 id="misc">Misc</h2>
<ul>
<li>Grr, why is <code>dcast</code> not more intuitive to me. Thank you SO folks. <a href="http://stackoverflow.com/questions/16722117">SO/16722117</a></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/23/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/22/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 22 May 2013</p>

<p style="font-style:italic"> pageviews: 1 </p>

<article>
<div class="excerpt">
<h2 id="nonparametric-bayes">Nonparametric-bayes</h2>
<ul>
<li><p>Establishing chunck dependencies, simplifying and abstracting code.</p></li>
<li>still need to fix up Allen MCMC convergence when underlying model is Myers <a href="https://github.com/cboettig/nonparametric-bayes/commit/dce19f44d6dec779ba5a1a3e245365cdca4bb034">10:18 am 2013/05/22</a></li>
<li><p>replicate runs on data from allen and myers model <a href="https://github.com/cboettig/nonparametric-bayes/commit/f8a241c677583ef3b324f274f3846b08243ddacb">08:39 pm 2013/05/21</a></p></li>
</ul>
<h3 id="clean-code-for-complicated-scripts">Clean code for complicated scripts</h3>
<p>Pseudo-code somewhat captured by the chuncks. Ideal would be:</p>
<ul>
<li>Define models</li>
<li>Define parameters</li>
<li>Simulate data</li>
<li>Estimate MLE</li>
<li>Estimate under GPP</li>
<li>Allen MCMC</li>
<li>Ricker MCMC</li>
<li>Myers MCMC</li>
<li>Determine optimal policy for each…</li>
<li>Simulation</li>
<li>Graphs</li>
</ul>
<h2 id="a-preponderance-of-preprint-servers">A preponderance of preprint servers</h2>
<p>Having sent in my review for IEE, do I also post it on the peerJ preprint? File each complaint or suggestion as issue on the paper’s Github repository? Post a comment on the corresponding author’s blogpost on the paper? In my own online notebook? Oh, the reviewer’s plight! From review-recognition poverty to an embarassment of riches!</p>
<h2 id="other-writing-and-thoughts">Other writing and thoughts</h2>
<ul>
<li>Open Science cover letters?</li>
<li><a href="https://plus.google.com/112929796403983408632/posts/8whV6rtvsuw">In which I rant about scientific software</a> again</li>
</ul>
<h2 id="ews-review">ews-review</h2>
<ul>
<li>re-submitted. <a href="https://github.com/cboettig/ews-review/tags">submmitted_revisions tag</a></li>
</ul>
<h2 id="reading">Reading</h2>
<ul>
<li><p><span class="showtooltip" title="Joppa L, McInerny G, Harper R, Salido L, Takeda K, O'Hara K,
Gavaghan D and Emmott S (2013). Troubling Trends in Scientific
Software Use. _Science_, *340*. ISSN 0036-8075, 
http://dx.doi.org/10.1126/science.1231535."><a href="http://dx.doi.org/10.1126/science.1231535" rel="http://purl.org/spar/cito/critiques" >Joppa <em>et. al.</em> (2013)</a></span> utoh… I rant about software again</p></li>
<li><p><a href="http://theseamonster.net/2013/05/are-unreasonably-harsh-reviewers-retarding-the-pace-of-coral-reef-science/">Are unreasonably harsh reviews retarding the pace of coral reef science?</a> I applaud the spirit of this piece. When I saw the article, <span class="showtooltip" title="Coral reef baselines: how much macroalgae is natural?.  https://peerj.com/preprints/19/."><a href="https://peerj.com/preprints/19/" rel="http://purl.org/spar/cito/discusses" >Bruno <em>et al.</em> (2013)</a></span> appear on PeerJ last week I thought to myself, “Ooh, looks like controversial stuff! Bravo for using a preprint server,” so it is quite delightful to read the back story and confirm my guess. Though I am a proponent of open peer review, I find the practice of posting anonymous peer reviews a bit ethically murky still.</p></li>
</ul>
<h2 id="misc">Misc</h2>
<ul>
<li><p>Trying to submit <a href="https://github.com/cboettig/knitcitations">knitcitations</a> to CRAN; R-devel has updated linewrapping requirements that brake roxygen2 <a href="https://github.com/klutometis/roxygen/issues/125">roxygen/125</a>, so have to correct <code>.Rd</code> files after the fact.</p></li>
<li><p>My ans: <a href="http://opendata.stackexchange.com/questions/522">Open data vs Linked data</a> on opendata.stackexchange opendata SO launches public beta</p></li>
<li><p><a href="http://stackoverflow.com/questions/1312087/">Why people don’t use WADL</a> Basically we can accomplish structure much better by having well-defined media types. We can define the schema of the json or xml file we return, <sup><a href="#fn1" class="footnoteRef" id="fnref1">1</a></sup> and then the application knows what to expect and what it can do with the data. This is far more useful than just having a programmatic version of the API calls in the native language (“client objects”). Seems like REST was supposed to make such things obsolete, and to make deploying the API far simpler than it was in SOAP (which provides WSDL).</p></li>
<li><p>An interesting discussion on <a href="http://barelyenough.org/blog/2008/05/versioning-rest-web-services/">using mediatypes for REST APIs</a>, which might be referred to as the <a href="http://barelyenough.org/blog/2007/05/hypermedia-as-the-engine-of-application-state/">HATEOAS</a> approach:</p></li>
</ul>
<blockquote>
<p>which basically means that responses from the server will be documents that include URIs to everything you can do next</p>
</blockquote>
<p>hmm, a powerful idea.</p>
<h2 id="references">References</h2>
<ul>
<li>L. N. Joppa, G. McInerny, R. Harper, L. Salido, K. Takeda, K. O’Hara, D. Gavaghan, S. Emmott, (2013) Troubling Trends in Scientific Software Use. <em>Science</em> <strong>340</strong> <a href="http://dx.doi.org/10.1126/science.1231535">10.1126/science.1231535</a></li>
<li>Bruno et al. (2013) <a href="https://peerj.com/preprints/19/">https://peerj.com/preprints/19/</a></li>
</ul>
<section class="footnotes">
<hr />
<ol>
<li id="fn1"><p>yes, JSON has schemas too. wow.<a href="#fnref1">↩</a></p></li>
</ol>
</section>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/22/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/20/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 20 May 2013</p>

<p style="font-style:italic"> pageviews: 14 </p>

<article>
<div class="excerpt">
<h2 id="ews-te-revisions">EWS TE revisions</h2>
<ul>
<li>Finalized manuscript(?) Checking references, reply letter, closing remaining <a href="https://github.com/cboettig/ews-review/issues">issues</a>.<br /></li>
<li>Very annoying to submit to a journal system that takes LaTeX but not any external style or class file dependencies. For instance, how does one add two footnotes to the same author without adding any such dependencies (oh, and writing macros that do not involve pairs of <code>$</code> which pandoc mistakes for its own macros…) Reasonable author affiliations done otherwise using <code>\and</code>, <code>\thanks</code>, and <code>\footnotemark</code>; see <a href="">simple.latex</a> pandoc template.<br /></li>
<li>Final edits from Alan.</li>
</ul>
<h2 id="prosecutor-comment-revisions">prosecutor comment revisions</h2>
<ul>
<li>added Figure for Allee model into reply document.</li>
<li>added code for generating figures <a href="https://raw.github.com/cboettig/earlywarning/68f7bba05586d425f1bbfcdb1fe66f0597a3d35b/inst/doc/Figure1.Rmd">Figure1.Rmd</a></li>
<li>combined all four data files into a single tidy data.frame as <a href="https://raw.github.com/cboettig/earlywarning/68f7bba05586d425f1bbfcdb1fe66f0597a3d35b/inst/doc/Figure1.csv">csv</a>.</li>
</ul>
<h2 id="ropensci">ropensci</h2>
<p>Example API queries using Whitehouse Open Data <a href="https://github.com/project-open-data/csv-to-api">CSV-API</a> tool.</p>
<ul>
<li><a href="http://ropensci.org/csv-to-api/index.php?source=https://explore.data.gov/download/7tag-iwnu/CSV&amp;source_format=csv&amp;format=html">CSV file</a> (as displayed from the API)</li>
<li><a href="http://ropensci.org/csv-to-api/index.php?source=https://explore.data.gov/download/7tag-iwnu/CSV&amp;source_format=csv&amp;format=xml&amp;Magnitude=1.6">XML query</a></li>
<li><a href="http://ropensci.org/csv-to-api/index.php?source=https://explore.data.gov/download/7tag-iwnu/CSV&amp;source_format=csv&amp;format=json&amp;callback=parse_results">JSON query</a></li>
</ul>
<h3 id="rfishbase-queries">rfishbase queries</h3>
<ul>
<li>Continue to get questions about performing queries on fishbase that are just not possible with their current awful data model. This time: how can one extract the 400 natural mortality rate estimates mentioned on <a href="http://www.fishbase.org/manual/fishbasenatural_mortality00002689.htm">this page</a>. No, the page entitled <a href="http://www.fishbase.org/manual/fishbasethe_popgrowth_table.htm">popgrowth</a> doesn’t actually show you the table.</li>
</ul>
<h3 id="pdg-control-policycosts">pdg-control: policycosts</h3>
<p>Over the weekend, re-ran the policy costs analysis with the simpler apples-to-apples comparison (after stream-lining the code a bit more). General patterns remain the same. Also added a block for showing how well we are doing on our grid sampling at getting to a shared npv0 level.</p>
<ul>
<li>Comparison when adjustment costs reduce net present value by 50% <a href="https://github.com/cboettig/pdg_control/blob/582cc266eeda686ac42c9e1e652cc809b2f861f0/inst/examples/policycosts/writeup.md">pdg_control/582cc26</a></li>
<li>The original 25% reduction (e.g. to 75% of the NPV) <a href="https://github.com/cboettig/pdg_control/blob/59dca5fc085b93c4f9f833562267b6bdc5a10a55/inst/examples/policycosts/writeup.md">pdg_control/59dca5f</a></li>
</ul>
<h2 id="misc">Misc</h2>
<h3 id="notebook">Notebook</h3>
<ul>
<li><p>obfuscated email via <a href="https://github.com/cboettig/labnotebook/blob/36b4cd8bdf2f9c943619631dc17e867c0c951d38/assets/js/obfuscate-email.js">javascript</a>, copy-paste and mailto: should still work. (Of course a scraper could use the very javascript code to access the email addresses, but I find this preferable to a solution that intenionally burdens the user). Spam filters should handle the rest.</p></li>
<li><p>Interesting reading about <a href="http://mikegerwitz.com/docs/git-horror-story.html">signing individual Git commits</a></p></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/20/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/05/17/null-distribution-width-minor-puzzle.html">Null Distribution Width Minor Puzzle</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 17 May 2013</p>

<p style="font-style:italic"> pageviews: 21 </p>

<article>
<div class="excerpt">
<p>A quick foray into trying to understand why I see the wider distribution (though still symmetric) in the null of the OU model then in the null from the Allee model in the Prosecutor’s fallacy.</p>
<p>Load the original run of the <a href="https://github.com/cboettig/earlywarning/blob/712b63d2719839b6bbf4188d9affb34d7cec68ce/inst/examples/beer.md">ou model</a> and increase the <code>nulldt</code> data frame to use all points instead of a sample of length 5000</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;beer_run.rda&quot;</span>)

ou_dat &lt;- dat
ou_null &lt;- nulldat
<span class="co">#ou_null_ts &lt;- nulldt</span>

null &lt;- timeseries <span class="co">#[1000:6010,]</span>
null &lt;- <span class="kw">as.data.frame</span>(<span class="kw">cbind</span>(<span class="dt">time =</span> <span class="dv">1</span>:<span class="kw">dim</span>(null)[<span class="dv">1</span>], null))
ndf &lt;- <span class="kw">melt</span>(null, <span class="dt">id=</span><span class="st">&quot;time&quot;</span>)
<span class="kw">names</span>(ndf) = <span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;reps&quot;</span>, <span class="st">&quot;value&quot;</span>)
<span class="kw">levels</span>(ndf$reps) &lt;- <span class="dv">1</span>:<span class="kw">length</span>(<span class="kw">levels</span>(ndf$reps)) <span class="co"># use numbers for reps instead of V1, V2, etc</span>
nulldt &lt;- <span class="kw">data.table</span>(ndf)
ou_null_ts &lt;- nulldt</code></pre>
<p>Plot the final distribution of indicator statistics, showing the width of the null,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat) + <span class="kw">geom_histogram</span>(<span class="kw">aes</span>(value, <span class="dt">y=</span>..density..), <span class="dt">binwidth=</span><span class="fl">0.3</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>) +
 <span class="kw">facet_wrap</span>(~variable) + <span class="kw">xlim</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">1</span>)) + 
  <span class="kw">geom_density</span>(<span class="dt">data=</span>nulldat, <span class="kw">aes</span>(value), <span class="dt">adjust=</span><span class="dv">2</span>) + <span class="kw">xlab</span>(<span class="st">&quot;Kendall&#39;s tau&quot;</span>) + <span class="kw">theme_bw</span>()</code></pre>
<figure>
<img src="http://farm9.staticflickr.com/8558/8747591959_9944ea987d_o.png" alt="plot of chunk unnamed-chunk-4" /><figcaption>plot of chunk unnamed-chunk-4</figcaption>
</figure>
<p>Load the <a href="https://github.com/cboettig/earlywarning/blob/712b63d2719839b6bbf4188d9affb34d7cec68ce/inst/examples/comment.md">allee model</a> and rename variables appropriately,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="st">&quot;comment_run.rda&quot;</span>)
allee_dat &lt;- dat
allee_null &lt;- nulldat
allee_null_ts &lt;- nulldt</code></pre>
<p>For the Allee model, also plot the final distribution of indicator statistics, showing the width of the null,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat) + <span class="kw">geom_histogram</span>(<span class="kw">aes</span>(value, <span class="dt">y=</span>..density..), <span class="dt">binwidth=</span><span class="fl">0.3</span>, <span class="dt">alpha=</span>.<span class="dv">5</span>) +
 <span class="kw">facet_wrap</span>(~variable) + <span class="kw">xlim</span>(<span class="kw">c</span>(-<span class="dv">1</span>, <span class="dv">1</span>)) + 
  <span class="kw">geom_density</span>(<span class="dt">data=</span>nulldat, <span class="kw">aes</span>(value), <span class="dt">adjust=</span><span class="dv">2</span>) + <span class="kw">xlab</span>(<span class="st">&quot;Kendall&#39;s tau&quot;</span>) + <span class="kw">theme_bw</span>()</code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7315/8748715116_c9440843f1_o.png" alt="plot of chunk unnamed-chunk-6" /><figcaption>plot of chunk unnamed-chunk-6</figcaption>
</figure>
<p>Tidy the data and plot a single replicate from each. Note the OU process has the correspondingly much wider null distribution due to</p>
<pre class="sourceCode r"><code class="sourceCode r">allee_x &lt;- <span class="kw">subset</span>(allee_null_ts, reps==<span class="dv">1</span>)
ou_x &lt;- <span class="kw">subset</span>(ou_null_ts, reps==<span class="dv">1</span>)
allee_x &lt;- <span class="kw">data.frame</span>(<span class="dt">time =</span> allee_x$time, <span class="dt">value =</span> allee_x$value)
ou_x &lt;- <span class="kw">data.frame</span>(<span class="dt">time =</span> ou_x$time, <span class="dt">value =</span> ou_x$value)

<span class="kw">ggplot</span>(allee_x, <span class="kw">aes</span>(time, value)) + <span class="kw">geom_point</span>()</code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7323/8747593003_dfbd94b355_o.png" alt="plot of chunk unnamed-chunk-7" /><figcaption>plot of chunk unnamed-chunk-7</figcaption>
</figure>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(ou_x, <span class="kw">aes</span>(time, value)) + <span class="kw">geom_point</span>()</code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7295/8747593115_4320618635_o.png" alt="plot of chunk unnamed-chunk-7" /><figcaption>plot of chunk unnamed-chunk-7</figcaption>
</figure>
<p>Note that subsampling the data at coarser interval doesn’t matter</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">warningtrend</span>(ou_x[<span class="kw">seq</span>(<span class="dv">1</span>, <span class="kw">length</span>(ou_x$value),<span class="dt">by=</span><span class="dv">50</span>),], window_var)</code></pre>
<pre><code>    tau 
-0.5527 </code></pre>
<p>Nor does scaling matter (recall Kendall’s <span class="math">\(tau\)</span> is a rank-correlation test)</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">warningtrend</span>(<span class="kw">data.frame</span>(<span class="dt">time=</span>ou_x$time, <span class="dt">value=</span>(ou_x$value<span class="dv">+1</span>)*<span class="dv">500</span>), window_var)</code></pre>
<pre><code>    tau 
-0.5516 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">warningtrend</span>(<span class="kw">data.frame</span>(<span class="dt">time=</span>ou_x$time, <span class="dt">value=</span>ou_x$value), window_var)</code></pre>
<pre><code>    tau 
-0.5516 </code></pre>
<p>Lengthening the sample suggests the sampling is not long enough to have converged in distribution of this statistic. Computing on this fine sampling resolution over adequate length of time quickly becomes prohibitive.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sapply</span>(<span class="kw">seq</span>(<span class="dv">1000</span>, <span class="dv">20000</span>, <span class="dt">by=</span><span class="dv">1000</span>), function(i) <span class="kw">warningtrend</span>(ou_x[<span class="dv">1</span>:i,], window_var))</code></pre>
<pre><code>       tau        tau        tau        tau        tau        tau 
 0.1802475 -0.0832527  0.6365570  0.1787726 -0.1747774 -0.5295226 
       tau        tau        tau        tau        tau        tau 
-0.5403782 -0.6790710 -0.6114706 -0.2950858 -0.0444861  0.0006919 
       tau        tau        tau        tau        tau        tau 
-0.2579410 -0.5220490 -0.6439519 -0.6221482 -0.5545048 -0.5134236 
       tau        tau 
-0.5265975 -0.5515807 </code></pre>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/17/null-distribution-width-minor-puzzle.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/16/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 16 May 2013</p>

<p style="font-style:italic"> pageviews: 27 </p>

<article>
<div class="excerpt">
<h2 id="prosecutor">Prosecutor</h2>
<ul>
<li>Add figures for both examples with and without ASS</li>
<li>text to accomidate both examples</li>
<li>ROC curves?</li>
<li>proof-reading</li>
</ul>
<h2 id="ews-review">ews-review</h2>
<ul>
<li>looking over revisions, touch-ups</li>
<li>See issues log for details</li>
</ul>
<h2 id="links">Links</h2>
<ul>
<li>Impressive set of tools provided by the Whitehouse <a href="http://project-open-data.github.io/">open data project</a> In particular, see the <a href="https://github.com/project-open-data/csv-to-api">tool</a> for generating a RESTful API from CSV files and the “common core” <a href="http://project-open-data.github.io/metadata-resources/#common_core_required_fields_equivalents">metadata definitions</a>. Notebook complies with many of these (throught the Dublin core RDFa), but looks like I could benefit from adding some more terms from the <a href="http://www.w3.org/TR/vocab-dcat/#property--access-download">Data Catalog Vocabulary</a>. Awesome that this site is built with Twitter-Bootstrap and Jekyll, hosted on Github, and licenced as CC-BY (content) and MIT (code). See for example, the <a href="https://github.com/project-open-data/project-open-data.github.io/issues">issues log</a>.</li>
</ul>
<h2 id="notebook">Notebook</h2>
<ul>
<li><p>added black-white theme for readers that prefer higher contrast / more traditional appearance. Otherwise matches the orginal feel reasonably well. (<a href="https://github.com/cboettig/labnotebook/issues/70">#70</a>)</p></li>
<li><p>Dropped the local javascript based search using the stemming engine (<a href="https://github.com/cboettig/labnotebook/issues/7">#7</a>). The stemming search was reasonably fast, but only matches words instead of phrases (and adds considerable overhead to generating the site).</p></li>
</ul>
<p>*</p>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/16/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/05/14/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 14 May 2013</p>

<p style="font-style:italic"> pageviews: 41 </p>

<article>
<div class="excerpt">
<p>Exploring potential plots that would allow for some visualization of the uncertainty in each of the models. Example follows up on analysis of <a href="https://github.com/cboettig/nonparametric-bayes/blob/e97043d690b81e1fdd777e7d2f927cdee8fba653/inst/examples/BUGS/allen.md">e97043d/allen.md</a>, as also in the script from <a href="https://github.com/cboettig/nonparametric-bayes/blob/b5d78b9bca5dbf08828f1882eda1676e29958df3/inst/examples/BUGS/step_ahead_plots.md">b5d78b9/step_ahead_plots.md</a></p>
<h2 id="one-step-ahead-predictor-plots-and-forecasting-plots">One-step ahead predictor plots and forecasting plots</h2>
<p>Set our usual plotting options for the notebook</p>
<pre class="sourceCode r"><code class="sourceCode r">opts_chunk$<span class="kw">set</span>(<span class="dt">tidy =</span> <span class="ot">FALSE</span>, <span class="dt">warning =</span> <span class="ot">FALSE</span>, <span class="dt">message =</span> <span class="ot">FALSE</span>, <span class="dt">cache =</span> <span class="ot">FALSE</span>, 
    <span class="dt">comment =</span> <span class="ot">NA</span>, <span class="dt">fig.width =</span> <span class="dv">7</span>, <span class="dt">fig.height =</span> <span class="dv">4</span>)
<span class="kw">library</span>(ggplot2)
opts_knit$<span class="kw">set</span>(<span class="dt">upload.fun =</span> socialR::flickr.url)
<span class="kw">theme_set</span>(<span class="kw">theme_bw</span>(<span class="dt">base_size =</span> <span class="dv">12</span>))
<span class="kw">theme_update</span>(<span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">colour =</span> <span class="ot">NA</span>), 
    <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="dt">colour =</span> <span class="ot">NA</span>))
cbPalette &lt;- <span class="kw">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>, <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, 
    <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</code></pre>
<p>Now we show how each of the fitted models performs on the training data (e.g. plot of the step-ahead predictors). For the GP, we need to predict on the training data first:</p>
<pre class="sourceCode r"><code class="sourceCode r">gp_f_at_obs &lt;- <span class="kw">gp_predict</span>(gp, x, <span class="dt">burnin=</span><span class="fl">1e4</span>, <span class="dt">thin=</span><span class="dv">300</span>)</code></pre>
<p>For the parametric models, prediction is a matter of feeding in each of the observed data points to the fitted parameters, like so</p>
<pre class="sourceCode r"><code class="sourceCode r">step_ahead &lt;- function(x, f, p){
  h = <span class="dv">0</span>
  x_predict &lt;- <span class="kw">sapply</span>(x, f, h, p)
  n &lt;- <span class="kw">length</span>(x_predict) - <span class="dv">1</span>
  y &lt;- <span class="kw">c</span>(x[<span class="dv">1</span>], x_predict[<span class="dv">1</span>:n])
  y
}</code></pre>
<p>Which we apply over each of the fitted models, including the GP, organizing the “expected” transition points (given the previous point) into a data frame.</p>
<pre class="sourceCode r"><code class="sourceCode r">df &lt;- <span class="kw">melt</span>(<span class="kw">data.frame</span>(<span class="dt">time =</span> <span class="dv">1</span>:<span class="kw">length</span>(x), <span class="dt">stock =</span> x, 
                <span class="dt">GP =</span> gp_f_at_obs$E_Ef,
                <span class="dt">True =</span> <span class="kw">step_ahead</span>(x,f,p),  
                <span class="dt">MLE =</span> <span class="kw">step_ahead</span>(x,f,est$p), 
                <span class="dt">Parametric.Bayes =</span> <span class="kw">step_ahead</span>(x, f, bayes_pars), 
                <span class="dt">Ricker =</span> <span class="kw">step_ahead</span>(x,alt$f, ricker_bayes_pars), 
                <span class="dt">Myers =</span> <span class="kw">step_ahead</span>(x, Myer_harvest, myers_bayes_pars)
                 ), <span class="dt">id=</span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;stock&quot;</span>))

<span class="kw">ggplot</span>(df) + <span class="kw">geom_point</span>(<span class="kw">aes</span>(time, stock)) + 
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(time, value, <span class="dt">col=</span>variable)) +
    <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7294/8743766846_a5d6b20f15_o.png" />
</figure>
<h2 id="posterior-predictive-curves">Posterior predictive curves</h2>
<p>This shows only the mean predictions. For the Bayesian cases, we can instead loop over the posteriors of the parameters (or samples from the GP posterior) to get the distribution of such curves in each case.</p>
<p>We will need a vector version (<code>pmin</code> in place of <code>min</code>) of this function that can operate on the posteriors, others are vectorized already.</p>
<pre class="sourceCode r"><code class="sourceCode r">ricker_f &lt;- function(x,h,p){
  <span class="kw">sapply</span>(x, function(x){ 
    x &lt;- <span class="kw">pmax</span>(<span class="dv">0</span>, x-h) 
    <span class="kw">pmax</span>(<span class="dv">0</span>, x * <span class="kw">exp</span>(p[<span class="dv">2</span>] * (<span class="dv">1</span> - x / p[<span class="dv">1</span>] )) )
  })
}</code></pre>
<p>Then we proceed as before, now looping over 100 random samples from the posterior for each Bayesian estimate. We write this as a function for easy reuse.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">require</span>(MASS)

step_ahead_posteriors &lt;- function(x){
gp_f_at_obs &lt;- <span class="kw">gp_predict</span>(gp, x, <span class="dt">burnin=</span><span class="fl">1e4</span>, <span class="dt">thin=</span><span class="dv">300</span>)
df_post &lt;- <span class="kw">melt</span>(<span class="kw">lapply</span>(<span class="kw">sample</span>(<span class="dv">100</span>), 
  function(i){
    <span class="kw">data.frame</span>(<span class="dt">time =</span> <span class="dv">1</span>:<span class="kw">length</span>(x), <span class="dt">stock =</span> x, 
                <span class="dt">GP =</span> <span class="kw">mvrnorm</span>(<span class="dv">1</span>, gp_f_at_obs$Ef_posterior[,i], gp_f_at_obs$Cf_posterior[[i]]),
                <span class="dt">True =</span> <span class="kw">step_ahead</span>(x,f,p),  
                <span class="dt">MLE =</span> <span class="kw">step_ahead</span>(x,f,est$p), 
                <span class="dt">Parametric.Bayes =</span> <span class="kw">step_ahead</span>(x, allen_f, pardist[i,]), 
                <span class="dt">Ricker =</span> <span class="kw">step_ahead</span>(x, ricker_f, ricker_pardist[i,]), 
                <span class="dt">Myers =</span> <span class="kw">step_ahead</span>(x, myers_f, myers_pardist[i,]))
  }), <span class="dt">id=</span><span class="kw">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;stock&quot;</span>))

}


df_post &lt;- <span class="kw">step_ahead_posteriors</span>(x)
<span class="kw">ggplot</span>(df_post) + <span class="kw">geom_point</span>(<span class="kw">aes</span>(time, stock)) + 
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(time, value, <span class="dt">col=</span>variable, <span class="dt">group=</span><span class="kw">interaction</span>(L1,variable)), <span class="dt">alpha=</span>.<span class="dv">1</span>) + 
  <span class="kw">facet_wrap</span>(~variable) + 
  <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>))) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7290/8742650211_92d087672b_o.png" />
</figure>
<p>alternately, try the plot without facets</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df_post) + <span class="kw">geom_point</span>(<span class="kw">aes</span>(time, stock)) + 
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(time, value, <span class="dt">col=</span>variable, <span class="dt">group=</span><span class="kw">interaction</span>(L1,variable)), <span class="dt">alpha=</span>.<span class="dv">1</span>) + 
  <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>))) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7284/8743767710_17a0bc6428_o.png" />
</figure>
<h2 id="performance-on-data-outside-of-observations">Performance on data outside of observations</h2>
<p>Of course it is hardly suprising that all models do reasonably well on the data on which they were trained. A crux of the problem is the model performance on data outside the observed range. (Though we might also wish to repeat the above plot on data in the observed range but a different sequence from the observed data).</p>
<p>First we generate some data from the underlying model coming from below the tipping point:</p>
<pre class="sourceCode r"><code class="sourceCode r">Tobs &lt;- <span class="dv">8</span>
y &lt;- <span class="kw">numeric</span>(Tobs)
y[<span class="dv">1</span>] = <span class="fl">4.5</span>
for(t in <span class="dv">1</span>:(Tobs<span class="dv">-1</span>))
    y[t<span class="dv">+1</span>] = <span class="kw">z_g</span>() * <span class="kw">f</span>(y[t], <span class="dt">h=</span><span class="dv">0</span>, <span class="dt">p=</span>p)</code></pre>
<p>Proceed as before on this data:</p>
<pre class="sourceCode r"><code class="sourceCode r">crash_data &lt;- <span class="kw">step_ahead_posteriors</span>(y)

<span class="kw">ggplot</span>(crash_data) + <span class="kw">geom_point</span>(<span class="kw">aes</span>(time, stock)) + 
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(time, value, <span class="dt">col=</span>variable, <span class="dt">group=</span><span class="kw">interaction</span>(L1,variable)), <span class="dt">alpha=</span>.<span class="dv">1</span>) + 
  <span class="kw">facet_wrap</span>(~variable) + 
  <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey, <span class="dt">guide =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>))) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7282/8742650625_efd126ef62_o.png" />
</figure>
<p>Note that the GP is doing remarkably well even outside the observed range, though with greater uncertainty as well. Other models tend to be overly optimistic, often predicting an increase instead of a decline, hence the many trajectories that continually float above the data.</p>
<h2 id="forecast-distributions">Forecast Distributions</h2>
<p>Another way to visualize this is to look directly at the distribution predicted under each model, one step and several steps into the future (say, at a fixed harvest level). Here we have a simple function that will look one step ahead of the given <code>x</code> (given as index <code>i</code>), then <code>Tobs</code> steps ahead, then <code>2*Tobs</code> steps ahead, each at a fixed harvest. This lets us compare both the expected outcome over short and long term under a given harvest policy, as well as seeing how the distribution of possible outcomes evolves.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(expm)
get_forecasts &lt;- function(i, Tobs, h_i){

df &lt;- <span class="kw">data.frame</span>(
  <span class="dt">x =</span> x_grid,  
  <span class="dt">GP =</span> matrices_gp[[h_i]][i,], 
  <span class="dt">True =</span> matrices_true[[h_i]][i,], 
  <span class="dt">MLE =</span> matrices_estimated[[h_i]][i,], 
  <span class="dt">Parametric.Bayes =</span> matrices_par_bayes[[h_i]][i,], 
  <span class="dt">Ricker =</span> matrices_alt[[h_i]][i,],
  <span class="dt">Myers =</span> matrices_myers[[h_i]][i,])

df2 &lt;- <span class="kw">data.frame</span>(
  <span class="dt">x =</span> x_grid,
  <span class="dt">GP =</span> (matrices_gp[[h_i]] %^% Tobs)[i,], 
  <span class="dt">True =</span> (matrices_true[[h_i]] %^% Tobs)[i,], 
  <span class="dt">MLE =</span> (matrices_estimated[[h_i]] %^% Tobs)[i,],
  <span class="dt">Parametric.Bayes =</span> (matrices_par_bayes[[h_i]] %^% Tobs)[i,], 
  <span class="dt">Ricker =</span> (matrices_alt[[h_i]] %^% Tobs)[i,], 
  <span class="dt">Myers =</span> (matrices_myers[[h_i]] %^% Tobs)[i,])

T2 &lt;- <span class="dv">2</span> * Tobs

df4 &lt;- <span class="kw">data.frame</span>(
  <span class="dt">x =</span> x_grid,
  <span class="dt">GP =</span> (matrices_gp[[h_i]] %^% T2)[i,], 
  <span class="dt">True =</span> (matrices_true[[h_i]] %^% T2)[i,], 
  <span class="dt">MLE =</span> (matrices_estimated[[h_i]] %^% T2)[i,],
  <span class="dt">Parametric.Bayes =</span> (matrices_par_bayes[[h_i]] %^% T2)[i,], 
  <span class="dt">Ricker =</span> (matrices_alt[[h_i]] %^% T2)[i,], 
  <span class="dt">Myers =</span> (matrices_myers[[h_i]] %^% T2)[i,])

forecasts &lt;- <span class="kw">melt</span>(<span class="kw">list</span>(<span class="dt">T_start =</span> df, <span class="dt">T_mid =</span> df2, <span class="dt">T_end =</span> df4), <span class="dt">id=</span><span class="st">&quot;x&quot;</span>)

}

i = <span class="dv">15</span></code></pre>
<p>This takes <code>i</code>, an index to <code>x_grid</code> value (e.g. for <code>i</code>=15 corresponds to a starting postion <code>x</code> = 3.4286)</p>
<pre class="sourceCode r"><code class="sourceCode r">forecasts &lt;- <span class="kw">get_forecasts</span>(<span class="dt">i =</span> <span class="dv">15</span>, <span class="dt">Tobs =</span> <span class="dv">5</span>, <span class="dt">h_i =</span> <span class="dv">1</span>)

<span class="kw">ggplot</span>(forecasts) +
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(x, value, <span class="dt">group=</span><span class="kw">interaction</span>(variable, L1), <span class="dt">col=</span>variable, <span class="dt">lty=</span>L1)) +
  <span class="kw">facet_wrap</span>(~ variable, <span class="dt">scale=</span><span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol=</span><span class="dv">2</span>) + 
  <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7283/8743768066_ae4cb1a63d_o.png" alt="plot of chunk unnamed-chunk-10" /><figcaption>plot of chunk unnamed-chunk-10</figcaption>
</figure>
<p>We can compare to a better starting stock,</p>
<pre class="sourceCode r"><code class="sourceCode r">i&lt;-<span class="dv">30</span></code></pre>
<p>where <code>i</code>=30 corresponds to a starting postion <code>x</code> = 7.102</p>
<pre class="sourceCode r"><code class="sourceCode r">forecasts &lt;- <span class="kw">get_forecasts</span>(<span class="dt">i =</span> i, <span class="dt">Tobs =</span> <span class="dv">5</span>, <span class="dt">h_i =</span> <span class="dv">1</span>)

<span class="kw">ggplot</span>(forecasts) +
  <span class="kw">geom_line</span>(<span class="kw">aes</span>(x, value, <span class="dt">group=</span><span class="kw">interaction</span>(variable, L1), <span class="dt">col=</span>variable, <span class="dt">lty=</span>L1)) +
  <span class="kw">facet_wrap</span>(~ variable, <span class="dt">scale=</span><span class="st">&quot;free_y&quot;</span>, <span class="dt">ncol=</span><span class="dv">2</span>) + 
  <span class="kw">scale_colour_manual</span>(<span class="dt">values=</span>colorkey) </code></pre>
<figure>
<img src="http://farm8.staticflickr.com/7289/8743768174_106af587ce_o.png" />
</figure>
<p>Note the greater uncertainty in both the positive and negative outcomes under the parametric Bayesian models (of correct and incorrect structure).</p>
<h2 id="misc-reading">Misc reading</h2>
<p>Apparently I am catching up on my C. Titus Brown reading… Achiving comments for my records &amp; to keep them in my local search index.</p>
<p><a href="http://ivory.idyll.org/blog/blog-practicing-open-science.html">Titus Brown on if he really practices Open Science?</a></p>
<p>Methinks:</p>
<blockquote>
<p>I think you undersell your Github practices regarding Open Science. While I agree entirely that anyone reading through your source-code to scoop you is incredibly unlikely; I imagine many researchers would still fear the practice of using a public, Google-indexed repository, particularly if they also practice reasonable literate programming documentation, provide test cases, and use issue tracking that could allow some close rival to scoop them.</p>
</blockquote>
<blockquote>
<p>It sounds like you are talking more about not marketing your work before it is “finished”, rather not being open. (When you say “to really open up about what we’re doing” I assume you mean advertising the results, rather than something like simply putting your notebook or publication drafts on github). Though “Open Science” is used in in both contexts, marketing your pre-publication science takes additional time that exposing your workflow on Github does not. The latter practice provides transparency, provenance machine-discoverability, (and cool graphs of research contributions like https://github.com/ctb/khmer/c… etc. Perhaps you are too hard on yourself here.</p>
</blockquote>
<blockquote>
<p>Meanwhile, I think suggesting that being open prematurely would “waste other people’s time, energy, and attention” is misleading and damaging here. Sure, I understand you mean that marketing unfinished results (blog, tweet, present at conferences) would do these things, but when the same reason is frequently given for not sharing data, code, etc this becomes very damaging. Some people may find it useful to blog/tweet/present unfinished work (with appropriate disclaimer) to get feedback, build audience, or for all the same reasons one would do so with published work, but to me that is really just a question of timing &amp; marketing, not a question of “openness”.</p>
</blockquote>
<p><a href="http://ivory.idyll.org/blog/research-software-reuse.html">On Research Software Reuse</a></p>
<p><a href="http://ivory.idyll.org/blog/the-cost-of-open-science.html">On the Costs of Open Science</a>, which I refute:</p>
<blockquote>
<p>Great post and important question. I certainly agree that it is all about incentives, but I think an important missing part of that discussion is in the timescales. Certainly there is a cost to not writing up the low-lying fruit following up on your work, but surely such exercises would take non-trivial time away from doing whatever (presumably more interesting) stuff you did instead. Perhaps the it is the benefits, not the costs, that are hidden:</p>
</blockquote>
<blockquote>
<p>It sounds like you may have forgone a short-term cost in not publishing these easy follow-ups while gaining a benefit both of time to work on other interesting things and of getting other researchers invested in your work, who might not have taken it up at all if there was no low-hanging fruit to entice them in. Once invested in it, no doubt they can continue to be a multiplier of impact. Meanwhile you break new ground rather than appearing to continue to wring every ounce from one good idea, right? (If I read this correctly, both you and George Gey appear to regard these other publications as not particularly exciting work; the regret comes only because they are intrinsically valued publications)</p>
</blockquote>
<blockquote>
<p>It sounds like the difficulty with these benefits is that they pay off only on a longer timescale than the gristmill publication strategy. On the longest timescales, e.g. career lifetime, it seems clear that at least in a statistical sense, researchers who keep breaking new ground while allowing others to pick the low-hanging follow-up work will be much more likely to end up as the most distinguished researchers, etc. When the relevant timescale is a tenure clock rather than a career, the perhaps the calculus is different?</p>
</blockquote>
<blockquote>
<p>Without open science, moving on to other exciting stuff is far less effective, since it leaves both unfinished work and less impact. Perhaps this a somewhat idealized view, and perhaps the timescales for tenure etc work against this strategy. You and others could no doubt better speak to whether the candidate who says “look at all the papers I wrote about X” or the one who says “look at all the papers others have built upon my method X while I break ground in hard problem Y” has the stronger case.</p>
</blockquote>
<ul>
<li><p><a href="https://gist.github.com/hadley/5576263">Partial implementation of R to Latex equation converter</a> from @hadleywickam.</p></li>
<li><p>Ah ha! <a href="http://stackoverflow.com/questions/14041601/documenting-equations-with-deqn-and-roxygen">Documenting equations in ROxygen</a>. Guess one day I (or devtools) will move to Roxygen3.</p></li>
</ul>
 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/05/14/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row">
  <div class="span11 offset1">
    <div class="socialicons">
      <p> <a href="/archive.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
    </div>
  </div> <!--end span9 -->
</div> <!--end row -->




<footer class="footer">
  <!-- ************* Buttons to toggle theme CSS ********************** -->
    <div class="row">
      <div class="span12">
        <form style="font-size:10px" class="pull-right">
          <a onclick="switch_style('dark'); 
                      recordOutboundLink(this, 'Outbound Links', 'dark theme'); 
                      return false;" 
             name="theme" value="dark" id="dark" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to dark theme"><i class="icon-adjust"></i>
                                   </span></a>
          
          <a onclick="switch_style('light'); 
                      recordOutboundLink(this, 'Outbound Links', 'light theme'); 
                      return false;" 
             name="theme" value="light" id="light" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to light theme"><i class="icon-certificate"></i>
           <a onclick="switch_style('white'); 
                      recordOutboundLink(this, 'Outbound Links', 'white theme'); 
                      return false;" 
             name="theme" value="white" id="white" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to white theme"><i class="icon-circle-blank"></i>
                                  </span></a>
                                 </span></a>
        </form>
      </div>
    </div>

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="span3 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <script type="text/javascript" src="/assets/js/obfuscate-email-link.js" language="javascript"></script> 
          <a rel="foaf:account" alt="twitter" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="icon-twitter"></i></span></a> 
          <a rel="foaf:account" alt="github" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="icon-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="icon-google-plus"></i></a>
          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" alt="mendeley" /></a> 
           citations on google-scholar
           stackoverflow
      -->
      <a alt="rss" type="application/atom+xml" href="/atom.xml"  
         class="showtooltip" title="subscribe to RSS feeds for my open lab notebook" 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="icon-rss"></i></a>
       </p>
    </div>
    <!--**************** End social links **************************** -->
    <div class="span1">
      <br />
    </div>
    <div class="span4">
      <p>
      <a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="http://onsclaims.wikispaces.com/file/view/ons-aci2-icon.png" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a>

      <a title="This site uses linked data semantics. Click to extract as RDF XML." class="btn btn-mini showtooltip" style="font-size: .8em" 
       href="http://any23.org/?format=rdfxml&validate=validate&uri=http://www.carlboettiger.info/lab-notebook.html"><i 
         class="icon-cloud-download"  onclick="recordOutboundLink(this, 'Outbound Links', 'RDF'); return false;"></i> RDF</a>
      </p>
    </div>
    <div class="span1">
      <br />
    </div>
    <div class="span3">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="http://i.creativecommons.org/l/zero/1.0/88x31.png" alt="CC0"/></a> 
      </p>
    </div>

  </div>
  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/lab-notebook.html">
  </span>



</footer>




    <!-- Le javascript
    ================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <!-- JQuery, used on a few pages -->
    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Tooltip javascript -->
    <script type="text/javascript">
      $(document).ready(function (){
        $(".showtooltip").tooltip();
      });
    </script>

    <!-- Marran's Search Javascript -->
    <script type="text/javascript" src="/assets/js/porter-stemmer.js"></script>
    <script type="text/javascript" src="/assets/js/site-search.js"></script>

    <!-- Code collapse Javascript -->
    <script type="text/javascript">
    $(document).ready(function(){
      $("#toggle_code").click(function(){
        $(".highlight").toggle();
        $(".sourceCode").toggle();
      });
    });
    </script>


  <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    


    </div>
  </body>
</html>


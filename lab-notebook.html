<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
  <head prefix="dc: http://purl.org/dc/terms/ og: http://ogp.me/ns#">
  <meta charset="utf-8" /> 
  <title>Lab Notebook</title>
  <meta name="author" content="Carl Boettiger" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  

<!-- Some liquid code so that pages get the site.time creation date 
      Would be nice to use github modified times, but doesn't handle 
      the path for pages -->







<!-- HTML5 metadata -->
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta name="resource_type" content="website"/> 
<!-- RDFa Metadata (in DublinCore) -->
<meta property="dc:title" content="Lab Notebook" />
<meta property="dc:creator" content="Carl Boettiger" />
<meta property="dc:date" content="2013-04-19T15:41:48-07:00" />
<meta property="dc:format" content="text/html" />
<meta property="dc:language" content="en" />
<meta property="dc:identifier" content="/lab-notebook.html" />
<meta property="dc:rights" content="CC0" />
<meta property="dc:source" content="Lab Notebook" />
<meta property="dc:subject" content="Ecology" /> 
<meta property="dc:type" content="website" /> 
<!-- RDFa Metadata (in OpenGraph) -->
<meta property="og:title" content="Lab Notebook" />
<meta property="og:author" content="http://www.carlboettiger.info/index.html#me" />  <!-- Should be Liquid? URI? -->
<meta property="http://ogp.me/ns/profile#first_name" content="Carl"/>
<meta property="http://ogp.me/ns/profile#last_name" content="Boettiger"/>
<meta property="http://ogp.me/ns/article#published_time" content="2013-04-19T15:41:48-07:00" />
<meta property="og:site_name" content="Lab Notebook" /> <!-- Same as dc:source? -->
<meta property="og:url" content="http://www.carlboettiger.info/lab-notebook.html" />
<meta property="og:type" content="website" /> 
<!-- Google Scholar Metadata -->
<meta name="citation_author" content="Carl Boettiger"/>
<meta name="citation_date" content="2013-04-19T15:41:48-07:00"/>
<meta name="citation_title" content="Lab Notebook"/>
<meta name="citation_journal_title" content="Lab Notebook"/>

<!--NOTE: see also the COinS Metadata in span element in footer -->




  <!-- CSS Stylesheets (toggled with javascript) -->
  <link href="/assets/css/light.css" rel="stylesheet"
        type="text/css" id="stl" title="light" />
  <link href="/assets/css/dark.css" rel="alternate stylesheet" 
        type="text/css" title="dark" />
  <link href="/assets/css/bootstrap-responsive.css" rel="stylesheet" 
        type="text/css"/>
  <!-- Javascript needed for theme toggle, load immediately -->
  <script type="text/javascript" src="/assets/js/switch-css.js"></script>
  <script type="text/javascript">
    set_style_from_cookie(); 
  </script>
</head>


  <body prefix="dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/"> 
    
<!-- Navbar  ================================================== -->
<div class="navbar navbar-fixed-top">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>
      <a class="brand" href="/README.html"><span  class="showtooltip" 
          title="Credits and technical information about this site" 
          data-placement="bottom"><i style="float:right;" class="icon-info-sign" alt="info"></i></span></a>
      <div class="nav-collapse">
        <ul class="nav">
          <li>
          <a href="/index.html">Home</a></li>

          <li>
          <a href="/vita.html">Vita</a></li>

          <li>
          <a href="/research.html">Research</a></li>

          <li>
          <a href="/teaching.html">Teaching</a></li>

          <li>
          <a href="/community.html">Community</a></li>

          <li class="active">
          <a href="/lab-notebook.html">Lab Notebook</a></li>

        </ul>
      </div><!--/.nav-collapse -->

      <!-- Search site using Google's index --><!--
      <form class="navbar-search pull-right" method="get" action="http://google.com/search">
        <p>
          <input type="hidden" name="q" value="site:carlboettiger.info" />
          <input type="text" class="search-query" name="q" />
          <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      -->
      <div id="search">
      <form method="get" class="navbar-search pull-right form-search">
        <p>
        <input type="text" name="search-text" id="search-text">
         <button class="btn btn-mini" type="submit"><i class="icon-search"></i></button> 
        </p>
      </form>
      </div>
     </div> <!-- /container -->
   </div> <!-- /navbar-inner -->
 </div> <!-- /navbar -->



    <div class="container"> <!-- Responsive grid layout --> 

      <header class="jumbotron">
  <h1 class="entry-title">Lab Notebook</h1>
  <h3>(<a href="http://www.carlboettiger.info/2012/09/28/Welcome-to-my-lab-notebook.html">Introduction</a>)</h3>
</header>



<div class="row feed">
  <div class="span3 offset1">
    <h4>  <a property="account" href="https://github.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); return false;"><i class="icon-github" alt="github"></i> Coding </a></h4> 
     <div class="excerpt">
        <ul><li>cboettig pushed to master at cboettig/cboettig.github.com: <em>update site</em> <a href="https://github.com/cboettig/cboettig.github.com/compare/f8081d9c88...1629a5815b">10:32 2013/04/19</a></li><li>cboettig pushed to master at cboettig/nonparametric-bayes: <em>parametric bayes intial example</em> <a href="https://github.com/cboettig/nonparametric-bayes/compare/795bf96ed9...34922e969e">07:44 2013/04/19</a></li><li>cboettig reopened issue cboettig/knitcitations#37: <em>Tooltip should render HTML markup</em> <a href="https://github.com/cboettig/knitcitations/issues/37">07:27 2013/04/19</a></li><li>cboettig commented on issue cboettig/knitcitations#37: <em>Looks like this should work if the html tags are all escaped. Should be a CGI escape filter function call for that I can just swap in...</em> <a href="https://github.com/cboettig/knitcitations/issues/37#issuecomment-16678529">07:27 2013/04/19</a></li><li>cboettig created tag first-submission  at cboettig/ews-review: <em></em> <a href="https://github.com/cboettig/ews-review/tree/first-submission">06:39 2013/04/19</a></li></ul>
    </div>
  </div>
  <div class="span3">
    <h4> <a property="account" href="https://twitter.com/cboettig" onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); return false;"><i class="icon-twitter"></i> Discussing </a></h4> 
     <div class="excerpt">
       <ul><li><p>&quot;Separating Intrinsic and Environmental Contributions to Growth and Their Population Consequences&quot; <a href="http://t.co/ldaPNw4vEB">http://t.co/ldaPNw4vEB</a></p>
 <a href="http://twitter.com/cboettig/statuses/325037221663100929">05:04 2013/04/18</a> </li><li><p>Great piece on Science Ed reform &quot;A Nobel Prize–winning physicist turned science educator, Wieman doesn&#39;t… <a href="http://t.co/3gMv4UCf6W">http://t.co/3gMv4UCf6W</a></p>
 <a href="http://twitter.com/cboettig/statuses/325017757454307328">03:47 2013/04/18</a> </li><li><p>.@lucaborger @DistribEcology Wish my reader would generate DOI-based links for twitter/G+ sharing instead.</p>
 <a href="http://twitter.com/cboettig/statuses/325017408832151552">03:46 2013/04/18</a> </li><li><p>.@lucaborger @DistribEcology uncertainty estimation is: <a href="http://t.co/dZCmRPEFOg">http://t.co/dZCmRPEFOg</a></p>
 <a href="http://twitter.com/cboettig/statuses/325017047979393026">03:44 2013/04/18</a> </li><li><p>.@lucaborger @DistribEcology whoops, stupid links. try: <a href="http://t.co/nKgWDWwPHh">http://t.co/nKgWDWwPHh</a></p>
 <a href="http://twitter.com/cboettig/statuses/325016779187421184">03:43 2013/04/18</a> </li></ul>
    </div> 
  </div> 
  <div class="span3">
    <h4> <a href="http://www.mendeley.com/groups/634301/theoretical-ecology/papers/" onClick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); return false;"><i class="icon-book"></i> Reading </a></h4> 
    <div class="excerpt">
      <ul><li>A Perspective on Steepness, Reference Points, and Stock Assessment: Canadian Journal of Fisheries and Aquatic Sciences (2013). Pages: 130409051208008. Marc Mangel, Alec D MacCall, Jon KT Brodziak, Edward J Dick, Robyn E. Forrest, Roxanna Pourzand, Stephen Ralston et al. <a href="http://www.mendeley.comhttp://www.mendeley.com/c/5727235104/g/634301/mangel-2013-a-perspective-on-steepness-reference-points-and-stock-assessment/">08:26 2013/04/18</a></li><li>The Exit Problem : A New Approach to Diffusion Across Potential Barriers: Volume: 36, Issue: 3. Pages: 604-623. Applied Mathematics, Siam Journal et al. <a href="http://www.mendeley.com/research/exit-problem-new-approach-diffusion-across-potential-barriers-3/">08:23 2013/04/18</a></li><li>Slower recovery in space before collapse of connected populations: Nature (2013). Volume: 496, Issue: 7445. Pages: 355-358. Lei Dai, Kirill S. Korolev, Jeff Gore et al. <a href="http://www.mendeley.comhttp://www.mendeley.com/c/5727235184/g/634301/dai-2013-slower-recovery-in-space-before-collapse-of-connected-populations/">08:23 2013/04/18</a></li><li>The radiative forcing potential of different climate geoengineering options: Atmospheric Chemistry and Physics Discussions (2009). Volume: 9, Issue: 1. Pages: 2559-2608. T. M. Lenton, N. E. Vaughan et al. <a href="http://www.mendeley.com/catalog/radiative-forcing-potential-different-climate-geoengineering-options-12/">08:23 2013/04/18</a></li></ul>
    </div>
  </div> 
</div>

<hr>
<div class="row postpreview">
  <div class="span11 offset1">
    <div class="row">
      <h4> <a href="http://www.carlboettiger.info/atom.xml"
              onClick="recordOutboundLink(this,
              'Outbound Links', 'RSS'); return false;"
              style="color: inherit;"
              ><i class="icon-rss" ></i> Entries</a></h4>
      
        <div class="span3">
          <header><h4><a href="/2013/04/18/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 18 Apr 2013</p>

<p style="font-style:italic"> pageviews: (not calculated) </p>

<article>
<div class="excerpt">
<h2 id="misc-coding">Misc coding</h2>
<ul>
<li><p>knitcitations handling of html formatting in tooltip: html inside the tag must needs be escaped. <a href="https://github.com/cboettig/knitcitations/issues/37">knitcitations/#37</a></p></li>
<li><p>pmc functions</p></li>
</ul>
<p>hmm.. how do we easily wrap a function such that it returns its arguments (given and default) in a named list (appropriate for <code>do.call(function_name, args_list)</code>)? <code>match.call()</code> inside the function will give the literal string of how the function was called, which, if evaluated in the same environment with same variables in working space, will return the same results, but doesn’t lend itself to updating any one of those arguments. Hoped to extract variable values with some combination of <code>formals</code> and <code>match.arg()</code> but no luck.</p>
<ul>
<li>Mendeley API authentication solved using <a href="https://github.com/michalboo/mendeley-oapi/blob/master/authorise.rb">Michal’s clever implementation for OAuth</a>, see my original query on <a href="http://stackoverflow.com/questions/15887366/obtaining-an-oauth-token-in-ruby-for-the-mendeley-api">SO</a></li>
</ul>
<h2 id="nonparametric-bayes">nonparametric-bayes</h2>
<ul>
<li>Implement the SDP calculation for the posterior distributions returned in the parametric comparison case <a href="https://github.com/cboettig/nonparametric-bayes/blob/795bf96ed92a708b44978610da7db3b49ebb4dce/inst/examples/BUGS/allen.Rmd">nonparametric-bayes/allen.Rmd</a>.<br /></li>
<li>Working out the integration over uncertainty for the parameter distribution. Brute force approach clearly doesn’t scale, even on coarse grid, to many parameters. After discussion with Marc, implementing as Monte Carlo instead. As we get samples from the posterior out of the BUGs fit in the first place, this is much more efficient. Should of tried that the first time. <a href="https://github.com/cboettig/nonparametric-bayes/blob/34922e969e984b5d695a5b53aee01aac1ea3b38e/inst/examples/BUGS/par_uncertainty_sdp.md">nonparametric-bayes/par_uncertainty_sdp.Rmd</a></li>
</ul>
<h2 id="warning-signals">warning-signals</h2>
<ul>
<li>Analytic calculation of eigenvalues for managed vs unmanaged system</li>
<li>finish fallacy reply</li>
<li>finish ews-review reply</li>
</ul>
<h2 id="geospatial-coordinates-from-plain-text">Geospatial coordinates from plain text</h2>
<p>Discussed the problem of geolocation from plain text discriptions with Simon a few days ago. I’ve written a simple i<a href="https://github.com/cboettig/sandbox/blob/29ab32342e9c07272b4796778cd86d518368b3b2/R-tricks/fishphotos.R">R function to query place names against the Google Map API</a>, but as Simon has demonstrated, this will often return the coordinates of a cafe in San Fransisco rather than the lake in Italy you meant to get. At DataCite 2011 I had met some folks who mentioned developing a machine learning algorithm for this, though stupidly it looks like I did not record this in my <a href="http://carlboettiger.info/2011/08/24/datacite-day-1.html">notes</a>. Oh well, Google turned up the following interface: <a href="http://geoparser.digmap.eu/advanced.jsp">http://geoparser.digmap.eu/advanced.jsp</a></p>
<p>Click the geoparse example and scroll down in the XML; they assign probabilities of possible spatial matches. For instance, Hiroshima as the name of a “railroad station” gets 0.05 probability, whereas the majority of the weight falls on “populated place” in Japan.</p>
<p>It looks like you could query against the service directly, haven’t really explored.</p>
<p>They have a paper out on this too, <a href="http://oa.upm.es/4367/1/INVE_MEM_2008_60075.pdf">http://oa.upm.es/4367/1/INVE_MEM_2008_60075.pdf</a></p>
<h2 id="reading">Reading</h2>
<ul>
<li><span class="showtooltip" data-html="true" title="<p>Shelton A, Satterthwaite W, Beakes M, Munch S, Sogard S and Mangel M (2013). “Separating Intrinsic And Environmental Contributions to Growth And Their Population Consequences.” The American Naturalist, pp. 000–000. ISSN 00030147.&quot;&gt;<a href="http://dx.doi.org/10.1086/670198" rel="http://purl.org/spar/cito/discusses" >Shelton <em>et. al.</em> (2013)</a></span> provide a rather elegant example of how accounting for individual variation improves modeling efforts in growth dynamics.<br /></li>
<li><p>Measurement error is important but difficult to deal with; a proper state-space model should use all the replicates to estimate the measurement error process. <span class="showtooltip" data-html="true" title="<p>Knape J, Besbeas P and de Valpine P (2013). “Using Uncertainty Estimates in Analyses of Population Time Series.” Ecology, pp. 130417174952006–. ISSN 0012-9658.&quot;&gt;<a href="http://dx.doi.org/10.1890/12-0712.1" rel="http://purl.org/spar/cito/critiques" >Knape <em>et. al.</em> (2013)</a></span> argue that you can do pretty well with just the standard errors from the replicates. – Um, but don’t we know this? We expect the central limit theorem to be pretty good a lot of the time. The demonstration that it can work is not quite as useful as a demonstration of when we might expect it not to; but my quick read may be missing something. Certainly an interesting point to wrestle with before going off the deep end with the state-space modeling each time…</p></li>
<li><p>Looking over an early draft of Duncan and Deborah’s “XML and Web Technologies for Data Sciences with R”. Looks fantastic – where was this 3 years ago?</p></li>
<li><p>Just launched: http://bison.usgs.ornl.gov (US only). Individual sample occurances, but no morphological measurements available.</p></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>Jonas Knape, Panagiotis Besbeas, Perry de Valpine, (2013) Using Uncertainty Estimates in Analyses of Population Time Series. <em>Ecology</em> 130417174952006-NA <a href="http://dx.doi.org/10.1890/12-0712.1">10.1890/12-0712.1</a></li>
<li>Andrew O. Shelton, William H. Satterthwaite, Michael P. Beakes, Stephan B. Munch, Susan M. Sogard, Marc Mangel, (2013) Separating Intrinsic And Environmental Contributions to Growth And Their Population Consequences. <em>The American Naturalist</em> 000-000 <a href="http://dx.doi.org/10.1086/670198">10.1086/670198</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/18/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/17/notes.html">Notes</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 17 Apr 2013</p>

<p style="font-style:italic"> pageviews: 8 </p>

<article>
<div class="excerpt">
<h2 id="warning-signals">warning-signals</h2>
<ul>
<li>Finishing up edits.</li>
<li>Writing PRSB reply</li>
</ul>
<h2 id="logistics">Logistics</h2>
<ul>
<li>In tomorrow’s Marc meeting, check in about what to include for the CSTAR report</li>
<li>manuscript / analysis updates</li>
<li>Comments on recent lit?</li>
</ul>
<h2 id="ropensci">ropensci</h2>
<ul>
<li><a href="https://github.com/ropensci/treeBASE/issues/4">treebase/#4</a></li>
</ul>
<h2 id="reading">Reading</h2>
<ul>
<li><span class="showtooltip" title="Dai L, Korolev K and Gore J (2013). &ldquo;Slower Recovery in Space Before Collapse of Connected Populations.&rdquo; Nature. ISSN 0028-0836, http://dx.doi.org/10.1038/nature12071."><a href="http://dx.doi.org/10.1038/nature12071" rel="http://purl.org/spar/cito/discusses" >Dai <em>et. al.</em> (2013)</a></span> , with introductory piece by <span class="showtooltip"  title="Carpenter S (2013).
&ldquo;Complex Systems: Spatial Signatures of Resilience.&rdquo; Nature. ISSN 0028-0836"><a href="http://dx.doi.org/10.1038/nature12092" rel="http://purl.org/spar/cito/discusses" >Carpenter (2013)</a></span> . In this they look only at the spatial extent of a perturbation. Presumbably one might attempt to compare the spatial extent over time to establish a baseline, or otherwise identify a control system. Very difficult to see how this can be applied without appropriate references.</li>
</ul>
<p>Also provides an elegant and clear, if rather intuitive, demonstration that spatially connected / mixing populations will dampen out the signal. Perhaps the interpretation of this misplaces the emphasis – for the connectedness is allowing the insult (dilution of nutrients) to diffuse among neighbors may be strengthening the resilience relative to an isolated population, and therefore it is only appropriate that the signal would weaken.</p>
<p>Hehe. Nice to see our Prosecutor’s Fallacy paper (<span class="showtooltip"  title="Boettiger C and Hastings A (2012).
&ldquo;Early Warning Signals And The Prosecutor'S Fallacy.&rdquo;
Proceedings of The Royal Society B: Biological Sciences, 279, pp. 4734&ndash;4739.
ISSN 0962-8452"><a href="http://dx.doi.org/10.1098/rspb.2012.2085" rel="http://purl.org/spar/cito/citesAsEvidence" >Boettiger &amp; Hastings, 2012</a></span> ) being used as further evidence for the value of experimental confirmation: “tests of these indicators in replicated experiments, which avoid the bias intro- duced by selective sampling (23) are lacking.”</p>
<ul>
<li><span class="showtooltip"  title="Glaser S, Fogarty M, Liu H, Altman I, Hsieh C, Kaufman L, MacCall A, Rosenberg A, Ye H and Sugihara G (2013).
&ldquo;Complex Dynamics May Limit Prediction in Marine Fisheries.&rdquo; Fish And Fisheries, pp. n/a&ndash;n/a."><a href="http://dx.doi.org/10.1111/faf.12037" rel="http://purl.org/spar/cito/discusses" >Glaser <em>et. al.</em> (2013)</a></span> . Nonlinear forecasting doesn’t perform well across the board on these various fisheries data. Authors conclude that this suggests these systems are inherently unpredictable, though seems one could do more to rule out methodological weaknesses and make a more precise statement (perhaps a mutual information claim). Their approach having a large suite of data sets against which to test the performance of a method is nevertheless an interesting idea that’s had some popularity in the machine learning world. Hopefully more researchers will attempt a parallel analysis of these data.</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>C. Boettiger, A. Hastings, (2012) Early Warning Signals And The Prosecutor’S Fallacy. <em>Proceedings of The Royal Society B: Biological Sciences</em> <strong>279</strong> 4734-4739 <a href="http://dx.doi.org/10.1098/rspb.2012.2085">10.1098/rspb.2012.2085</a></li>
<li>Stephen R. Carpenter, (2013) Complex Systems: Spatial Signatures of Resilience. <em>Nature</em> <a href="http://dx.doi.org/10.1038/nature12092">10.1038/nature12092</a></li>
<li>Lei Dai, Kirill S. Korolev, Jeff Gore, (2013) Slower Recovery in Space Before Collapse of Connected Populations. <em>Nature</em> <a href="http://dx.doi.org/10.1038/nature12071">10.1038/nature12071</a></li>
<li>Sarah M Glaser, Michael J Fogarty, Hui Liu, Irit Altman, Chih-Hao Hsieh, Les Kaufman, Alec D MacCall, Andrew A Rosenberg, Hao Ye, George Sugihara, (2013) Complex Dynamics May Limit Prediction in Marine Fisheries. <em>Fish And Fisheries</em> n/a-n/a <a href="http://dx.doi.org/10.1111/faf.12037">10.1111/faf.12037</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/17/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/16/notes.html">a few notes on various projects</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 16 Apr 2013</p>

<p style="font-style:italic"> pageviews: 14 </p>

<article>
<div class="excerpt">
<h2 id="warning-signals">warning-signals</h2>
<ul>
<li>Working on revisions for <a href="https://github.com/cboettig/ews-review/">ews-review</a></li>
<li>Grr, the challenges of open science – can’t stick confidential reviews in ews-review repo where they belong, or track them on the issues tracker, without disclosing their contents. What are the terms of use for these things anyhow&gt;</li>
</ul>
<h2 id="phylogentics-pmc">phylogentics / pmc</h2>
<ul>
<li>Apparently pmc does have users – at least one recognized that my Vignette is broken following the latest Gieger update. Need to add simulate and update methods for the new fitContinuous, and then integrate these. <a href="https://github.com/cboettig/pmc/issues/3">pmc/#3</a></li>
<li>Another pmc request. Sounds like I should also add support for OUwie fits. See if I can get Jeremy to add <code>simulate</code> and <code>update</code> methods. <a href="https://github.com/cboettig/pmc/issues/4">pmc/#4</a></li>
</ul>
<blockquote>
<p><strong>Dear phylogeneticists</strong>: please define a methods API for your functions. Accessing coefficients using something like <code>output[[1]][[2]]$somevar$name[4]</code> is not only cumbersome, but bound to break when you modify your function, so provide a <code>coef</code> method. Likewise provide <code>simulate</code> and <code>update</code> methods so we can all raise the bar on our statistics a little bit.</p>
</blockquote>
<p>Alternatively put the code on Github, where sensible folks can fork it, add some common-sense classes and give you a pull request.</p>
<h2 id="code-tricks">Code tricks</h2>
<p>Because I’m always wondering how to do this one: let’s see what methods are defined for Geiger’s new <code>gfit</code> class:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(<span class="dt">class=</span><span class="st">&quot;gfit&quot;</span>)</code></pre>
<p>Returns:</p>
<pre class="sourceCode r"><code class="sourceCode r">[<span class="dv">1</span>] coef.gfit*<span class="st">   </span>logLik.gfit*

<span class="st">   </span>Non-visible functions are asterisked</code></pre>
<p>ht Michael Hannon for that one, and a good way to confuse some folks on <a href="http://stackoverflow.com/questions/16048949">SO</a>.</p>
<h2 id="knitcitations">knitcitations</h2>
<ul>
<li>Fixed a minor issue in tooltip formatting, <a href="https://github.com/cboettig/knitcitations/issues/37">knitcitations/#37</a>. Unfortunately not updated in earlier notebook entires, but should be fixed from here on).<br /></li>
<li>Interesting ideas from some folks about adding CSL support, and thinking about being able to pull data into knitcitations from personal zotero libraries, <a href="https://github.com/cboettig/knitcitations/issues/38">knitcitations/#38</a>. Zotero API seems to have some nice features for listing entries of a collection in a variety of file formats, including CSL styling for the returns.<br /></li>
<li>Nearly a month since last push (0.4-4). Should update CRAN to current development version (0.4-6) sometime this week…</li>
</ul>
<h2 id="reading">Reading</h2>
<ul>
<li><p>The debates continue: <a href="http://dx.doi.org/10.1073/pnas.1301759110" rel="http://purl.org/spar/cito/discusses" >Szuwalski (2013)</a> , and the reply <a href="http://dx.doi.org/10.1073/pnas.1302181110" rel="http://purl.org/spar/cito/discusses" >Vert-pre <em>et. al.</em> (2013)</a> , reflecting confusion over the article earlier this year, <a href="http://dx.doi.org/10.1073/pnas.1214879110" rel="http://purl.org/spar/cito/discusses" >Vert-pre <em>et. al.</em> (2013b)</a> .</p></li>
<li><p>Disupting the claim of <a href="http://dx.doi.org/10.1029/2010GL044486" rel="http://purl.org/spar/cito/discusses" >Ditlevsen &amp; Johnsen (2010)</a> and others, <a href="http://dx.doi.org/10.5194/cp-9-323-2013" rel="http://purl.org/spar/cito/citesAsEvidence" >Cimatoribus <em>et. al.</em> (2013)</a> argue that DO events do show warning signals. But are they chance transitions then?</p></li>
<li><p>Looking over <a href="http://dx.doi.org/10.1038/nclimate1143" rel="http://purl.org/spar/cito/citesAsAuthority" >Lenton (2011)</a> , which has a review of some of the evidence against warning signals for noise-induced transitions.</p></li>
<li><p>An even earlier result from Ludwig, in <a href="http://dx.doi.org/10.1137/1017070" rel="http://purl.org/spar/cito/citesAsEvidence" >Ludwig (1975)</a> .</p></li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>A. A. Cimatoribus, S. S. Drijfhout, V. Livina, G. van der Schrier, (2013) Dansgaard–Oeschger Events: Bifurcation Points in The Climate System. <em>Climate of The Past</em> <strong>9</strong> 323-333 <a href="http://dx.doi.org/10.5194/cp-9-323-2013">10.5194/cp-9-323-2013</a></li>
<li>Peter D. Ditlevsen, Sigfus J. Johnsen, (2010) Tipping Points: Early Warning And Wishful Thinking. <em>Geophysical Research Letters</em> <strong>37</strong> n/a-n/a <a href="http://dx.doi.org/10.1029/2010GL044486">10.1029/2010GL044486</a></li>
<li>Timothy M. Lenton, (2011) Early Warning of Climate Tipping Points. <em>Nature Climate Change</em> <strong>1</strong> 201-209 <a href="http://dx.doi.org/10.1038/nclimate1143">10.1038/nclimate1143</a></li>
<li>Donald Ludwig, (1975) Persistence of Dynamical Systems Under Random Perturbations. <em>Siam Review</em> <strong>17</strong> 605-640 <a href="http://dx.doi.org/10.1137/1017070">10.1137/1017070</a></li>
<li>C. Szuwalski, (2013) Production is A Poor Metric For Identifying Regime-Like Behavior in Marine Stocks. <em>Proceedings of The National Academy of Sciences</em> <strong>110</strong> E1436-E1436 <a href="http://dx.doi.org/10.1073/pnas.1301759110">10.1073/pnas.1301759110</a></li>
<li>K. A. Vert-pre, R. O. Amoroso, O. P. Jensen, R. Hilborn, (2013) Reply to Szuwalski: Policies Robust to Uncertainty in Causes of Productivity Changes Are Needed. <em>Proceedings of The National Academy of Sciences</em> <strong>110</strong> E1437-E1437 <a href="http://dx.doi.org/10.1073/pnas.1302181110">10.1073/pnas.1302181110</a></li>
<li>K. A. Vert-pre, R. O. Amoroso, O. P. Jensen, R. Hilborn, (2013) Frequency And Intensity of Productivity Regime Shifts in Marine Fish Stocks. <em>Proceedings of The National Academy of Sciences</em> <strong>110</strong> 1779-1784 <a href="http://dx.doi.org/10.1073/pnas.1214879110">10.1073/pnas.1214879110</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/16/notes.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/04/12/parametric-bayesian-example.html">Parametric Bayesian Example</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 12 Apr 2013</p>

<p style="font-style:italic"> pageviews: (not calculated) </p>

<article>
<div class="excerpt">
<p>As discussed with Marc in yesterday’s meeting, it would be useful to compare the Gaussian process, as a nonparametric Bayesian estimate, to the optimal management solution under a <em>parametric</em> Bayesian case, e.g. with the correct underlying model. This is implemented in BUGS (jags) through the R interface as described in <span class="showtooltip" data-html="true" title="<p>Bolker B, Gardner B, Maunder M, Berg C, Brooks M, Comita L, Crone E, Cubaynes S, Davies T, de Valpine P, Ford J, Gimenez O, Kery M, Kim E, Lennert-Cody C, Magnusson A, Martell S, Nash J, Nielsen A, Regetz J, Skaug H and Zipkin E (2013). “Strategies For Fitting Nonlinear Ecological Models in R, ad Model Builder, And Bugs.” Methods in Ecology And Evolution, pp. n/a–n/a. .“&gt;<a href="http://dx.doi.org/10.1111/2041-210X.12044" rel="http://purl.org/spar/cito/usesMethodIn" >Bolker <em>et. al.</em> (2013)</a></span> , and follows the state-space model analysis along the lines outlined in <span class="showtooltip" data-html="true" title="<p>Pedersen M, Berg C, Thygesen U, Nielsen A and Madsen H (2011). “Estimation Methods For Nonlinear State-Space Models in Ecology.” Ecological Modelling, 222, pp. 1394–1400. ISSN 03043800.&quot;&gt;<a href="http://dx.doi.org/10.1016/j.ecolmodel.2011.01.007" rel="http://purl.org/spar/cito/usesMethodIn" >Pedersen <em>et. al.</em> (2011)</a></span> .</p>
<p>We base the estimate on the same simulated data as for the GP and MLE approaches,</p>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>RickerAllee
p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">5</span>)
K &lt;-<span class="st"> </span><span class="dv">10</span>
allee &lt;-<span class="st"> </span><span class="dv">5</span></code></pre>
<p>with the same parameters (many of which we won’t need until the SDP value iteration),</p>
<pre class="sourceCode r"><code class="sourceCode r">sigma_g &lt;-<span class="st"> </span><span class="fl">0.05</span>
sigma_m &lt;-<span class="st"> </span><span class="dv">0</span>
z_g &lt;-<span class="st"> </span>function() <span class="kw">rlnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma_g)
z_m &lt;-<span class="st"> </span>function() <span class="dv">1</span> +<span class="st"> </span>(<span class="dv">2</span> *<span class="st"> </span><span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>) -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>sigma_m
x_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span> *<span class="st"> </span>K, <span class="dt">length =</span> <span class="dv">101</span>)
h_grid &lt;-<span class="st"> </span>x_grid
profit &lt;-<span class="st"> </span>function(x, h) <span class="kw">pmin</span>(x, h)
delta &lt;-<span class="st"> </span><span class="fl">0.01</span>
OptTime &lt;-<span class="st"> </span><span class="dv">20</span>  <span class="co"># stationarity with unstable models is tricky thing</span>
reward &lt;-<span class="st"> </span><span class="dv">0</span>
xT &lt;-<span class="st"> </span><span class="dv">0</span>
seed_i &lt;-<span class="st"> </span><span class="dv">1</span>
Xo &lt;-<span class="st"> </span>K  <span class="co"># observations start from</span>
x0 &lt;-<span class="st"> </span>Xo  <span class="co"># simulation under policy starts from</span>
Tobs &lt;-<span class="st"> </span><span class="dv">35</span></code></pre>
<p>Generate the simulated data</p>
<pre class="sourceCode r"><code class="sourceCode r">obs &lt;-<span class="st"> </span><span class="kw">sim_obs</span>(Xo, z_g, f, p, <span class="dt">Tobs =</span> Tobs, <span class="dt">nz =</span> <span class="dv">1</span>, <span class="dt">harvest =</span> <span class="kw">sort</span>(<span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">0</span>, 
    <span class="fl">0.5</span>, <span class="dt">length =</span> <span class="dv">7</span>), <span class="dv">5</span>)), <span class="dt">seed =</span> seed_i)</code></pre>
<p>And fit the MLE models as before</p>
<pre class="sourceCode r"><code class="sourceCode r">alt &lt;-<span class="st"> </span><span class="kw">par_est</span>(obs, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dt">r =</span> p[<span class="dv">1</span>], <span class="dt">K =</span> <span class="kw">mean</span>(obs$x[obs$x &gt;<span class="st"> </span><span class="dv">0</span>]), 
    <span class="dt">s =</span> sigma_g))
est &lt;-<span class="st"> </span><span class="kw">par_est_allee</span>(obs, f, p, <span class="dt">init =</span> <span class="kw">c</span>(<span class="dt">r =</span> p[<span class="dv">1</span>] +<span class="st"> </span><span class="dv">1</span>, <span class="dt">K =</span> p[<span class="dv">2</span>] +<span class="st"> </span>
<span class="st">    </span><span class="dv">2</span>, <span class="dt">C =</span> p[<span class="dv">3</span>] +<span class="st"> </span><span class="dv">2</span>, <span class="dt">s =</span> sigma_g))</code></pre>
<h2 id="parametric-bayesian-model-fit">Parametric Bayesian model fit</h2>
<p>We will use the jags interface from R,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(R2jags)</code></pre>
<p>initialize parameters. The parametric equation (in this case, matching the true dynamics) and priors are defined <a href="https://github.com/cboettig/nonparametric-bayes/blob/795bf96ed92a708b44978610da7db3b49ebb4dce/inst/examples/BUGS/bugmodel-GammaPrior.txt">in BUGS notation in text file</a>.</p>
<pre class="sourceCode r"><code class="sourceCode r">init_p =<span class="st"> </span>est$p
<span class="kw">names</span>(init_p) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r0&quot;</span>, <span class="st">&quot;K&quot;</span>, <span class="st">&quot;theta&quot;</span>)
y &lt;-<span class="st"> </span>obs$y[-<span class="dv">1</span>]
N =<span class="st"> </span><span class="kw">length</span>(y)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">jags.data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;y&quot;</span>)
n.chains =<span class="st"> </span><span class="dv">1</span>
n.iter =<span class="st"> </span><span class="dv">20000</span>
n.burnin =<span class="st"> </span><span class="kw">floor</span>(n.iter/<span class="dv">2</span>)
n.thin =<span class="st"> </span><span class="kw">max</span>(<span class="dv">1</span>, <span class="kw">floor</span>(n.chains *<span class="st"> </span>(n.iter -<span class="st"> </span>n.burnin)/<span class="dv">1000</span>))</code></pre>
<h2 id="jags-using-gamma-priors-on-precision">JAGS using gamma priors on precision</h2>
<pre class="sourceCode r"><code class="sourceCode r">jags.params=<span class="kw">c</span>(<span class="st">&quot;K&quot;</span>,<span class="st">&quot;logr0&quot;</span>,<span class="st">&quot;logtheta&quot;</span>,<span class="st">&quot;iR&quot;</span>,<span class="st">&quot;iQ&quot;</span>); <span class="co"># Don&#39;t need to save &quot;x&quot;</span>
jags.inits &lt;-<span class="st"> </span>function(){
  <span class="kw">list</span>(<span class="st">&quot;K&quot;</span>=init_p[<span class="st">&quot;K&quot;</span>],<span class="st">&quot;logr0&quot;</span>=<span class="kw">log</span>(init_p[<span class="st">&quot;r0&quot;</span>]),<span class="st">&quot;logtheta&quot;</span>=<span class="kw">log</span>(init_p[<span class="st">&quot;theta&quot;</span>]),<span class="st">&quot;iQ&quot;</span>=<span class="dv">1</span>/<span class="fl">0.05</span>,<span class="st">&quot;iR&quot;</span>=<span class="dv">1</span>/<span class="fl">0.1</span>,<span class="st">&quot;x&quot;</span>=y,<span class="dt">.RNG.name=</span><span class="st">&quot;base::Wichmann-Hill&quot;</span>, <span class="dt">.RNG.seed=</span><span class="dv">123</span>)
}
<span class="kw">set.seed</span>(<span class="dv">12345</span>)
time&lt;-<span class="kw">system.time</span>(       
  jagsfit &lt;-<span class="st"> </span><span class="kw">jags</span>(<span class="dt">data=</span>jags.data, <span class="dt">inits=</span>jags.inits, jags.params, <span class="dt">n.chains=</span>n.chains, 
                  <span class="dt">n.iter=</span>n.iter, <span class="dt">n.thin=</span>n.thin, <span class="dt">n.burnin=</span>n.burnin,<span class="dt">model.file=</span><span class="st">&quot;bugmodel-GammaPrior.txt&quot;</span>)
)         </code></pre>
<pre class="sourceCode r"><code class="sourceCode r">time &lt;-<span class="st"> </span><span class="kw">unname</span>(time[<span class="st">&quot;elapsed&quot;</span>]);</code></pre>
<h2 id="summarize-the-results">Summarize the results</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(emdbook)
<span class="kw">library</span>(coda)
tfit_jags_m &lt;-<span class="st"> </span><span class="kw">as.mcmc.bugs</span>(jagsfit$BUGSoutput)
<span class="kw">print</span>(<span class="kw">xyplot</span>(tfit_jags_m))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8258/8662939943_0e5faa9dc0_o.png" alt="Parameter traces provide a visual tool to assess performance and convergence of the MCMC routine" /><p class="caption">Parameter traces provide a visual tool to assess performance and convergence of the MCMC routine</p>
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">densityplot</span>(tfit_jags_m))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8261/8662940039_3f5dbeee9d_o.png" alt="The resulting posterior distributions for the model parameters inferred" /><p class="caption">The resulting posterior distributions for the model parameters inferred</p>
</div>
<p>We collect model parameters over the replicate runs,</p>
<pre class="sourceCode r"><code class="sourceCode r">mcmc &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(jagsfit)
mcmcall &lt;-<span class="st"> </span>mcmc[, -<span class="dv">2</span>]
who &lt;-<span class="st"> </span><span class="kw">colnames</span>(mcmcall)
mcmcall &lt;-<span class="st"> </span><span class="kw">cbind</span>(mcmcall[, <span class="dv">1</span>], mcmcall[, <span class="dv">2</span>], mcmcall[, <span class="dv">3</span>], mcmcall[, 
    <span class="dv">4</span>], mcmcall[, <span class="dv">5</span>])
<span class="kw">colnames</span>(mcmcall) &lt;-<span class="st"> </span>who</code></pre>
<h2 id="further-parameter-exploration">Further parameter exploration</h2>
<p>We will need to integrate over parameter uncertainty. Can consider the discritized binning</p>
<pre class="sourceCode r"><code class="sourceCode r">theta &lt;-<span class="st"> </span><span class="kw">exp</span>(mcmcall[, <span class="st">&quot;logtheta&quot;</span>])
theta_dist &lt;-<span class="st"> </span><span class="kw">hist</span>(theta, <span class="dt">freq =</span> <span class="ot">FALSE</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8255/8662940161_6cfebf6a91_o.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">theta_dist$mids</code></pre>
<pre><code>##  [1] 0.25 0.75 1.25 1.75 2.25 2.75 3.25 3.75 4.25 4.75 5.25 5.75 6.25 6.75
## [15] 7.25</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">theta_dist$density</code></pre>
<pre><code>##  [1] 1.154 0.256 0.130 0.092 0.068 0.058 0.044 0.042 0.042 0.018 0.022
## [12] 0.026 0.022 0.014 0.012</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">delta &lt;-<span class="st"> </span>theta_dist$mids[<span class="dv">2</span>] -<span class="st"> </span>theta_dist$mids[<span class="dv">1</span>]</code></pre>
<p>Evaluating the value function given <span class="math">\(f\)</span> fixed at each of <code>theta_dist$mids</code> multiplied by <code>theta_dist$density * delta</code> and summed over each <span class="math">\(\theta\)</span> is going to be slow for a single parameter but simply unrealistic for higher dimensions.</p>
<h2 id="references">References</h2>
<ul>
<li>Benjamin M. Bolker, Beth Gardner, Mark Maunder, Casper W. Berg, Mollie Brooks, Liza Comita, Elizabeth Crone, Sarah Cubaynes, Trevor Davies, Perry de Valpine, Jessica Ford, Olivier Gimenez, Marc Kery, Eun Jung Kim, Cleridy Lennert-Cody, Arni Magnusson, Steve Martell, John Nash, Anders Nielsen, Jim Regetz, Hans Skaug, Elise Zipkin, (2013) Strategies For Fitting Nonlinear Ecological Models in R, ad Model Builder, And Bugs. <em>Methods in Ecology And Evolution</em> n/a-n/a <a href="http://dx.doi.org/10.1111/2041-210X.12044">10.1111/2041-210X.12044</a></li>
<li>M.W. Pedersen, C.W. Berg, U.H. Thygesen, A. Nielsen, H. Madsen, (2011) Estimation Methods For Nonlinear State-Space Models in Ecology. <em>Ecological Modelling</em> <strong>222</strong> 1394-1400 <a href="http://dx.doi.org/10.1016/j.ecolmodel.2011.01.007">10.1016/j.ecolmodel.2011.01.007</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/12/parametric-bayesian-example.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/11/tutorial-on-likelihood-and-roc-methods-for-early-warning-signals.html">Tutorial On Likelihood And Roc Methods For Early Warning Signals</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 11 Apr 2013</p>

<p style="font-style:italic"> pageviews: 26 </p>

<article>
<div class="excerpt">
<p>In this tutorial we walk through how to use the likelihood-based approach of <span class="showtooltip" title="Boettiger C and Hastings A (2012). Quantifying Limits to
Detection of Early Warning For Critical Transitions. _Journal of
The Royal Society Interface_, *9*, pp. 2527-2539. ISSN 1742-5689,
 http://dx.doi.org/10.1098/rsif.2012.0125."><a href="http://dx.doi.org/10.1098/rsif.2012.0125" rel="http://purl.org/spar/cito/usesMethodFrom" >Boettiger &amp; Hastings (2012)</a></span> to provide an early warning signal for a critical transition, and how to generate ROC curves discussed in the same paper for comparing different early warning signals. Context and details about the methodology are presented in the paper; here we focus on using the methodology provided in the accompanying R package. All of the examples shown here can be reproduced by pasting the code provided into an R terminal. We will need the following libraries to run this example. If you don’t have them, they can be installed from CRAN using the <code>install.packages</code> function.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(reshape2)
<span class="kw">library</span>(multicore)
<span class="kw">library</span>(devtools)</code></pre>
<p>We will be using custom functions provided in the R package Boettiger, (2012) that accompanies Boettiger &amp; Hastings, (2012), which can be installed directly from the development repository on GitHub:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install_github</span>(<span class="st">&quot;earlywarning&quot;</span>, <span class="st">&quot;cboettig&quot;</span>)
<span class="kw">library</span>(earlywarning)</code></pre>
<p>We begin by loading the <code>ibm_critical</code> data provided in the package (from an individual-based model simulation of a critical transition). We plot the raw data to take a look at it.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;ibms&quot;</span>)
<span class="kw">plot</span>(ibm_critical, <span class="dt">type=</span><span class="st">&quot;b&quot;</span>)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8261/8641108753_956f179a1d_o.png" />
</div>
<p>Fit both models to the original data, record the observed likelihood ratio of the original data</p>
<pre class="sourceCode r"><code class="sourceCode r">A &lt;-<span class="st"> </span><span class="kw">stability_model</span>(ibm_critical, <span class="st">&quot;OU&quot;</span>)
B &lt;-<span class="st"> </span><span class="kw">stability_model</span>(ibm_critical, <span class="st">&quot;LSN&quot;</span>)
observed &lt;-<span class="st"> </span>-<span class="dv">2</span> *<span class="st"> </span>(<span class="kw">logLik</span>(A) -<span class="st"> </span><span class="kw">logLik</span>(B))</code></pre>
<p>Perform the bootstrapped model comparison on the parallel cluster.</p>
<pre class="sourceCode r"><code class="sourceCode r">runtime &lt;-<span class="st"> </span><span class="kw">system.time</span>(
reps &lt;-<span class="st"> </span><span class="kw">mclapply</span>(<span class="dv">1</span>:<span class="dv">200</span>, function(i) <span class="kw">compare</span>(A, B)))</code></pre>
<p>Which took 4176.78 seconds to run for the example shown here.</p>
<p>A helper function extracts the likelihood ratios under each of the pairwise comparisons (The null distribution: -2 times the log likelihood of data fit under A that had been simulated under A, minus the log likelihood of fits under A simulated under B; and the test distribution: fit under B when simulated under A, minus the loglikehood of being fit under B, simulated under B) as a data frame. we show the top of the data frame as output below.</p>
<pre class="sourceCode r"><code class="sourceCode r">lr &lt;-<span class="st"> </span><span class="kw">lik_ratios</span>(reps)
<span class="kw">head</span>(lr)</code></pre>
<pre><code>##   simulation rep     value
## 1       null   1  0.001659
## 2       test   1  2.255139
## 3       null   2  1.892615
## 4       test   2  9.804084
## 5       null   3  4.795269
## 6       test   3 22.696982</code></pre>
<p>We use this data to generate the overlapping distributions shown in Boettiger &amp; Hastings, (2012),</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(lr) +<span class="st"> </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(value, <span class="dt">fill=</span>simulation), <span class="dt">alpha=</span><span class="fl">0.6</span>) +<span class="st"> </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span>observed))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8245/8642325058_d70eaee962_o.png" />
</div>
<p>A second helper function generates the ROC curve from the likelihood ratio data, providing an alternative way to visualize this overlap:</p>
<pre class="sourceCode r"><code class="sourceCode r">roc &lt;-<span class="st"> </span><span class="kw">roc_data</span>(lr)
<span class="kw">ggplot</span>(roc) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(False.positives, True.positives))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8402/8641224925_83a045afbb_o.png" />
</div>
<p>ROC curves are particularly useful in comparing the power of a variety of approaches. For instance, we can compare the performance of the likelihood-based signal shown above to the traditional approach of using a correlation coefficient to detect the increase in some summary statistic such as variance or autocorrelation. To obtain replicates, we will still simulate under the null (OU) and test (LSN) models estimated above, but instead of computing the likelihood of these data, we will estimate the commonly used rank correlation coefficient, Kendall’s tau, to quantify the increase in variance, autcorrelation, and skew observed in a moving window over the data.</p>
<pre class="sourceCode r"><code class="sourceCode r">var &lt;-<span class="st"> </span><span class="kw">bootstrap_trend</span>(ibm_critical, window_var, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>, <span class="dt">rep=</span><span class="dv">200</span>)
acor &lt;-<span class="st"> </span><span class="kw">bootstrap_trend</span>(ibm_critical, window_autocorr, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>, <span class="dt">rep=</span><span class="dv">200</span>)
skew &lt;-<span class="st"> </span><span class="kw">bootstrap_trend</span>(ibm_critical, window_skew, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>, <span class="dt">rep=</span><span class="dv">200</span>)</code></pre>
<p>These data are formatted like the likeihood ratio data above, only that the statistic is now Kendall’s tau.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(var) +<span class="st"> </span><span class="kw">geom_density</span>(<span class="kw">aes</span>(value, <span class="dt">fill=</span>simulation), <span class="dt">alpha=</span><span class="fl">0.6</span>) +<span class="st"> </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept=</span>observed))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8265/8642341382_1d87080d5c_o.png" />
</div>
<p>We can combine the data for the ROC curves of each indicator to compare:</p>
<pre class="sourceCode r"><code class="sourceCode r">indicators &lt;-<span class="st"> </span><span class="kw">melt</span>(<span class="kw">list</span>(<span class="dt">var =</span> <span class="kw">roc_data</span>(var), <span class="dt">acor =</span> <span class="kw">roc_data</span>(acor), <span class="dt">skew =</span> <span class="kw">roc_data</span>(skew), <span class="dt">lr =</span> roc), <span class="dt">id =</span> <span class="kw">c</span>(<span class="st">&quot;Threshold&quot;</span>, <span class="st">&quot;False.positives&quot;</span>, <span class="st">&quot;True.positives&quot;</span>))
<span class="kw">ggplot</span>(indicators) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(False.positives, True.positives, <span class="dt">color=</span>L1)) </code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8122/8641241253_4c3704523e_o.png" />
</div>
<ul>
<li>C. Boettiger, A. Hastings, (2012) Quantifying Limits to Detection of Early Warning For Critical Transitions. <em>Journal of The Royal Society Interface</em> <strong>9</strong> 2527-2539 <a href="http://dx.doi.org/10.1098/rsif.2012.0125">10.1098/rsif.2012.0125</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/11/tutorial-on-likelihood-and-roc-methods-for-early-warning-signals.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/11/nonparametric-bayes-framing-the-issues.html">nonparametric-bayes: framing the issues for the manuscript</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 11 Apr 2013</p>

<p style="font-style:italic"> pageviews: 27 </p>

<article>
<div class="excerpt">
<h2 id="marc-meeting-nonparametric-bayes-manuscript">Marc meeting: nonparametric-bayes manuscript</h2>
<p>Very good meeting today going over some big picture considerations in the presentation of the nonparametric-bayes manuscript with Marc. (Also see new entries in issues log on nonparametric-bayes.) Make it clear that we are making a point rather than providing a tool. Focus on the tipping point context rather than the general management context.</p>
<ul>
<li>Comparison against a parametric Bayesian model (<a href="https://github.com/cboettig/nonparametric-bayes/issues/40">40</a>)</li>
<li>Comparison against an active learning parametric model facing a tipping point (<a href="https://github.com/cboettig/nonparametric-bayes/issues/41">41</a>)</li>
</ul>
<h2 id="parametric-bayesian-model">Parametric Bayesian model</h2>
<p>Drafting parametric Bayesian case for comparison, following Marc’s suggestion. So far, <a href="https://github.com/cboettig/nonparametric-bayes/commit/795bf96ed92a708b44978610da7db3b49ebb4dce">code as implemented in BUGS</a></p>
<h2 id="more-on-the-exit-time-problem">More on the exit time problem</h2>
<ul>
<li>Alan pointed me to earlier work of <span class="showtooltip" title="Schuss Z and Matkowsky B (1979). The Exit Problem: A New Approach
to Diffusion Across Potential Barriers. _Siam Journal on Applied
Mathematics_, *36*, pp. 604-623. ISSN 0036-1399, 
http://dx.doi.org/10.1137/0136043."><a href="http://dx.doi.org/10.1137/0136043" rel="http://purl.org/spar/cito/discusses" >Schuss &amp; Matkowsky (1979)</a></span><br /></li>
<li>Also, an electronic version of Don Ludwig’s article: <span class="showtooltip" title="Donald Ludwig, (1981). Escape from Domains of Attraction for Systems Perturbed by Noise, Nonlinear Phenomena in Physics and Biology."><a href="http://link.springer.com/chapter/10.1007/978-1-4684-4106-2_14" rel="http://purl.org/spar/cito/usesMethodFrom" >Ludwig (1981)</a></span></li>
</ul>
<h2 id="warning-signals-reading">Warning signals Reading</h2>
<ul>
<li><p>Alan pointed out <span class="showtooltip" title="Boerlijst M, Oudman T, de Roos A and Solé R (2013). Catastrophic
Collapse Can Occur Without Early Warning: Examples of Silent
Catastrophes in Structured Ecological Models. _Plos One_, *8*,
pp. e62033-. 
http://dx.doi.org/10.1371/journal.pone.0062033."><a href="http://dx.doi.org/10.1371/journal.pone.0062033" rel="http://purl.org/spar/cito/reviews" >Boerlijst <em>et. al.</em> (2013)</a></span> on warning signals in PLoS ONE today. A very nice piece! It’s quite useful how it show that the early warning signal can appear in unmonitored variables (e.g. juvenile dynamics) or in variables without adequate noise to provide a signal. Kind of funny that they pitch it as a counterexample to the conjecture that early warning signals are universal, since even Scheffer has avoided that word, and it’s not really a counterexample given the caveat of some process noise and complete observability of the system people have so far assumed (while your work with Derin is a more conclusive counter-example by going beyond fold bifurcations)… Anyway, good examples. We need a better understanding of warning signals in this multi-dimensional context at large.</p></li>
<li><p>Recently Noam pointed out <span class="showtooltip" title="Streeter R and Dugmore A (2013). Anticipating Land Surface
Change. _Proceedings of The National Academy of Sciences_, *110*,
pp. 5779-5784. ISSN 0027-8424, 
http://dx.doi.org/10.1073/pnas.1220161110."><a href="http://dx.doi.org/10.1073/pnas.1220161110" rel="http://purl.org/spar/cito/discusses" >Streeter &amp; Dugmore (2013)</a></span> , which looks like a nice spatial warning signal example (with the classic patterns, rather than the <span class="showtooltip" title="Bel G, Hagberg A and Meron E (2012). Gradual Regime Shifts in
Spatially Extended Ecosystems. _Theoretical Ecology_, *5*, pp.
591-604. ISSN 1874-1738, 
http://dx.doi.org/10.1007/s12080-011-0149-6."><a href="http://dx.doi.org/10.1007/s12080-011-0149-6" rel="http://purl.org/spar/cito/containsAssertionFrom" >Bel <em>et. al.</em> (2012)</a></span> pattern), but haven’t had time for a closer read yet.</p></li>
</ul>
<h2 id="other-reading">Other reading</h2>
<ul>
<li><p>Trying to get a hold of <span class="showtooltip" title="Ludwig D and Walters C (1981). Measurement Errors And Uncertainty
in Parameter Estimates For Stock And Recruitment. _Canadian
Journal of Fisheries And Aquatic Sciences_, *38*, pp. 711-720.
ISSN 0706-652X,  http://dx.doi.org/10.1139/f81-094."><a href="http://dx.doi.org/10.1139/f81-094" rel="http://purl.org/spar/cito/discusses" >Ludwig &amp; Walters (1981)</a></span> as well. A tough day for reading with the UCSC subscription access down due to “power outages”</p></li>
<li><p>Interesting preprint on advice for data reuse, <span class="showtooltip" title="White EP, Baldridge E, Brym ZT, Locey KJ, McGlinn DJ and Supp SR
(2013). Nine simple ways to make it easier to (re)use your data.
 https://peerj.com/preprints/7 [Online. last-accessed:
2013-04-15 21:19:41].  http://peerj.com/preprints/7."><a href="http://peerj.com/preprints/7" rel="http://purl.org/spar/cito/discusses" >White <em>et. al.</em> (2013)</a></span></p></li>
</ul>
<h3 id="misc-and-code-tricks">Misc and code-tricks</h3>
<ul>
<li><p>My knitr scripts are not executing in parallel with snow/snowfall packages(?) Parallelizes fine when run chunk by chunk. (e.g. <a href="https://github.com/cboettig/earlywarning/blob/8bf907c21f8eb0f69f6995a94d21ab0eac6e214a/inst/examples/example.Rmd">example with snowfall</a>). Knitr runs parallel fine with <code>multicore</code>. Weird.</p></li>
<li><p>An interesting puzzle on knitr list today: wrangling crazy ascii tables in <code>Hmisc::summary.function</code>. A good solution would just rewrite the class’s <code>print</code> method to be a table object (e.g. compatible with <code>xtable</code> and <code>pander::pandoc_table</code>), but instead we can hack the ascii, adjusting the options that are passed to <code>print.char.matrix</code>:</p></li>
<li><p>Created a <a href="http://purl.org">PURL</a> persistent identifier for the notebook <a href="http://purl.org/globalecology/lab-notebook">purl.org/globalecology/lab-notebook</a>. Existing public top level domain. Waiting for approval for my own top-level domain (cboettig).</p></li>
</ul>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(Hmisc)
df =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Age =</span> <span class="kw">round</span>(<span class="kw">rnorm</span>(<span class="dv">100</span>, <span class="dv">50</span>,<span class="dv">15</span>)), <span class="dt">Sex =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;W&quot;</span>)))
out &lt;-<span class="st"> </span><span class="kw">summary.formula</span>( ~<span class="st"> </span>Age +<span class="st"> </span>Sex, <span class="dt">data =</span> df, <span class="dt">method =</span> <span class="st">&quot;reverse&quot;</span>)
<span class="kw">print</span>(out, <span class="dt">hsep=</span> <span class="st">&#39;|&#39;</span>, <span class="dt">csep=</span><span class="st">&#39;|&#39;</span>, <span class="dt">vsep=</span><span class="st">&#39;-&#39;</span>, <span class="dt">left.border=</span><span class="ot">FALSE</span>, <span class="dt">top.border=</span><span class="ot">FALSE</span>)</code></pre>
<h2 id="references">References</h2>
<ul>
<li>Golan Bel, Aric Hagberg, Ehud Meron, (2012) Gradual Regime Shifts in Spatially Extended Ecosystems. <em>Theoretical Ecology</em> <strong>5</strong> 591-604 <a href="http://dx.doi.org/10.1007/s12080-011-0149-6">10.1007/s12080-011-0149-6</a></li>
<li>Maarten C. Boerlijst, Thomas Oudman, André M. de Roos, Ricard V. Solé, (2013) Catastrophic Collapse Can Occur Without Early Warning: Examples of Silent Catastrophes in Structured Ecological Models. <em>Plos One</em> <strong>8</strong> e62033-NA <a href="http://dx.doi.org/10.1371/journal.pone.0062033">10.1371/journal.pone.0062033</a></li>
<li>Donald Ludwig, Carl J. Walters, (1981) Measurement Errors And Uncertainty in Parameter Estimates For Stock And Recruitment. <em>Canadian Journal of Fisheries And Aquatic Sciences</em> <strong>38</strong> 711-720 <a href="http://dx.doi.org/10.1139/f81-094">10.1139/f81-094</a></li>
<li>Zeev Schuss, Bernard J. Matkowsky, (1979) The Exit Problem: A New Approach to Diffusion Across Potential Barriers. <em>Siam Journal on Applied Mathematics</em> <strong>36</strong> 604-623 <a href="http://dx.doi.org/10.1137/0136043">10.1137/0136043</a></li>
<li>R. Streeter, A. J. Dugmore, (2013) Anticipating Land Surface Change. <em>Proceedings of The National Academy of Sciences</em> <strong>110</strong> 5779-5784 <a href="http://dx.doi.org/10.1073/pnas.1220161110">10.1073/pnas.1220161110</a></li>
<li>Ethan White, Elita Baldridge, Zachary Brym, Kenneth Locey, Daniel McGlinn, Sarah Supp, (2013) Nine simple ways to make it easier to (re)use your data. <em>PeerJ PrePrints</em> <a href="http://peerj.com/preprints/7">http://peerj.com/preprints/7</a></li>
<li>Donald Ludwig, (1981). Escape from Domains of Attraction for Systems Perturbed by Noise, Nonlinear Phenomena in Physics and Biology.</li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/11/nonparametric-bayes-framing-the-issues.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

    <div class="row">
      
        <div class="span3">
          <header><h4><a href="/2013/04/05/a-clever-derivation-on-realized-escape-times.html">A Clever Derivation On Realized Escape Times</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 05 Apr 2013</p>

<p style="font-style:italic"> pageviews: 44 </p>

<article>
<div class="excerpt">
<p>I have often observed (e.g. <span class="showtooltip" title="Boettiger C and Hastings A (2012). Early Warning Signals And The
Prosecutor'S Fallacy. _Proceedings of The Royal Society B:
Biological Sciences_, *279*, pp. 4734-4739. ISSN 0962-8452, 
http://dx.doi.org/10.1098/rspb.2012.2085."><a href="http://dx.doi.org/10.1098/rspb.2012.2085" rel="http://purl.org/spar/cito/citesAsEvidence" >Boettiger &amp; Hastings (2012)</a></span> ) that if purely stochastic transitions out of a potential well happen, then they happen fast (dispite the fact that waiting time for them to happen is very long). Yesterday Marc mentioned an interesting proof of this from Don Ludwig, who was able to show that the waiting time to reach a large deviation in a time <span class="math">\(t\)</span>, given that it reaches it at all, is of the same order as the return time from the large deviation to the equilibrium, <span class="math">\(\log(L/\sigma)\)</span>. That’s an absolutely fascinating conclusion, indeed a bit stronger than even I had expected (the waiting time until an escape is observed rather different! – of order <span class="math">\(\exp(L^2/\sigma^2)\)</span>.</p>
<p>Don’s derivation is repeated in pages 302-311 Marc’s “Theoretical Biologist’s Toolbox,” rather delightfully too (e.g. the “Kumura Maneuver”, or sidenotes such as “it is also kind of fun to do a web search with key words ‘Dawson’s Integral’”). <span class="showtooltip" title="Lande R (1985). Expected time for random genetic drift of a
population between stable phenotypic states. 
http://www.pnas.org/content/82/22/7641.abstract [Online.
last-accessed: 2013-04-08 19:58:49]. 
http://www.pnas.org/content/82/22/7641.abstract."><a href="http://www.pnas.org/content/82/22/7641.abstract" rel="http://purl.org/spar/cito/citesForInformation" >Lande (1985)</a></span> provides a somewhat different derivation of the same result.</p>
<h2 id="return-time">Return time</h2>
<p>The return time calculation is straight forward. Consider our OU model</p>
<p><span class="math">\[dX = - X dt + \sigma dB_t\]</span></p>
<p>We ask for the return time into a neighborhood <span class="math">\(\sigma\)</span> of the origin, starting at <span class="math">\(X_0 = L\)</span> distant from the origin. The deterministic solution</p>
<p><span class="math">\[ \tfrac{dx}{dt} = - x \]</span></p>
<p>implies <span class="math">\(x_t = L (1 - e^{-t}) \)</span>, so setting <span class="math">\(x_t = \sigma_t\)</span> and solving for <span class="math">\(t\)</span>, we find that <span class="math">\(x_t\)</span> is within <span class="math">\(\sigma\)</span> of <span class="math">\(t\)</span> in time <span class="math">\(\log{L} - \log{\sigma}\)</span>, or <span class="math">\(\log{L/\sigma}\)</span>, as claimed.</p>
<h2 id="waiting-time">Waiting time</h2>
<p>The time we must wait before any trajectory can reach a given boundary is a classic hitting-time problem for the OU process that can be solved in several ways. Any of these basically start from PDE that must be satisfied for the hitting time (e.g. see Crispin Gardner, Stochastic Methods) for the OU process at stationary state (<span class="math">\(T_t = 0\)</span>),</p>
<p><span class="math">\[ \tfrac{\sigma^2}{2} T_{xx} - x T_x = -1 \]</span></p>
<p>With the appropriate boundary conditions <span class="math">\(T(L) = T(-L) = 0\)</span>. A little integration (see Dynkin’s formula) shows this scales as <span class="math">\(\exp(L^2/\sigma^2)\)</span> (Compare to the Brownian walk that doesn’t have to escape any pull, which escapes at rate <span class="math">\(L^2/\sigma^2\)</span>.</p>
<h2 id="exit-time">Exit time</h2>
<p>Most trajectories will thus return many times to the origin (stable point) before finally escaping. But if we focus just on the part of the trajectory from some value near the origin, that eventually escapes without ever crossing the origin again,</p>
<p><span class="math">\[u_t(x,t) dt = Pr\left(\textrm{exit from }(0; L]\textrm{in the interval } (t, t + dt) \textrm{without having crossed} 0 | X(0) = x\right)\]</span></p>
<p>We are interested in comparing the average time taken by trajectories exiting by time <span class="math">\(t\)</span> relative to the probability of exiting at all (i.e. as <span class="math">\(t \to \infty\)</span>),</p>
<p><span class="math">\[ T_c(x) = \frac{\int^{\infty}_0 t u_t(x,t) dt }{\lim_{t \to \infty} u(x,t) }\]</span></p>
<p>From here we set up the classic hitting time solution for the OU for the <em>time-dependent</em> PDE,</p>
<p><span class="math">\[u_t = \frac{\sigma^2}{2} u_{xx} = x u_x \]</span></p>
<p>and with initial condition <span class="math">\(u(x,t=0) = 0\)</span>, <span class="math">\(u(0,t) = 0\)</span>, and <span class="math">\(u(L, t) = 1\)</span>. A bit of effort and an approximation to Dawson’s integral for <span class="math">\(L \gg x\)</span> leads Don to bound the mean time to exit,</p>
<p><span class="math">\[T_c(x) &lt; \frac{1}{\sigma} \log\left(\frac{L}{\sigma}\right)\]</span></p>
<p>as claimed.</p>
<h2 id="results-from-marcs-other-suggestion">Results from Marc’s other suggestion</h2>
<p>Marc also suggested exploring this by directly comparing steps left and right. A related way to measure the relative number of steps in the positive direction relative to the negative direction is Kendall’s tau rank correlation coefficient, which also looks at the number of increases relative to the number of decreases.</p>
<p>I’ve computed this statistic for my sample trajectories and plotted as a histogram here. The negative skew shows the tendancy to decrease (which is the direction of the deviation I selected – smaller population sizes)</p>
<div class="figure">
<img src="http://farm9.staticflickr.com/8263/8621413072_3597b335fe_o.png" />
</div>
<p>I’ve also computed the ratio of steps up to steps down and histogrammed that: like the above, it shows more steps down than up, though not as dramatic as I might think by any means. Have to think about the role of the step size between observations in formulating this perhaps.</p>
<div class="figure">
<img src="http://farm9.staticflickr.com/8113/8621413020_5d779e8b1f_o.png" />
</div>
<p>For the sake of completeness:</p>
<ul>
<li><a href="https://github.com/cboettig/earlywarning/blob/8418a20cabf24786b54acc51eb508e9dbf3d1b37/inst/examples/trajectories.csv">data for the trajectories is here</a></li>
<li><a href="https://github.com/cboettig/earlywarning/blob/8418a20cabf24786b54acc51eb508e9dbf3d1b37/inst/examples/beer.md">code for the analysis is here</a></li>
</ul>
<p>I may try and add a demonstration of Ludwig’s result above when I get some more free time to fiddle; will just need to add some additional simulations of return trajectories.</p>
<h2 id="references">References</h2>
<ul>
<li>C. Boettiger, A. Hastings, (2012) Early Warning Signals And The Prosecutor’S Fallacy. <em>Proceedings of The Royal Society B: Biological Sciences</em> <strong>279</strong> 4734-4739 <a href="http://dx.doi.org/10.1098/rspb.2012.2085">10.1098/rspb.2012.2085</a></li>
<li>R Lande, (1985) Expected time for random genetic drift of a population between stable phenotypic states. <em>Proceedings of the National Academy of Sciences</em> <a href="http://www.pnas.org/content/82/22/7641.abstract">http://www.pnas.org/content/82/22/7641.abstract</a></li>
</ul> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/05/a-clever-derivation-on-realized-escape-times.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/04/notebook-parsing.html">Notebook Features: parsing linked data in the semantic notebook</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 04 Apr 2013</p>

<p style="font-style:italic"> pageviews: 47 </p>

<article>
<div class="excerpt">
<p>In a <a href="/2011/05/08/building-a-semantic-notebook.html">post a while back</a> I originally put forward the idea of a semantic lab notebook. Semantics, or linked data, are among the most powerful concepts to emerge in online science for scholarly data organization and communication. I have slowly been adding and exploring new ways to introduce semantic concepts into the notebook, which I have documented along the way under my <a href="http://www.carlboettiger.info/tags.html#semantics">#semantics</a> tag. In this post, rather than discuss how to generate the semantic data, I try to focus on some of the things we can <em>do</em> with it. This really just scratches the surface of possibilities, but should at least illustrate the general idea.</p>
<p>We will start with some very simple examples exploiting the semantics inherent in HTML5. We can then work up to richer examples that rely on XML-based parsing. The richest potential of the semantic notebook lies in leveraging the RDFa content, whose terms are defined as ontologies over which a machine can apply reasoning and formal logic against other web content (see, e.g. <span class="showtooltip" title="Shadbolt N, Berners-Lee T and Hall W (2006). The Semantic Web
Revisited. _Ieee Intelligent Systems_, *21*, pp. 96-101. ISSN
1541-1672,  http://dx.doi.org/10.1109/MIS.2006.62."><a href="http://dx.doi.org/10.1109/MIS.2006.62" rel="http://purl.org/spar/cito/obtainsBackgroundFrom" >Shadbolt <em>et. al.</em> (2006)</a></span> for further unformation). Though we show how to extract the and parse the RDF here, exploiting the RDF in the last example must wait to a later post.</p>
<h2 id="parsing-semantic-html">Parsing semantic HTML</h2>
<p>Our first set of examples will address parsing the semantic HTML directly. For background on how these elements are added to the notebook, see <a href="/2012/10/14/semantic-lab-notebook.html">this entry</a>. We will use R with it’s excellent collection of web, XML parsing, and text-mining tools to take advantage of the semantic structure. First we load the required packages,</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(RCurl)
<span class="kw">library</span>(XML)
<span class="kw">library</span>(tm)
<span class="kw">library</span>(wordcloud)
<span class="kw">library</span>(RColorBrewer)</code></pre>
<p>We can get a list of pages to download from the sitemap</p>
<pre class="sourceCode r"><code class="sourceCode r">pagelist &lt;-<span class="st"> </span><span class="kw">readLines</span>(<span class="st">&quot;http://carlboettiger.info/sitemap.txt&quot;</span>)
pagelist &lt;-<span class="st"> </span>pagelist[<span class="kw">grep</span>(<span class="st">&quot;/201</span><span class="ch">\\</span><span class="st">d/&quot;</span>, pagelist)]  <span class="co"># drop non-posts)</span>
pages &lt;-<span class="st"> </span><span class="kw">lapply</span>(pagelist, getURLContent, <span class="dt">followlocation =</span> <span class="ot">TRUE</span>)</code></pre>
<p>Or, if an archive is available locally, (e.g. from figshare cache), we can read the files in directly.</p>
<pre class="sourceCode r"><code class="sourceCode r">pages &lt;-<span class="st"> </span><span class="kw">system</span>(<span class="st">&quot;ls ~/Documents/labnotebook/_site/2***/*/*/*.html&quot;</span>, 
    <span class="dt">intern =</span> <span class="ot">TRUE</span>)</code></pre>
<p>We parse each of the pages as HTML so that we can manipulate them with XML tools</p>
<pre class="sourceCode r"><code class="sourceCode r">html &lt;-<span class="st"> </span><span class="kw">lapply</span>(pages, htmlParse)</code></pre>
<p>For instance, we can easily get the content of all entries:</p>
<pre class="sourceCode r"><code class="sourceCode r">text &lt;-<span class="st"> </span><span class="kw">sapply</span>(html, xpathSApply, <span class="st">&quot;//article&quot;</span>, xmlValue)</code></pre>
<p>We can also extract metadata based on the semantic markup.</p>
<pre class="sourceCode r"><code class="sourceCode r">titles &lt;-<span class="st"> </span><span class="kw">sapply</span>(html, xpathSApply, <span class="st">&quot;//title&quot;</span>, xmlValue)
categories &lt;-<span class="st"> </span><span class="kw">sapply</span>(html, xpathSApply, <span class="st">&quot;//node()[@class=&#39;category&#39;]&quot;</span>, 
    xmlValue)
tags &lt;-<span class="st"> </span><span class="kw">sapply</span>(html, xpathSApply, <span class="st">&quot;//node()[@class=&#39;tag&#39;]&quot;</span>, xmlValue)</code></pre>
<p>R makes it easy to summarize this data, e.g. by generating a table of the number of entries in each category, or a wordcloud of the tags.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(<span class="kw">unlist</span>(categories))</code></pre>
<pre><code>
 computation      ecology    evolution open-science     teaching 
          40          376          287           85           17 </code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wordcloud</span>(<span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(tags)))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8258/8620398951_0c2fd56e26_o.png" />
</div>
<h3 id="extracting-citations">Extracting citations</h3>
<p>Citation information can be encoded</p>
<p>We can perform more direct text mining as well. For instance, we extract all DOIs found in the text:</p>
<pre class="sourceCode r"><code class="sourceCode r">doi_pattern =<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">b(10[.][0-9]{4,}(?:[.][0-9]+)*/(?:(?![</span><span class="ch">\&quot;</span><span class="st">&amp;&#39;&lt;&gt;])</span><span class="ch">\\</span><span class="st">S)+)</span><span class="ch">\\</span><span class="st">b&quot;</span>
<span class="kw">require</span>(gsubfn)
dois &lt;-<span class="st"> </span><span class="kw">strapply</span>(text, doi_pattern, <span class="dt">perl =</span> <span class="ot">TRUE</span>)  <span class="co">#text[-462]</span>
<span class="kw">head</span>(<span class="kw">sort</span>(<span class="kw">table</span>(<span class="kw">unlist</span>(dois))))</code></pre>
<pre><code>
10.1002/(SICI)1520-6602(1998)1:1                 10.1002/bjs.6880 
                               1                                1 
                10.1002/etc.2140           10.1006/jtbi.1998.0660 
                               1                                1 
          10.1006/jtbi.2000.1080           10.1006/jtbi.2001.2299 
                               1                                1 </code></pre>
<p>Or generate a wordcloud of the full text</p>
<pre class="sourceCode r"><code class="sourceCode r">
carl &lt;-<span class="st"> </span><span class="kw">Corpus</span>(<span class="kw">VectorSource</span>(text))
carl &lt;-<span class="st"> </span><span class="kw">tm_map</span>(carl, removePunctuation)
carl &lt;-<span class="st"> </span><span class="kw">tm_map</span>(carl, tolower)
carl &lt;-<span class="st"> </span><span class="kw">tm_map</span>(carl, function(x) <span class="kw">removeWords</span>(x, <span class="kw">stopwords</span>()))

carl.tdm &lt;-<span class="st"> </span><span class="kw">TermDocumentMatrix</span>(carl)
carl.m &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(carl.tdm)
carl.v &lt;-<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rowSums</span>(carl.m), <span class="dt">decreasing =</span> <span class="ot">TRUE</span>)
carl.d &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">word =</span> <span class="kw">names</span>(carl.v), <span class="dt">freq =</span> carl.v)


<span class="kw">wordcloud</span>(carl.d$word, carl.d$freq, <span class="dt">scale =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="fl">0.4</span>), <span class="dt">min.freq =</span> <span class="dv">3</span>, 
    <span class="dt">max.words =</span> <span class="dv">100</span>, <span class="dt">random.order =</span> <span class="ot">FALSE</span>, <span class="dt">rot.per =</span> <span class="fl">0.15</span>, <span class="dt">colors =</span> <span class="kw">brewer.pal</span>(<span class="dv">8</span>, 
        <span class="st">&quot;Dark2&quot;</span>))</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8385/8621498714_2fe3e04226_o.png" />
</div>
<h2 id="rdfa-parsing">RDFa parsing</h2>
<p>RDF triples are the mainstay of semantic, linked data. Unlike the more text-mining oriented examples above, data in this format follows a strict and universal standard which allows a machine to identify meaning rather precisely. Critically, this allows one to automatically link data appearing in the notebook to data elsewhere on the web without the ambiguities of natural language that for instance, might confuse the animal jaguar with the car.</p>
<p>RDFa is a way of adding these precise statements to HTML, again see the <a href="/2012/10/14/semantic-lab-notebook.html">earlier entry</a> on how this is done. The technically inclined will note that the namespaces of the RDFa itself are not accessible in the XML parsing we used above, since they do not correspond to nodes or attributes, but appear only in the values of attributes. Fortunately, there are many excellent tools to extract this RDFa data, turning it into the XML formatted RDF triples we need. e can perform this using the <a href="http://any23.org">Any23</a> API</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">download.file</span>(<span class="kw">paste</span>(<span class="st">&quot;http://any23.org/rdfxml&quot;</span>, <span class="st">&quot;http://carlboettiger.info&quot;</span>, 
    <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>), <span class="st">&quot;temp.xml&quot;</span>)
doc &lt;-<span class="st"> </span><span class="kw">xmlParse</span>(<span class="st">&quot;temp.xml&quot;</span>)</code></pre>
<p>Which creates a beautiful RDF XML file of all linked data found in the entry.</p>
<pre class="sourceCode r"><code class="sourceCode r">doc</code></pre>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;rdf:RDF xmlns:xhtml=&quot;http://www.w3.org/1999/xhtml/vocab#&quot; xmlns:dcterms=&quot;http://purl.org/dc/terms/&quot; xmlns:rdf=&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&gt;
  &lt;rdf:Description rdf:about=&quot;http://www.carlboettiger.info/&quot;&gt;
    &lt;dcterms:title xml:lang=&quot;en&quot;&gt;Carl Boettiger&lt;/dcterms:title&gt;
    &lt;xhtml:license rdf:resource=&quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;/&gt;
    &lt;dcterms:title xml:lang=&quot;en&quot;&gt;Carl Boettiger&lt;/dcterms:title&gt;
    &lt;dcterms:creator xml:lang=&quot;en&quot;&gt;Carl Boettiger&lt;/dcterms:creator&gt;
    &lt;dcterms:date xml:lang=&quot;en&quot;&gt;2013-04-04T11:07:14-07:00&lt;/dcterms:date&gt;
    &lt;dcterms:format xml:lang=&quot;en&quot;&gt;text/html&lt;/dcterms:format&gt;
    &lt;dcterms:language xml:lang=&quot;en&quot;&gt;en&lt;/dcterms:language&gt;
    &lt;dcterms:identifier xml:lang=&quot;en&quot;&gt;/index.html&lt;/dcterms:identifier&gt;
    &lt;dcterms:rights xml:lang=&quot;en&quot;&gt;CC0&lt;/dcterms:rights&gt;
    &lt;dcterms:source xml:lang=&quot;en&quot;&gt;Lab Notebook&lt;/dcterms:source&gt;
    &lt;dcterms:subject xml:lang=&quot;en&quot;&gt;Ecology&lt;/dcterms:subject&gt;
    &lt;dcterms:type xml:lang=&quot;en&quot;&gt;website&lt;/dcterms:type&gt;
    &lt;title xmlns=&quot;http://ogp.me/ns#&quot; xml:lang=&quot;en&quot;&gt;Carl Boettiger&lt;/title&gt;
    &lt;author xmlns=&quot;http://ogp.me/ns#&quot; xml:lang=&quot;en&quot;&gt;http://www.carlboettiger.info/index.html#me&lt;/author&gt;
    &lt;first_name xmlns=&quot;http://ogp.me/ns/profile#&quot; xml:lang=&quot;en&quot;&gt;Carl&lt;/first_name&gt;
    &lt;last_name xmlns=&quot;http://ogp.me/ns/profile#&quot; xml:lang=&quot;en&quot;&gt;Boettiger&lt;/last_name&gt;
    &lt;published_time xmlns=&quot;http://ogp.me/ns/article#&quot; xml:lang=&quot;en&quot;&gt;2013-04-04T11:07:14-07:00&lt;/published_time&gt;
    &lt;site_name xmlns=&quot;http://ogp.me/ns#&quot; xml:lang=&quot;en&quot;&gt;Lab Notebook&lt;/site_name&gt;
    &lt;url xmlns=&quot;http://ogp.me/ns#&quot; xml:lang=&quot;en&quot;&gt;http://www.carlboettiger.info/index.html&lt;/url&gt;
    &lt;type xmlns=&quot;http://ogp.me/ns#&quot; xml:lang=&quot;en&quot;&gt;website&lt;/type&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info#me&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://xmlns.com/foaf/0.1/Person&quot;/&gt;
    &lt;rdf:type rdf:resource=&quot;http://schema.org/Person#Person&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://www.carlboettiger.info/assets/img/carlboettiger.png&quot;&gt;
    &lt;depiction xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; xml:lang=&quot;en&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info&quot;&gt;
    &lt;homepage xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://carlboettiger.info&quot;/&gt;
    &lt;url xmlns=&quot;http://schema.org/Person#&quot; rdf:resource=&quot;http://carlboettiger.info&quot;/&gt;
    &lt;name xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; xml:lang=&quot;en&quot;&gt;Carl Boettiger&lt;/name&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info#me&quot;&gt;
    &lt;jobTitle xmlns=&quot;http://schema.org/Person#&quot; xml:lang=&quot;en&quot;&gt;a post-doctoral researcher&lt;/jobTitle&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:nodeID=&quot;node17eprp1n4x899515&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://xmlns.com/foaf/0.1/Person&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info#me&quot;&gt;
    &lt;knows xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:nodeID=&quot;node17eprp1n4x899515&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:nodeID=&quot;node17eprp1n4x899515&quot;&gt;
    &lt;homepage xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://users.soe.ucsc.edu/~msmangel/&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info#me&quot;&gt;
    &lt;knows xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:nodeID=&quot;node17eprp1n4x899515&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://users.soe.ucsc.edu/~msmangel/&quot;&gt;
    &lt;name xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; xml:lang=&quot;en&quot;&gt;Marc Mangel&lt;/name&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:nodeID=&quot;node17eprp1n4x899516&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://xmlns.com/foaf/0.1/Person&quot;/&gt;
    &lt;homepage xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://swfsc.noaa.gov/staff.aspx?&amp;amp;id=17294&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://swfsc.noaa.gov/staff.aspx?&amp;amp;id=17294&quot;&gt;
    &lt;name xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; xml:lang=&quot;en&quot;&gt;Steve Munch&lt;/name&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://carlboettiger.info#me&quot;&gt;
    &lt;affiliation xmlns=&quot;http://schema.org/Person#&quot; rdf:resource=&quot;http://boe.ucsc.edu/~msmangel/CSTAR.html&quot;/&gt;
    &lt;workplaceHomepage xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://www.ucsc.edu/&quot;/&gt;
    &lt;weblog xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://www.carlboettiger.info/lab-notebook.html&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:nodeID=&quot;node17eprp1n4x899517&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://schema.org/PostalAddress&quot;/&gt;
    &lt;address xmlns=&quot;http://schema.org/Person#&quot; xml:lang=&quot;en&quot;&gt;Center for Stock Assessment Research, 110 Shaffer Rd, Santa Cruz, CA 95050, USA&lt;/address&gt;
    &lt;streetAddress xmlns=&quot;http://schema.org/PostalAddress/&quot; xml:lang=&quot;en&quot;&gt;Center for Stock Assessment Research, 110 Shaffer Rd&lt;/streetAddress&gt;
    &lt;addressLocality xmlns=&quot;http://schema.org/PostalAddress/&quot; xml:lang=&quot;en&quot;&gt;Santa Cruz&lt;/addressLocality&gt;
    &lt;addressRegion xmlns=&quot;http://schema.org/PostalAddress/&quot; xml:lang=&quot;en&quot;&gt;CA&lt;/addressRegion&gt;
    &lt;postalCode xmlns=&quot;http://schema.org/PostalAddress/&quot; xml:lang=&quot;en&quot;&gt;95050&lt;/postalCode&gt;
    &lt;addressCountry xmlns=&quot;http://schema.org/PostalAddress/&quot; xml:lang=&quot;en&quot;&gt;USA&lt;/addressCountry&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;https://orcid.org/0000-0002-1642-628X&quot;&gt;
    &lt;orcid xmlns=&quot;http://purl.org/spar/datacite/&quot; rdf:resource=&quot;https://orcid.org/0000-0002-1642-628X&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://www.carlboettiger.info#me&quot;&gt;
    &lt;rdf:type rdf:resource=&quot;http://xmlns.com/foaf/0.1/Person&quot;/&gt;
    &lt;account xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;http://www.cloudflare.com/email-protection#f497969b9180809d93b49399959d98da979b99&quot;/&gt;
    &lt;account xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;https://twitter.com/cboettig&quot;/&gt;
    &lt;account xmlns=&quot;http://xmlns.com/foaf/0.1/&quot; rdf:resource=&quot;https://github.com/cboettig&quot;/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about=&quot;http://www.carlboettiger.info/&quot;&gt;
    &lt;license xmlns=&quot;http://www.carlboettiger.info/&quot; rdf:resource=&quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;/&gt;
    &lt;license xmlns=&quot;http://creativecommons.org/ns#&quot; rdf:resource=&quot;http://creativecommons.org/publicdomain/zero/1.0/&quot;/&gt;
  &lt;/rdf:Description&gt;
&lt;/rdf:RDF&gt;
 </code></pre>
<p>We can now explore this data using the XML tools illustrated above. The rigidity of the XML rather than HTML parsing and the use of namespaces gives us greater precision.</p> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/04/notebook-parsing.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
        <div class="span3">
          <header><h4><a href="/2013/04/03/further-examples-managing-tipping-points-with-gp.html">Further Examples Managing Tipping Points With Gp</a></h4></header>
<p><span></span></p>
<p style="font-style:italic"> 03 Apr 2013</p>

<p style="font-style:italic"> pageviews: 27 </p>

<article>
<div class="excerpt">
<p>See also:</p>
<ul>
<li>http://www.carlboettiger.info/2012/12/20/results-comparing-gp-to-parametric.html</li>
</ul>
<p>Example with fixed priors on hyperparameters, fixed model type.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co">#inv gamma has mean b / (a - 1) (assuming a&gt;1) and variance b ^ 2 / ((a - 2) * (a - 1) ^ 2) (assuming a&gt;2)</span>
s2.p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)  
tau2.p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">1</span>)
d.p =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>)
nug.p =<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>, <span class="dv">10</span>, <span class="dv">1</span>/<span class="fl">0.1</span>) <span class="co"># gamma mean</span>
s2_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dinvgamma</span>(x, s2.p[<span class="dv">1</span>], s2.p[<span class="dv">2</span>])
tau2_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dinvgamma</span>(x, tau2.p[<span class="dv">1</span>], tau2.p[<span class="dv">2</span>])
d_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dgamma</span>(x, d.p[<span class="dv">1</span>], <span class="dt">scale =</span> d.p[<span class="dv">2</span>]) +<span class="st"> </span><span class="kw">dgamma</span>(x, d.p[<span class="dv">3</span>], <span class="dt">scale =</span> d.p[<span class="dv">4</span>])
nug_prior &lt;-<span class="st"> </span>function(x) <span class="kw">dgamma</span>(x, nug.p[<span class="dv">1</span>], <span class="dt">scale =</span> nug.p[<span class="dv">2</span>]) +<span class="st"> </span><span class="kw">dgamma</span>(x, nug.p[<span class="dv">3</span>], <span class="dt">scale =</span> nug.p[<span class="dv">4</span>])
beta0_prior &lt;-<span class="st"> </span>function(x, tau) <span class="kw">dnorm</span>(x, <span class="dv">0</span>, tau)
beta =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>)
priors &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">s2 =</span> s2_prior, <span class="dt">tau2 =</span> tau2_prior, <span class="dt">beta0 =</span> dnorm, <span class="dt">nug =</span> nug_prior, <span class="dt">d =</span> d_prior, <span class="dt">ldetK =</span> function(x) <span class="dv">0</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">profit =<span class="st"> </span>function(x,h) <span class="kw">pmin</span>(x, h)
delta &lt;-<span class="st"> </span><span class="fl">0.01</span>
OptTime =<span class="st"> </span><span class="dv">20</span>  <span class="co"># stationarity with unstable models is tricky thing</span>
reward =<span class="st"> </span><span class="dv">0</span>
xT &lt;-<span class="st"> </span><span class="dv">0</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">f &lt;-<span class="st"> </span>RickerAllee
<span class="co"># c(5, 10, 5) is 2-cycle, c(5.5, 10, 5) is 6 cycle, 5.3 is about 4</span>
p &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">5</span>) 
K &lt;-<span class="st"> </span><span class="dv">10</span>
allee &lt;-<span class="st"> </span><span class="dv">5</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">sigma_g &lt;-<span class="st"> </span><span class="fl">0.05</span>
sigma_m &lt;-<span class="st"> </span><span class="fl">0.0</span>
z_g =<span class="st"> </span>function() <span class="kw">rlnorm</span>(<span class="dv">1</span>, <span class="dv">0</span>, sigma_g)
z_m =<span class="st"> </span>function() <span class="dv">1</span>+(<span class="dv">2</span>*<span class="kw">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>,  <span class="dv">1</span>)-<span class="dv">1</span>) *<span class="st"> </span>sigma_m
x_grid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">1.5</span> *<span class="st"> </span>K, <span class="dt">length=</span><span class="dv">101</span>)
h_grid &lt;-<span class="st"> </span>x_grid</code></pre>
<p>With parameters 2, 10, 5.</p>
<pre class="sourceCode r"><code class="sourceCode r">seed_i &lt;-<span class="st"> </span><span class="dv">1</span>
  Xo &lt;-<span class="st"> </span>K <span class="co"># observations start from</span>
  x0 &lt;-<span class="st"> </span>Xo <span class="co"># simulation under policy starts from</span></code></pre>
<pre class="sourceCode r"><code class="sourceCode r">  obs &lt;-<span class="st"> </span><span class="kw">sim_obs</span>(Xo, z_g, f, p, <span class="dt">Tobs=</span><span class="dv">35</span>, <span class="dt">nz=</span><span class="dv">15</span>, 
                 <span class="dt">harvest =</span> <span class="kw">sort</span>(<span class="kw">rep</span>(<span class="kw">seq</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dt">length=</span><span class="dv">7</span>), <span class="dv">5</span>)), <span class="dt">seed =</span> seed_i)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">  alt &lt;-<span class="st"> </span><span class="kw">par_est</span>(obs,  <span class="dt">init =</span> <span class="kw">c</span>(<span class="dt">r=</span>p[<span class="dv">1</span>], <span class="dt">K=</span><span class="kw">mean</span>(obs$x), <span class="dt">s=</span>sigma_g))
  est &lt;-<span class="st"> </span><span class="kw">par_est_allee</span>(obs, f, p,  <span class="dt">init =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="kw">mean</span>(obs$x), <span class="dv">2</span>, <span class="dt">s =</span> sigma_g))</code></pre>
<p>Which estimates a Ricker model with <span class="math">\(r =\)</span> 2, <span class="math">\(K =\)</span> 6.77, and the Allen allee model with <span class="math">\(r =\)</span> 2, <span class="math">\(K =\)</span> 6.77 and <span class="math">\(C =\)</span> 2.</p>
<pre class="sourceCode r"><code class="sourceCode r">  gp &lt;-<span class="st"> </span><span class="kw">bgp</span>(<span class="dt">X=</span>obs$x, <span class="dt">XX=</span>x_grid, <span class="dt">Z=</span>obs$y, <span class="dt">verb=</span><span class="dv">0</span>,
          <span class="dt">meanfn=</span><span class="st">&quot;constant&quot;</span>, <span class="dt">bprior=</span><span class="st">&quot;b0&quot;</span>, <span class="dt">BTE=</span><span class="kw">c</span>(<span class="dv">2000</span>,<span class="dv">16000</span>,<span class="dv">2</span>),
          <span class="dt">m0r1=</span><span class="ot">FALSE</span>, <span class="dt">corr=</span><span class="st">&quot;exp&quot;</span>, <span class="dt">trace=</span><span class="ot">TRUE</span>, 
          <span class="dt">beta =</span> beta, <span class="dt">s2.p =</span> s2.p, <span class="dt">d.p =</span> d.p, <span class="dt">nug.p =</span> nug.p, <span class="dt">tau2.p =</span> tau2.p,
          <span class="dt">s2.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">d.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">nug.lam =</span> <span class="st">&quot;fixed&quot;</span>, <span class="dt">tau2.lam =</span> <span class="st">&quot;fixed&quot;</span>)      
  <span class="kw">gp_plot</span>(gp, f, p, est$f, est$p, alt$f, alt$p, x_grid, obs, seed_i)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8535/8617059578_b528a1e51c_o.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">  <span class="kw">posteriors_plot</span>(gp, priors) <span class="co"># needs trace=TRUE!</span></code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8540/8617059782_197bdf7edd_o.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">  OPT &lt;-<span class="st"> </span><span class="kw">optimal_policy</span>(gp, f, est$f, alt$f,
                        p, est$p, alt$p,
                        x_grid, h_grid, sigma_g, 
                        sigma_g, sigma_g, <span class="co"># est$sigma_g, alt$sigma_g, but those ests are poor</span>
                        delta, xT, profit, reward, OptTime)
  <span class="kw">plot_policies</span>(x_grid, OPT$gp_D, OPT$est_D, OPT$true_D, OPT$alt_D)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8265/8617060456_71afc3e4eb_o.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw">simulate_opt</span>(OPT, f, p, x_grid, h_grid, x0, z_g, profit)
<span class="kw">sim_plots</span>(dt, <span class="dt">seed=</span>seed_i)</code></pre>
<div class="figure">
<img src="http://farm9.staticflickr.com/8113/8617060842_7c088c12d1_o.png" />
</div>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">profits_stats</span>(dt)</code></pre>
<pre><code>       method     V1     sd
1:         GP 19.337 1.6314
2: Parametric  6.446 0.3384
3:       True 20.701 1.8012
4: Structural  7.650 0.0000</code></pre> 
<!-- not that raw_content depends on custom generator, 
     see _plugins/jekyll-labnotebook-plugins/raw_content --> 
</article> 
<p> <a href="/2013/04/03/further-examples-managing-tipping-points-with-gp.html"> <em>Read more</em></a> </p>
<br />
<br />


        </div>
      
    </div>

  </div>
</div> <!--end row -->

<div class="row">
  <div class="span11 offset1">
    <div class="socialicons">
      <p> <a href="/archive.html"><i class="icon-calendar"></i> All entries by date</a></p> 
      <p> <a href="/categories.html"><i class="icon-list"></i> All entries by category</a> </p>
      <p> <a href="/tags.html"><i class="icon-tags"></i> All entries by tag</a> </p>
    </div>
  </div> <!--end span9 -->
</div> <!--end row -->




<footer class="footer">
  <!-- ************* Buttons to toggle theme CSS ********************** -->
    <div class="row">
      <div class="span12">
        <form style="font-size:10px" class="pull-right">
          <a onclick="switch_style('dark'); 
                      recordOutboundLink(this, 'Outbound Links', 'dark theme'); 
                      return false;" 
             name="theme" value="dark" id="dark" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to dark theme"><i class="icon-adjust"></i>
                                   </span></a>
          
          <a onclick="switch_style('light'); 
                      recordOutboundLink(this, 'Outbound Links', 'light theme'); 
                      return false;" 
             name="theme" value="light" id="light" 
             class="btn btn-mini"><span class="showtooltip" 
                                        title="switch to light theme"><i class="icon-certificate"></i>
                                  </span></a>
        </form>
      </div>
    </div>

<!--************** FOAF information to social networks ***************************** -->
  <div class="row">
    <div class="span3 socialicons" style="font-size:20px" typeof="foaf:Person" about="http://www.carlboettiger.info#me">
      <p>
          <a rel="foaf:account" alt="email" href="mailto:cboettig@gmail.com" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'email'); 
             return false;"><span class="showtooltip" title="email me"><i class="icon-envelope-alt"></i></span></a>
          <a rel="foaf:account" alt="twitter" href="https://twitter.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Twitter'); 
             return false;"><span class="showtooltip" title="follow me on twitter (reading, discussing)"><i class="icon-twitter"></i></span></a> 
          <a rel="foaf:account" alt="github" href="https://github.com/cboettig" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Github'); 
             return false;"><span class="showtooltip" title="follow me on Github (code, research)"><i class="icon-github"></i></span></a>
      <!--
          <a rel="foaf:account" href="https://plus.google.com/" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'GPlus'); 
             return false;"><i class="icon-google-plus"></i></a>
          <a rel="foaf:account" href="http://www.mendeley.com/profiles/carl-boettiger" 
             onclick="recordOutboundLink(this, 'Outbound Links', 'Mendeley'); 
             return false;"><img src="/assets/img/icon-mendeley.png" alt="mendeley" /></a> 
           citations on google-scholar
           stackoverflow
      -->
      <a alt="rss" type="application/atom+xml" href="/atom.xml"  
         class="showtooltip" title="subscribe to RSS feeds for my open lab notebook" 
         onclick="recordOutboundLink(this, 'Outbound Links', 'RSS'); 
         return false;"><i class="icon-rss"></i></a>
       </p>
    </div>
    <!--**************** End social links **************************** -->
    <div class="span1">
      <br />
    </div>
    <div class="span4">
      <p>
      <a onclick="recordOutboundLink(this, 'Outbound Links', 'ONS_claim'); return false;" href="http://onsclaims.wikispaces.com/"><img src="http://onsclaims.wikispaces.com/file/view/ons-aci2-icon.png" alt="ONS" class="showtooltip" title="An Open Notebook Science (ONS) project claim: Entry provides all content (AC) immediately (I) or without significant delay.  See link for details"/></a>

      <a title="This site uses linked data semantics. Click to extract as RDF XML." class="btn btn-mini showtooltip" style="font-size: .8em" 
       href="http://any23.org/?format=rdfxml&validate=validate&uri=http://www.carlboettiger.info/lab-notebook.html"><i 
         class="icon-cloud-download"  onclick="recordOutboundLink(this, 'Outbound Links', 'RDF'); return false;"></i> RDF</a>
      </p>
    </div>
    <div class="span1">
      <br />
    </div>
    <div class="span3">
      <p>
      <a rel="license" property="http://creativecommons.org/ns#license" href="http://creativecommons.org/publicdomain/zero/1.0/" onclick="recordOutboundLink(this, 'Outbound Links', 'CC0'); return false;"><img src="http://i.creativecommons.org/l/zero/1.0/88x31.png" alt="CC0"/></a> 
      </p>
    </div>

  </div>
  
<!-- COinS metadata (for citation managers like Zotero etc), goes in body text -->
  <span
      class="Z3988" 
      title="ctx_ver=Z39.88-2004
      &amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Adc
      &amp;rfr_id=info%3Asid%2Focoins.info%3Agenerator
      &amp;rft.title=Lab Notebook
      &amp;rft.creator=Carl Boettiger
      &amp;rft.date=
      &amp;rft.language=EN
      &amp;rft.rights=CC0
      &amp;rft_id=http://www.carlboettiger.info/lab-notebook.html">
  </span>



</footer>




    <!-- Le javascript
    ================================================== -->

    <!-- Placed at the end of the document so the pages load faster -->
    <!-- JQuery, used on a few pages -->
    <script type="text/javascript" src="/assets/js/jquery.js"></script>
    <!-- Equations using MathJax -->
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config"> MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "all"} } });       </script>
    <!-- Twitter Bootstrap Javascript -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Tooltip javascript -->
    <script type="text/javascript">
      $(document).ready(function (){
        $(".showtooltip").tooltip();
      });
    </script>

    <!-- Marran's Search Javascript -->
    <script type="text/javascript" src="/assets/js/porter-stemmer.js"></script>
    <script type="text/javascript" src="/assets/js/site-search.js"></script>

    <!-- Code collapse Javascript -->
    <script type="text/javascript">
    $(document).ready(function(){
      $("#toggle_code").click(function(){
        $(".highlight").toggle();
        $(".sourceCode").toggle();
      });
    });
    </script>


  <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-18401403-1']);
          _gaq.push(['_trackPageview']);
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
  </script>



<script type="text/javascript">
function recordOutboundLink(link, category, action) {
  try {
    var pageTracker=_gat._getTracker("UA-18401403-1");
    pageTracker._trackEvent(category, action);
    setTimeout('document.location = "' + link.href + '"', 100)
  }catch(err){}
}
</script>




    


    </div>
  </body>
</html>

